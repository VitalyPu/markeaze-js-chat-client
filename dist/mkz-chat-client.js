!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){var s=i(2).Socket,n=i(3),o=i(4),r=i(5).default;e.exports={store:null,libs:null,currentAgent:null,agents:[],sessionsCount:0,history:[],settings:{typingTimeout:1e3,whitelabel:!1,copyright:"Powered by Markeaze",offline:"Leave message",placeholder:"Type your message here...",noticeIcon:"/assets/images/tooltip.png",noticeText:"Looking for<br />halloween gifts?",noticeShowTimeout:1e3,noticeHideTimeout:1e4,margin:"20px",iconColor:"#000",iconBg:"#F28E24",iconText:"We’re here. Let’s chat!",iconPosition:"r-b",iconType:"bubble"},ready:function(e){if(!window[e])return!1;var t=this;window[e]((function(){t.store=this.store,t.libs=this.libs,t.libs.sanitise=t.sanitise,t.createConnection.apply(t),t.libs.log.push("chat","init")}))},createConnection:function(){this.socket=new s("//".concat(this.store.chatEndpoint,"/socket")),this.socket.connect(),this.channel=this.socket.channel("room:".concat(this.store.appKey,":").concat(this.store.uid)),this.view=new r(this),this.channel.join().receive("ok",this.handlerReady.bind(this)),this.channel.on("client:entered",this.handlerClientEntered.bind(this)),this.channel.on("message:new",this.handlerMsg.bind(this)),this.channel.on("message:resend",this.handlerMsgResend.bind(this)),this.channel.on("agent:assign",this.handlerAgentAssign.bind(this))},handlerReady:function(){this.history=n.getData(),this.view.render(),this.view.scrollBottom(),this.libs.log.push("chat","joined")},handlerClientEntered:function(e){this.setAgents(e.agents),this.sessionsCount=e.sessionsCount,this.setCurrentAgent(e.current_agent_id),this.libs.log.push("chat","ClientEntered",e)},handlerMsg:function(e){this.parseMsg(e),this.libs.log.push("chat","Msg",e),this.view.scrollBottom()},handlerMsgResend:function(){this.parseMsg(msg),this.view.scrollBottom(),this.setCurrentAgent(msg.current_agent_id),this.libs.log.push("chat","Resend",msg)},handlerAgentAssign:function(){this.setCurrentAgent(msg.agent_id)},handlerCollapse:function(e){if(!0!==e){var t=o.getList(),i=!0,s=!1,n=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){r.value;this.pusherMsgState(msg.muid,"delivered")}}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}o.resetList()}},pusherTyping:function(e){if(e)return this.channel.push("client:activity",{type:"typing",text:e})},pusherNewMsg:function(e){if(e){var t=+new Date,i=this.store.uid;return this.channel.push("message:new",{muid:"".concat(i,":c:").concat(t),body:e,sent_at:this.getDateTime()})}},pusherMsgState:function(e,t){e&&this.channel.push("message:status:change",{muid:e,new_status:t,performed_at:this.getDateTime()})},getDateTime:function(){return(new Date).toISOString()},parseMsg:function(e){if(e.agent_id){var t=this.getAgent(e.agent_id);e.avatar_url=t?t.avatar_url:null,!1===this.view.collapsed?this.pusherMsgState(e.muid,"read"):(this.pusherMsgState(e.muid,"delivered"),o.addItem(e.muid))}this.history=n.addData(this.history,e),this.view.render()},setCurrentAgent:function(e){(e||this.currentAgent)&&(this.currentAgent=this.getAgent(e),this.currentAgent?this.view.assignAgent():this.view.unassignAgent())},setAgents:function(e){this.agents=e.reduce((function(e,t){return e[t.id]=t,e}),{})},getAgent:function(e){return this.agents[e]||null},sanitise:function(e){if(e){var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","&":"&"};return e.replace(/[&<>"'/]/gi,(function(e){return t[e]}))}}}},function(e,t,i){"use strict";i.r(t);var s=i(0);i.n(s).a.ready("mkz")},function(e,t,i){"use strict";i.r(t),i.d(t,"Channel",(function(){return f})),i.d(t,"Serializer",(function(){return _})),i.d(t,"Socket",(function(){return k})),i.d(t,"LongPoll",(function(){return b})),i.d(t,"Ajax",(function(){return v})),i.d(t,"Presence",(function(){return z}));const s="undefined"!=typeof self?self:null,n="undefined"!=typeof window?window:null,o=s||n||void 0,r="2.0.0",a={connecting:0,open:1,closing:2,closed:3},c=1e4,l=1e3,h={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},d={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},p=[d.close,d.error,d.join,d.reply,d.leave],u={longpoll:"longpoll",websocket:"websocket"};let m=e=>{if("function"==typeof e)return e;return function(){return e}};class g{constructor(e,t,i,s){this.channel=e,this.event=t,this.payload=i||function(){return{}},this.receivedResp=null,this.timeout=s,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,ref:i}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}class f{constructor(e,t,i){this.state=h.closed,this.topic=e,this.params=m(t||{}),this.socket=i,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new g(this,d.join,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new y(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=h.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=h.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=h.closed,this.socket.remove(this)}),this.onError(e=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,e),this.isJoining()&&this.joinPush.reset(),this.state=h.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new g(this,d.leave,m({}),this.timeout).send(),this.state=h.errored,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(d.reply,(e,t)=>{this.trigger(this.replyEventName(t),e)})}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(d.close,e)}onError(e){return this.on(d.error,t=>e(t))}on(e,t){let i=this.bindingRef++;return this.bindings.push({event:e,ref:i,callback:t}),i}off(e,t){this.bindings=this.bindings.filter(i=>!(i.event===e&&(void 0===t||t===i.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,i=this.timeout){if(!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let s=new g(this,e,(function(){return t}),i);return this.canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=h.leaving;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(d.close,"leave")},i=new g(this,d.leave,m({}),e);return i.receive("ok",()=>t()).receive("timeout",()=>t()),i.send(),this.canPush()||i.trigger("ok",{}),i}onMessage(e,t,i){return t}isLifecycleEvent(e){return p.indexOf(e)>=0}isMember(e,t,i,s){return this.topic===e&&(!s||s===this.joinRef()||!this.isLifecycleEvent(t)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:i,joinRef:s}),!1))}joinRef(){return this.joinPush.ref}sendJoin(e){this.state=h.joining,this.joinPush.resend(e)}rejoin(e=this.timeout){this.isLeaving()||this.sendJoin(e)}trigger(e,t,i,s){let n=this.onMessage(e,t,i,s);if(t&&!n)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");for(let t=0;t<this.bindings.length;t++){const o=this.bindings[t];o.event===e&&o.callback(n,i,s||this.joinRef())}}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===h.closed}isErrored(){return this.state===h.errored}isJoined(){return this.state===h.joined}isJoining(){return this.state===h.joining}isLeaving(){return this.state===h.leaving}}let _={encode(e,t){let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(i))},decode(e,t){let[i,s,n,o,r]=JSON.parse(e);return t({join_ref:i,ref:s,topic:n,event:o,payload:r})}};class k{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||c,this.transport=t.transport||o.WebSocket||b,this.defaultEncoder=_.encode,this.defaultDecoder=_.decode,this.closeWasClean=!1,this.unloaded=!1,this.binaryType=t.binaryType||"arraybuffer",this.transport!==b?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),n&&n.addEventListener&&n.addEventListener("beforeunload",e=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))}),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=e=>t.rejoinAfterMs?t.rejoinAfterMs(e):[1e3,2e3,5e3][e-1]||1e4,this.reconnectAfterMs=e=>this.unloaded?100:t.reconnectAfterMs?t.reconnectAfterMs(e):[10,50,100,150,200,250,500,1e3,2e3][e-1]||5e3,this.logger=t.logger||null,this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=m(t.params||{}),this.endPoint=`${e}/${u.websocket}`,this.vsn=t.vsn||r,this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new y(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=v.appendParams(v.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,i){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,i)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=m(e)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=e=>this.onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this.onConnClose(e))}log(e,t,i){this.logger(e,t,i)}hasLogger(){return null!==this.logger}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}onConnOpen(){this.hasLogger()&&this.log("transport",`connected to ${this.endPointURL()}`),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,e])=>e())}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(e,t,i){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,i||""):this.conn.close(),this.conn=null),e&&e()}onConnClose(e){this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,t])=>t(e))}onConnError(e){this.hasLogger()&&this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(([,t])=>t(e))}triggerChanError(){this.channels.forEach(e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(d.error)})}connectionState(){switch(this.conn&&this.conn.readyState){case a.connecting:return"connecting";case a.open:return"open";case a.closing:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter(([t])=>!e.includes(t))}channel(e,t={}){let i=new f(e,t,this);return this.channels.push(i),i}push(e){if(this.hasLogger()){let{topic:t,event:i,payload:s,ref:n,join_ref:o}=e;this.log("push",`${t} ${i} (${o}, ${n})`,s)}this.isConnected()?this.encode(e,e=>this.conn.send(e)):this.sendBuffer.push(()=>this.encode(e,e=>this.conn.send(e)))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(e){this.closeWasClean=!1,this.conn.close(l,e)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:i,payload:s,ref:n,join_ref:o}=e;n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${s.status||""} ${t} ${i} ${n&&"("+n+")"||""}`,s);for(let e=0;e<this.channels.length;e++){const r=this.channels[e];r.isMember(t,i,s,o)&&r.trigger(i,s,n,o)}for(let t=0;t<this.stateChangeCallbacks.message.length;t++){let[,i]=this.stateChangeCallbacks.message[t];i(e)}})}}class b{constructor(e){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=a.connecting,this.poll()}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+u.websocket),"$1/"+u.longpoll)}endpointURL(){return v.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=a.connecting}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==a.open&&this.readyState!==a.connecting||v.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),e=>{if(e){var{status:t,token:i,messages:s}=e;this.token=i}else var t=0;switch(t){case 200:s.forEach(e=>this.onmessage({data:e})),this.poll();break;case 204:this.poll();break;case 410:this.readyState=a.open,this.onopen(),this.poll();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error(`unhandled poll status ${t}`)}})}send(e){v.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),e=>{e&&200===e.status||(this.onerror(e&&e.status),this.closeAndRetry())})}close(e,t){this.readyState=a.closed,this.onclose()}}class v{static request(e,t,i,s,n,r,a){if(o.XDomainRequest){let i=new XDomainRequest;this.xdomainRequest(i,e,t,s,n,r,a)}else{let c=o.XMLHttpRequest?new o.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(c,e,t,i,s,n,r,a)}}static xdomainRequest(e,t,i,s,n,o,r){e.timeout=n,e.open(t,i),e.onload=()=>{let t=this.parseJSON(e.responseText);r&&r(t)},o&&(e.ontimeout=o),e.onprogress=()=>{},e.send(s)}static xhrRequest(e,t,i,s,n,o,r,a){e.open(t,i,!0),e.timeout=o,e.setRequestHeader("Content-Type",s),e.onerror=()=>{a&&a(null)},e.onreadystatechange=()=>{if(e.readyState===this.states.complete&&a){let t=this.parseJSON(e.responseText);a(t)}},r&&(e.ontimeout=r),e.send(n)}static parseJSON(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let i=[];for(var s in e){if(!e.hasOwnProperty(s))continue;let n=t?`${t}[${s}]`:s,o=e[s];"object"==typeof o?i.push(this.serialize(o,n)):i.push(encodeURIComponent(n)+"="+encodeURIComponent(o))}return i.join("&")}static appendParams(e,t){if(0===Object.keys(t).length)return e;let i=e.match(/\?/)?"&":"?";return`${e}${i}${this.serialize(t)}`}}v.states={complete:4};class z{constructor(e,t={}){let i=t.events||{state:"presence_state",diff:"presence_diff"};this.state={},this.pendingDiffs=[],this.channel=e,this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}},this.channel.on(i.state,e=>{let{onJoin:t,onLeave:i,onSync:s}=this.caller;this.joinRef=this.channel.joinRef(),this.state=z.syncState(this.state,e,t,i),this.pendingDiffs.forEach(e=>{this.state=z.syncDiff(this.state,e,t,i)}),this.pendingDiffs=[],s()}),this.channel.on(i.diff,e=>{let{onJoin:t,onLeave:i,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=z.syncDiff(this.state,e,t,i),s())})}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}list(e){return z.list(this.state,e)}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}static syncState(e,t,i,s){let n=this.clone(e),o={},r={};return this.map(n,(e,i)=>{t[e]||(r[e]=i)}),this.map(t,(e,t)=>{let i=n[e];if(i){let s=t.metas.map(e=>e.phx_ref),n=i.metas.map(e=>e.phx_ref),a=t.metas.filter(e=>n.indexOf(e.phx_ref)<0),c=i.metas.filter(e=>s.indexOf(e.phx_ref)<0);a.length>0&&(o[e]=t,o[e].metas=a),c.length>0&&(r[e]=this.clone(i),r[e].metas=c)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:r},i,s)}static syncDiff(e,{joins:t,leaves:i},s,n){let o=this.clone(e);return s||(s=function(){}),n||(n=function(){}),this.map(t,(e,t)=>{let i=o[e];if(o[e]=t,i){let t=o[e].metas.map(e=>e.phx_ref),s=i.metas.filter(e=>t.indexOf(e.phx_ref)<0);o[e].metas.unshift(...s)}s(e,i,t)}),this.map(i,(e,t)=>{let i=o[e];if(!i)return;let s=t.metas.map(e=>e.phx_ref);i.metas=i.metas.filter(e=>s.indexOf(e.phx_ref)<0),n(e,i,t),0===i.metas.length&&delete o[e]}),o}static list(e,t){return t||(t=function(e,t){return t}),this.map(e,(e,i)=>t(e,i))}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static clone(e){return JSON.parse(JSON.stringify(e))}}class y{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}},function(e,t){e.exports={name:"mkz_c_history",getData:function(){var e=localStorage.getItem(this.name),t=[];try{t=JSON.parse(e)||[]}catch(e){}return t},addData:function(e,t){return e.push({muid:t.muid,body:t.body,agent_id:t.agent_id,sent_at:t.sent_at,avatar_url:t.avatar_url}),this.setData(e),e},setData:function(e){return localStorage.setItem(this.name,JSON.stringify(e)),e}}},function(e,t){e.exports={name:"mkz_c_delivered",addItem:function(e){var t=this.getList();return t.push(e),this.setData(t),t},getList:function(){var e=localStorage.getItem(this.name),t=[];try{t=JSON.parse(e)||[]}catch(e){}return t},setList:function(e){return localStorage.setItem(this.name,JSON.stringify(e)),e},resetList:function(){this.setList([])}}},function(e,t,i){"use strict";function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}i.r(t),i.d(t,"default",(function(){return o}));var n=i(6),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collapsed=!0,this.app=t,this.libs=t.libs,this.allowSending=!0}var t,i,o;return t=e,(i=[{key:"bind",value:function(){var e=this;this.libs.domEvent.add(this.elSubmit,"click",this.sendMsg.bind(this)),this.libs.domEvent.add(this.elInput,"keyup",this.setMsgHeight.bind(this)),this.libs.domEvent.add(this.elInput,"keypress",(function(t){13!=t.keyCode||t.shiftKey?e.disableTyping||(clearTimeout(e.timeoutTyping),e.disableTyping=!0,e.timeoutTyping=setTimeout((function(){e.disableTyping=!1,e.sendTyping()}),e.app.settings.typingTimeout)):(t.preventDefault(),e.sendMsg())})),this.libs.domEvent.add(this.elToggle,"click",this.collapse.bind(this)),this.libs.domEvent.add(this.elClose,"click",this.collapse.bind(this))}},{key:"collapse",value:function(){this.collapsed=!this.collapsed,this.collapsed?(this.libs.helpers.removeClass(document.body,"mkz-c-fixed"),this.libs.helpers.addClass(this.elContainer,"mkz-c_collapse_yes")):(this.libs.helpers.addClass(document.body,"mkz-c-fixed"),this.libs.helpers.removeClass(this.elContainer,"mkz-c_collapse_yes")),this.app.handlerCollapse(this.collapsed)}},{key:"sendTyping",value:function(){var e=this.elInput.value;this.app.pusherTyping(e)}},{key:"sendMsg",value:function(){var e=this;if(this.allowSending){var t=this.libs.sanitise(this.elInput.value.trim());t&&(this.app.pusherNewMsg(t).receive("ok",(function(){e.elInput.value=null,e.setMsgHeight(),e.enableSending()})).receive("error",(function(){return e.enableSending.bind(e)})).receive("timeout",(function(){return e.enableSending.bind(e)})),this.disableSending())}}},{key:"setMsgHeight",value:function(){this.elInput.style.height="auto";var e=this.elInput.scrollHeight;this.elInput.style.height=e+"px"}},{key:"disableSending",value:function(){this.allowSending=!1,this.libs.helpers.addClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"enableSending",value:function(){this.allowSending=!0,this.libs.helpers.removeClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"assignAgent",value:function(){this.elAgentName.innerHTML=this.app.currentAgent.name,this.libs.helpers.addClass(this.elContainer,"mkz-c_agent_assign")}},{key:"unassignAgent",value:function(){this.libs.helpers.removeClass(this.elContainer,"mkz-c_agent_assign")}},{key:"onlineAgents",value:function(){this.libs.helpers.addClass(this.elContainer,"mkz-c_agent_online")}},{key:"offlineAgents",value:function(){this.libs.helpers.removeClass(this.elContainer,"mkz-c_agent_online")}},{key:"toggleNotice",value:function(){var e=this;sessionStorage.getItem("mkz_c_tooltip_hidden")||(sessionStorage.setItem("mkz_c_tooltip_hidden",!0),setTimeout((function(){e.showNotice()}),this.app.settings.noticeShowTimeout),setTimeout((function(){e.hideNotice()}),this.app.settings.noticeShowTimeout+this.app.settings.noticeHideTimeout))}},{key:"showNotice",value:function(){this.libs.helpers.addClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"hideNotice",value:function(){this.libs.helpers.removeClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"render",value:function(){this.el||(this.el=this.libs.helpers.appendHTML(document.body,this.htmlTemplate()),this.elContainer=this.el.querySelector(".mkz-c-js"),this.elInput=this.el.querySelector(".mkz-c-js-input"),this.elSubmit=this.el.querySelector(".mkz-c-js-submit"),this.elClose=this.el.querySelector(".mkz-c-js-close"),this.elToggle=this.el.querySelector(".mkz-c-js-toggle"),this.elHistory=this.el.querySelector(".mkz-c-js-history"),this.elScroll=this.el.querySelector(".mkz-c-js-scroll"),this.elAgentName=this.el.querySelector(".mkz-c-js-agent-name"),this.bind(),this.toggleNotice()),this.renderMessages()}},{key:"renderMessages",value:function(){var e=this,t=this.app.history.map((function(t){return e.htmlMessage(t)})).join("");this.elHistory.innerHTML=t}},{key:"scrollBottom",value:function(){var e=this;setTimeout((function(){e.elScroll.scrollTop=e.elScroll.scrollHeight}),0)}},{key:"htmlMessage",value:function(e){var t=e.avatar_url?'<img src="'.concat(e.avatar_url,'" class="mkz-c__i-avatar" alt="" />'):"",i=this.libs.sanitise(e.body).split("\n").join("<br />");return'\n            <div class="mkz-c__i mkz-c__i_type_'.concat(e.agent_id?"agent":"client",'">\n              ').concat(t,'\n              <div class="mkz-c__i-content">\n                <div class="mkz-c__i-msg">\n                  <div class="mkz-c__i-msg-overflow">\n                    ').concat(i,"\n                  </div>\n                </div>\n              </div>\n            </div>")}},{key:"htmlTemplate",value:function(){var e=this.app.settings.whitelabel?"":'\n        <a class="mkz-c__copy" href="https://markeaze.com" target="_blank">\n          <svg width="10" height="8" viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M1.94727 2.8471C2.12716 2.49158 2.57173 2.38949 2.87918 2.63311C3.12176 2.82531 3.19515 3.17138 3.05276 3.45164L1.17079 7.15577C0.991709 7.50824 0.550808 7.60949 0.24532 7.3683C0.0037509 7.17757 -0.0698014 6.83352 0.0713545 6.55454L1.94727 2.8471Z" fill="#FC4566"/>\n            <path d="M5.35667 1.9023C5.54038 1.55555 5.9926 1.45484 6.30746 1.69056C6.55814 1.87824 6.63496 2.21903 6.48885 2.49519L4.02121 7.15912C3.83664 7.50797 3.38122 7.60839 3.06569 7.36982C2.81616 7.18115 2.74036 6.8407 2.88648 6.5649L5.35667 1.9023Z" fill="#0EC52C"/>\n            <path d="M8.81247 0.351483C8.99329 -0.00816918 9.44199 -0.111851 9.75226 0.134322C9.99632 0.327953 10.0705 0.67639 9.92784 0.959046L6.80213 7.15236C6.62323 7.50684 6.18144 7.61011 5.87387 7.36934C5.62976 7.17824 5.55453 6.83147 5.6961 6.54989L8.81247 0.351483Z" fill="#7261FF"/>\n          </svg>\n          '.concat(this.app.settings.copyright,"\n        </a>");return'\n<div mkz-c>\n  <div class="mkz-c mkz-c_collapse_yes mkz-c-js">\n\n    <div class="mkz-c__handler mkz-c__handler_type_'.concat(this.app.settings.iconType," mkz-c__handler_position_").concat(this.app.settings.iconPosition,'" style="margin: ').concat(this.app.settings.margin,'">\n      <div class="mkz-c__tooltip mkz-c__tooltip_picture_yes">\n        <img src="').concat(this.app.settings.noticeIcon,'" class="mkz-c__tooltip-picture" alt="" />\n        <div class="mkz-c__tooltip-text">\n          ').concat(this.app.settings.noticeText,'\n        </div>\n      </div>\n      <div class="mkz-c__btn mkz-c-js-toggle" style="background-color: ').concat(this.app.settings.iconBg,"; color: ").concat(this.app.settings.iconColor,';">\n        <div class="mkz-c__btn-text">').concat(this.app.settings.iconText,'</div>\n        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="mkz-c__btn-picture">\n          <path d="M20.6429 10.4641C20.6466 11.8783 20.3162 13.2733 19.6786 14.5355C18.9226 16.0481 17.7605 17.3204 16.3223 18.2098C14.8841 19.0992 13.2267 19.5706 11.5357 19.5713C10.1216 19.5749 8.72659 19.2445 7.46432 18.607L1.35718 20.6427L3.39289 14.5355C2.75532 13.2733 2.42492 11.8783 2.42861 10.4641C2.42926 8.77313 2.90069 7.11573 3.79009 5.67755C4.67949 4.23937 5.95174 3.07721 7.46432 2.32125C8.72659 1.68368 10.1216 1.35328 11.5357 1.35696H12.0715C14.3047 1.48017 16.414 2.42278 17.9955 4.00431C19.5771 5.58585 20.5197 7.69516 20.6429 9.92839V10.4641Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      </div>\n    </div>\n\n    <div class="mkz-c__chat">\n      <div class="mkz-c__cart">\n        <div class="mkz-c__head">\n          <div class="mkz-c__head-state">\n            <div class="mkz-c__state"></div>\n          </div>\n          <div class="mkz-c__head-m">\n           <div class="mkz-c__m-assign-text mkz-c-js-agent-name"></div>\n           <div class="mkz-c__m-unassign-text">').concat(this.app.settings.offline,'</div>\n          </div>\n          <div class="mkz-c__head-action">\n            <div class="mkz-c__close mkz-c-js-close">\n              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M11.4287 4.57129L4.57153 11.4284" stroke="#787878" stroke-linecap="round" stroke-linejoin="round"/>\n              <path d="M4.57153 4.57129L11.4287 11.4284" stroke="#787878" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n        <div class="mkz-c__content mkz-c-js-scroll">\n          <div class="mkz-c__list mkz-c-js-history"></div>\n        </div>\n        ').concat(e,'\n        <div class="mkz-c__footer">\n          <div class="mkz-c__footer-msg">\n            <textarea class="mkz-c__input mkz-c-js-input" rows="1" placeholder="').concat(this.app.settings.placeholder,'"></textarea>\n          </div>\n          <div class="mkz-c__footer-btn">\n            <div class="mkz-c__submit mkz-c-js-submit">\n              <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18.9675 0.949039L12.9784 17.6706C12.9069 17.8682 12.7194 17.9999 12.5092 18H12.3495C12.1535 18 11.9749 17.8874 11.8903 17.7105L9.53462 12.719C9.18774 11.9831 9.322 11.1103 9.874 10.5128L12.8686 7.23833C13.0524 7.04551 13.0524 6.74232 12.8686 6.5495L12.4893 6.17015C12.2965 5.98633 11.9933 5.98633 11.8005 6.17015L8.52644 9.16505C7.92893 9.71711 7.05625 9.85139 6.32044 9.50447L1.32949 7.14848C1.13702 7.076 1.00706 6.89483 1.00009 6.68926V6.52953C0.982409 6.30492 1.11738 6.09631 1.32949 6.0204L18.0492 0.0306031C18.2289 -0.0354106 18.4306 0.00725579 18.5682 0.140416L18.8278 0.399974C18.9838 0.536262 19.0394 0.754748 18.9675 0.949039Z" fill="currentColor"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <style type="text/css">').concat(n,"</style>\n\n</div>\n    ")}}])&&s(t.prototype,i),o&&s(t,o),e}()},function(e,t){e.exports="[mkz-c] .mkz-c{text-align:left;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;font-size:15px;color:#333}[mkz-c] .mkz-c *{font-family:Geneva,Arial,Helvetica,sans-serif}[mkz-c] .mkz-c_collapse_yes .mkz-c__handler{opacity:1;visibility:visible}[mkz-c] .mkz-c_collapse_yes .mkz-c__chat{opacity:0;visibility:hidden}[mkz-c] .mkz-c_collapse_yes.mkz-c_tooltip_yes .mkz-c__tooltip{opacity:1;visibility:visible}[mkz-c] .mkz-c_agent_assign .mkz-c__m-unassign-text{display:none}[mkz-c] .mkz-c_agent_assign .mkz-c__m-assign-text{display:block}[mkz-c] .mkz-c_agent_online .mkz-c__state{background-color:#0EC52C}[mkz-c] .mkz-c__handler{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;z-index:10000}[mkz-c] .mkz-c__handler_position_l-t{left:0;top:0}[mkz-c] .mkz-c__handler_position_l-t.mkz-c__handler_type_bar{margin-top:0 !important}[mkz-c] .mkz-c__handler_position_r-t{right:0;top:0}[mkz-c] .mkz-c__handler_position_r-t.mkz-c__handler_type_bar{margin-top:0 !important}[mkz-c] .mkz-c__handler_position_l-b{left:0;bottom:0}[mkz-c] .mkz-c__handler_position_l-b.mkz-c__handler_type_bar{margin-bottom:0 !important}[mkz-c] .mkz-c__handler_position_r-b{right:0;bottom:0}[mkz-c] .mkz-c__handler_position_r-b.mkz-c__handler_type_bar{margin-bottom:0 !important}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__btn{width:50px;height:50px;border-radius:50%;background-color:#eee;color:#000;display:flex;align-items:center;justify-content:center;transition:transform 0.2s linear;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__btn:hover{transform:scale(1.1)}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__btn-text{display:none}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__tooltip{position:absolute;right:100%;top:50%;margin-right:15px;transform:translateY(-50%);box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#4F4F4F;padding:5px;border-radius:6px 0 0 6px;width:160px;box-sizing:border-box}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__tooltip:after{content:'';position:absolute;right:-10px;top:0;bottom:0;width:10px;clip-path:polygon(0 0, 0 0, 100% 50%, 0 100%);background:#4F4F4F;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__tooltip_picture_yes{padding-left:40px}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__tooltip-text{font-size:12px;line-height:16px;text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis}[mkz-c] .mkz-c__handler_type_bubble .mkz-c__tooltip-picture{position:absolute;left:-35px;top:50%;transform:translateY(-50%);max-width:79px}[mkz-c] .mkz-c__handler_type_bar .mkz-c__tooltip-picture{display:none}[mkz-c] .mkz-c__handler_type_bar .mkz-c__btn{display:flex;align-items:center;padding:8px 20px;border-radius:15px 15px 0 0;transition:padding 0.2s linear}[mkz-c] .mkz-c__handler_type_bar .mkz-c__btn:hover{padding-bottom:20px}[mkz-c] .mkz-c__handler_type_bar .mkz-c__btn-text{flex:1;font-size:13px;line-height:18px;font-weight:600;white-space:nowrap;max-width:160px;overflow:hidden;text-overflow:ellipsis}[mkz-c] .mkz-c__handler_type_bar .mkz-c__btn-picture{flex:0 0 14px;height:14px;margin-left:5px}[mkz-c] .mkz-c__handler_type_bar .mkz-c__tooltip{position:absolute;bottom:100%;right:0;margin-bottom:25px;box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#7261FF;padding:30px 5px;border-radius:6px 6px 0 0;min-width:47px;max-width:160px;box-sizing:border-box;font-weight:600;font-size:13px;line-height:18px}[mkz-c] .mkz-c__handler_type_bar .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;top:100%;height:20px;clip-path:polygon(0 0, 50% 100%, 100% 0, 0 0);background:#7261FF;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz-c] .mkz-c__tooltip{opacity:0;visibility:hidden;transition:opacity 0.2s linear, visibility 0.4s 0s linear}[mkz-c] .mkz-c__submit{cursor:pointer;transition:all linear 0.2s;opacity:1;color:#7261FF}[mkz-c] .mkz-c__submit_disabled_yes{cursor:default;opacity:0.5}[mkz-c] .mkz-c__chat{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:1;visibility:visible;position:fixed;right:0;bottom:0;width:100%;max-width:400px;max-height:800px;height:100vh;z-index:10000}[mkz-c] .mkz-c__cart{position:absolute;left:0;top:20px;right:20px;bottom:20px;display:flex;justify-content:stretch;flex-direction:column;background-color:#fff;border:1px solid #CBCBCB;border-radius:3px;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz-c] .mkz-c__head,[mkz-c] .mkz-c__content,[mkz-c] .mkz-c__copy,[mkz-c] .mkz-c__footer{padding:0 20px}[mkz-c] .mkz-c__head,[mkz-c] .mkz-c__copy,[mkz-c] .mkz-c__footer{flex:0;padding:0 20px}[mkz-c] .mkz-c__content,[mkz-c] .mkz-c__copy{background-color:#FAFAFA}[mkz-c] .mkz-c__content{flex:1;overflow:hidden;overflow-y:auto}[mkz-c] .mkz-c__head{display:flex;align-items:center;border-bottom:1px solid #CBCBCB;padding-top:5px;padding-bottom:5px}[mkz-c] .mkz-c__head-state{flex:0;padding-right:12px}[mkz-c] .mkz-c__head-m{flex:1}[mkz-c] .mkz-c__head-action{flex:0;padding-left:12px}[mkz-c] .mkz-c__copy{text-align:center;font-size:8px;line-height:24px;display:block;color:#000;text-decoration:none}[mkz-c] .mkz-c__copy:hover{text-decoration:none}[mkz-c] .mkz-c__m-assign-text,[mkz-c] .mkz-c__m-unassign-text{font-weight:600;font-size:13px;line-height:1.2em}[mkz-c] .mkz-c__m-assign-text{display:none}[mkz-c] .mkz-c__close{cursor:pointer;padding:10px;margin:0 -10px}[mkz-c] .mkz-c__footer{border-top:1px solid #CBCBCB}[mkz-c] .mkz-c__state{width:10px;height:10px;border-radius:50%;background-color:red;transition:background 0.5s linear}[mkz-c] .mkz-c__footer{display:flex;align-items:center;padding-top:10px;padding-bottom:10px}[mkz-c] .mkz-c__footer-msg{flex:1}[mkz-c] .mkz-c__footer-btn{flex:0}[mkz-c] .mkz-c__input{display:block;width:100%;resize:none;padding:0;font-size:10px;line-height:1.2em;font-family:Geneva,Arial,Helvetica,sans-serif;color:#000;border-style:none;outline-style:none;background-color:transparent;overflow:hidden;max-height:50vh}[mkz-c] .mkz-c__btn{color:#7261FF;cursor:pointer}[mkz-c] .mkz-c__list{padding:20px 0}[mkz-c] .mkz-c__i{display:flex;margin:20px 0}[mkz-c] .mkz-c__i_type_client{flex-direction:row-reverse}[mkz-c] .mkz-c__i_type_client .mkz-c__i-avatar{display:none;background-color:#E7FEEA}[mkz-c] .mkz-c__i_type_client .mkz-c__i-msg{background-color:#fff}[mkz-c] .mkz-c__i-content{max-width:100%}[mkz-c] .mkz-c__i-avatar{width:24px;height:24px;border-radius:50%;margin:0 5px 0 0}[mkz-c] .mkz-c__i-msg{text-align:left;background-color:#E7FEEA;border-radius:6px;padding:5px 10px;box-shadow:0px 0px 4px rgba(0,0,0,0.12),0px 0px 1px rgba(0,0,0,0.48);font-size:10px;line-height:1.5em}[mkz-c] .mkz-c__i-msg-overflow{overflow:hidden;text-overflow:ellipsis}@media (max-width: 600px){[mkz-c] .mkz-c-fixed{overflow:hidden !important;position:fixed !important;left:0 !important;top:0 !important;right:0 !important;bottom:0 !important}[mkz-c] .mkz-c__chat{max-width:none}[mkz-c] .mkz-c__cart{right:0;top:0;bottom:0;border-style:none}}\n"}]);