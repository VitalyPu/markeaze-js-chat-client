!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(13),s=n(14),o=n(15),r=n(17);t.exports=function(t,e){return i(t)||s(t,e)||o(t,e)||r()}},function(t,e,n){var i=n(4);t.exports={name:"mkz_c_msg_history",cached:!1,history:[],getHistory:function(){if(this.cached&&i.cached)return this.history;this.cached=!0;var t=localStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return this.history=this.sortHistory(e.concat(i.getHistory())),this.history},saveHistory:function(t){return this.cached=!1,localStorage.setItem(this.name,JSON.stringify(t.filter((function(t){return!t.exclude})))),t},addMsg:function(t){var e=this.getHistory(),n=this.findMsgIndex(t.muid),i={muid:t.muid,msg_type:t.msg_type,text:t.text,custom_fields:t.custom_fields,agent_id:t.agent_id,sender_type:t.sender_type,sent_at:t.sent_at,sender_avatar_url:t.sender_avatar_url,sender_name:t.sender_name,attachments:t.attachments,exclude:t.exclude};-1===n?e.push(i):e[n]=i,this.saveHistory(e)},getNextMsg:function(t){var e=this.findMsgIndex(t),n=this.getHistory();if(n[e+1])return n[e+1]},batchUpdateMsg:function(t,e){var n=this.getHistory(),i=n.filter(t);return i.map(e),this.saveHistory(n),i},findMsgIndex:function(t){return this.getHistory().findIndex((function(e){return e.muid===t}))},findMsg:function(t){return this.getHistory().find((function(e){return e.muid===t}))},sortHistory:function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],s=e;s>0&&new Date(t[s-1].sent_at)>new Date(i.sent_at);)t[s]=t[s-1],s--;t[s]=i}return t}}},function(t,e,n){function i(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,r=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var o=n(11);t.exports={cached:!1,init:function(t){var e=this;this.app=t,this.libs=t.libs,this.cached=!1,this.items=o.getItems(),this.rendered=!1,this.libs.eEmit.subscribe("plugin.chat.auto_messages",this.saveItems.bind(this)),this.libs.eEmit.subscribe("plugin.chat.channel.entered",(function(){e.rendered=!0,e.renderNewItems()}))},getHistory:function(){return this.cached=!0,this.items.map((function(t){return t.payload}))},saveItems:function(t){var e=this;if(0!==t.length){this.cached=!1;var n=this.app.store.uid;this.items=o.addItems(t.map((function(t){var i=e.app.getDateTime(),s=+new Date(i);return{payload:{auto_message_uid:t.uid,agent_id:t.sender_id,attachments:[],muid:"".concat(n,":a:").concat(s),msg_type:"message:auto",sender_type:t.sender_type,sender_avatar_url:null,sender_name:null,sent_at:i,text:t.text,exclude:!0,custom_fields:t},state:"new",sent_at:i}}))),this.rendered&&this.renderNewItems()}},renderNewItems:function(){var t=this.items.filter((function(t){return"new"===t.state}));if(0!==t.length){this.cached=!1;var e,n=i(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;this.app.addMsg(s.payload),this.app.view.scrollBottom(),this.app.setCurrentAgent(s.payload.agent_id),this.trackShow(s.payload.custom_fields.uid),s.state="sent"}}catch(t){n.e(t)}finally{n.f()}this.app.view.showChat(),o.setItems(this.items)}},getMsgAgentId:function(t){var e=this.items.find((function(e){return e.payload.muid===t}));return e&&e.payload.agent_id||0},removeItem:function(t){this.cached=!1,this.items=o.removeItem(t)},trackShow:function(t){mkz("trackAutoMessageShow",{auto_message_uid:t})},trackReply:function(t){var e=this.items.find((function(e){return e.payload.muid===t}));if(e){var n=e.payload.custom_fields;mkz("trackAutoMessageReply",{auto_message_uid:n.uid,reply_text:n.text,reply_once:n.reply_once})}}}},function(t,e){t.exports={name:"mkz_c_delivered",addItem:function(t){var e=this.getList();return e.push(t),this.setList(e),e},getList:function(){var t=localStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return e},setList:function(t){return localStorage.setItem(this.name,JSON.stringify(t)),t},resetList:function(){this.setList([])}}},function(t,e){t.exports="[mkz]{line-height:1}[mkz] html,[mkz] body,[mkz] div,[mkz] span,[mkz] applet,[mkz] object,[mkz] iframe,[mkz] h1,[mkz] h2,[mkz] h3,[mkz] h4,[mkz] h5,[mkz] h6,[mkz] p,[mkz] blockquote,[mkz] pre,[mkz] a,[mkz] abbr,[mkz] acronym,[mkz] address,[mkz] big,[mkz] cite,[mkz] code,[mkz] del,[mkz] dfn,[mkz] em,[mkz] img,[mkz] ins,[mkz] kbd,[mkz] q,[mkz] s,[mkz] samp,[mkz] small,[mkz] strike,[mkz] strong,[mkz] sub,[mkz] sup,[mkz] tt,[mkz] var,[mkz] b,[mkz] u,[mkz] i,[mkz] center,[mkz] dl,[mkz] dt,[mkz] dd,[mkz] ol,[mkz] ul,[mkz] li,[mkz] fieldset,[mkz] form,[mkz] label,[mkz] legend,[mkz] table,[mkz] caption,[mkz] tbody,[mkz] tfoot,[mkz] thead,[mkz] tr,[mkz] th,[mkz] td,[mkz] article,[mkz] aside,[mkz] canvas,[mkz] details,[mkz] embed,[mkz] figure,[mkz] figcaption,[mkz] footer,[mkz] header,[mkz] hgroup,[mkz] menu,[mkz] nav,[mkz] output,[mkz] ruby,[mkz] section,[mkz] summary,[mkz] time,[mkz] mark,[mkz] audio,[mkz] video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;color:inherit;font-weight:inherit;text-transform:inherit;max-width:none}[mkz] label,[mkz] legend{width:auto;height:auto}[mkz] input,[mkz] select,[mkz] textarea,[mkz] button{margin:0;padding:0;font-size:100%;font:inherit;vertical-align:baseline;background-image:none;outline:none}[mkz] article,[mkz] aside,[mkz] details,[mkz] figcaption,[mkz] figure,[mkz] footer,[mkz] header,[mkz] hgroup,[mkz] menu,[mkz] nav,[mkz] section{display:block}[mkz] ol,[mkz] ul{list-style:none}[mkz] blockquote,[mkz] q{quotes:none}[mkz] blockquote:before,[mkz] blockquote:after,[mkz] q:before,[mkz] q:after{content:'';content:none}[mkz] table{border-collapse:collapse;border-spacing:0}[mkz] .mkz-c{text-align:left;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;font-size:15px;color:#333}[mkz] .mkz-c *{font-family:Geneva,Arial,Helvetica,sans-serif;-webkit-tap-highlight-color:transparent}[mkz] .mkz-c_chat_show .mkz-c__chat{opacity:1;visibility:visible}[mkz] .mkz-c_beacon_show .mkz-c__handler{opacity:1;visibility:visible}[mkz] .mkz-c_beacon_show.mkz-c_tooltip_yes .mkz-c__tooltip{opacity:1;visibility:visible}[mkz] .mkz-c_agent_assign .mkz-c__m-unassign-text{display:none}[mkz] .mkz-c_agent_assign .mkz-c__m-assign-text,[mkz] .mkz-c_agent_assign .mkz-c__m-assign-post,[mkz] .mkz-c_agent_assign .mkz-c__m-assign-avatar{display:block}[mkz] .mkz-c_agent_online .mkz-c__state{background-color:#0EC52C}[mkz] .mkz-c_agent_online .mkz-c__btn-text-online{display:block}[mkz] .mkz-c_agent_online .mkz-c__btn-text-offline{display:none}[mkz] .mkz-c__handler{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;z-index:10000}[mkz] .mkz-c__handler_position_l-t{left:0;top:0}[mkz] .mkz-c__handler_position_r-t{right:0;top:0}[mkz] .mkz-c__handler_position_l-b{left:0;bottom:0}[mkz] .mkz-c__handler_position_r-b{right:0;bottom:0}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip{left:100%;right:auto;margin-left:15px;margin-right:0;border-radius:0 6px 6px 0}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:after{left:-10px;right:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:before,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:before{left:-1px;right:auto}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip_picture_yes,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip_picture_yes{padding-left:5px;padding-right:40px}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip-picture,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip-picture{position:absolute;left:auto;right:-35px}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn{width:60px;height:60px;border-radius:50%;background-color:#eee;color:#000;display:flex;align-items:center;justify-content:center;transition:transform 0.2s linear;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn:hover{transform:scale(1.1)}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-text{display:none}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip{position:absolute;right:100%;top:50%;margin-right:15px;transform:translateY(-50%);box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#4F4F4F;padding:5px;border-radius:6px 0 0 6px;width:160px;box-sizing:border-box}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:after{content:'';position:absolute;right:-10px;top:0;bottom:0;width:10px;clip-path:polygon(0 0, 0 0, 100% 50%, 0 100%);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:before{content:'';position:absolute;right:-1px;top:1px;bottom:1px;width:2px;background:inherit}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip_picture_yes{padding-left:40px}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-text{font-size:12px;line-height:16px;text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-picture{position:absolute;left:-35px;top:50%;transform:translateY(-50%);max-width:79px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t{margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t{margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-b{margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-b{margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn{border-radius:0 0 15px 15px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn:hover,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn:hover{padding-top:20px;padding-bottom:8px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip{bottom:auto;top:100%;margin-top:25px;margin-bottom:0;border-radius:0 0 6px 6px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;bottom:100%;top:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__btn,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__btn{border-radius:0 0 15px 15px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__btn:hover,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__btn:hover{padding-top:20px;padding-bottom:8px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__tooltip{bottom:auto;top:100%;margin-top:25px;margin-bottom:0;border-radius:0 0 6px 6px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;bottom:100%;top:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t{right:0;top:0;margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l{transform:rotate(-90deg) translateX(-100%);transform-origin:0 0;left:0;top:0;margin-left:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r{transform:rotate(-90deg) translateY(-100%);transform-origin:100% 0;right:0;top:0;margin-right:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_b{right:0;bottom:0;margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip-picture{display:none}[mkz] .mkz-c__handler_type_bar .mkz-c__btn{display:flex;align-items:center;padding:8px 20px;border-radius:15px 15px 0 0;transition:padding 0.2s ease-out}[mkz] .mkz-c__handler_type_bar .mkz-c__btn:hover{padding-bottom:20px}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text{flex:1;font-size:14px;line-height:18px;font-weight:600;max-width:230px;min-height:18px}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-online,[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-offline{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-picture{flex:0 0 14px;height:14px;margin-left:5px}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip{position:absolute;bottom:100%;right:0;margin-bottom:25px;box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#7261FF;padding:30px 5px;border-radius:6px 6px 0 0;min-width:47px;max-width:80px;box-sizing:border-box;font-weight:600;font-size:16px;line-height:18px;text-align:center}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;top:100%;height:20px;clip-path:polygon(0 0, 50% 100%, 100% 0, 0 0);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25);margin:-1px 0}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip .mkz-c__tooltip-text{overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__btn-text-online{display:none}[mkz] .mkz-c__btn-text-offline{display:block}[mkz] .mkz-c__tooltip{opacity:0;visibility:hidden;transition:opacity 0.2s linear, visibility 0.4s 0s linear}[mkz] .mkz-c__submit{cursor:pointer;transition:all linear 0.2s;opacity:1;color:#787878}[mkz] .mkz-c__submit_disabled_yes{cursor:default;opacity:0.5}[mkz] .mkz-c__chat{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;right:0;bottom:0;width:100%;max-width:375px;max-height:800px;height:100vh;z-index:10000}[mkz] .mkz-c__chat_position_left{left:0;right:auto}[mkz] .mkz-c__chat_position_left .mkz-c__cart,[mkz] .mkz-c__chat_position_left .mkz-c__cart-shadow{right:0;left:25px}[mkz] .mkz-c__cart,[mkz] .mkz-c__cart-shadow{position:absolute;left:0;top:25px;right:25px;bottom:25px;display:flex;justify-content:stretch;flex-direction:column;border-radius:6px;z-index:5}[mkz] .mkz-c__cart-shadow{z-index:0;box-shadow:0 0 10px rgba(25,25,29,0.25);opacity:0.75}[mkz] .mkz-c__head,[mkz] .mkz-c__content,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{padding:0 15px}[mkz] .mkz-c__head,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{flex:0}[mkz] .mkz-c__content,[mkz] .mkz-c__docs{background-color:#fff}[mkz] .mkz-c__content{flex:1;overflow:hidden;overflow-y:auto}[mkz] .mkz-c__head{display:flex;align-items:center;border-bottom:1px solid #E0E0E0;padding-top:5px;padding-bottom:5px;border-radius:6px 6px 0 0;min-height:60px;box-sizing:border-box}[mkz] .mkz-c__head-state{flex:0;padding-right:12px}[mkz] .mkz-c__head-m{flex:1}[mkz] .mkz-c__head-action{flex:0;padding-left:12px}[mkz] .mkz-c__copy{position:absolute;left:0;bottom:0;right:0;text-align:center;font-size:11px;line-height:24px;display:block;color:#787878;text-decoration:none;text-shadow:0 0 1px #fff}[mkz] .mkz-c__copy:hover{text-decoration:none}[mkz] .mkz-c__m-assign-text,[mkz] .mkz-c__m-unassign-text{font-weight:600;font-size:14px;line-height:1.2em}[mkz] .mkz-c__m-assign-post{font-size:11px;line-height:1.2em}[mkz] .mkz-c__m-assign-text,[mkz] .mkz-c__m-assign-post,[mkz] .mkz-c__m-assign-avatar{display:none}[mkz] .mkz-c__m-assign-avatar{width:40px;height:40px;border-radius:50%}[mkz] .mkz-c__close{cursor:pointer;padding:10px;margin:0 -10px;opacity:0.7;transition:all linear 0.2s}[mkz] .mkz-c__close:hover{opacity:1}[mkz] .mkz-c__state-wrap{position:relative;min-width:10px;min-height:10px}[mkz] .mkz-c__state{position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background-color:red;transition:background 0.5s linear;box-shadow:0 0 1px 1px #fff}[mkz] .mkz-c__footer{border-top:1px solid #E0E0E0;display:flex;align-items:center;padding-top:20px;padding-bottom:20px;background-color:#fff;border-radius:0 0 6px 6px}[mkz] .mkz-c__footer-msg{flex:1}[mkz] .mkz-c__footer-btn{flex:0;display:none}[mkz] .mkz-c__input{display:block;width:100%;resize:none;padding:0;font-size:13px;line-height:1.2em;font-family:Geneva,Arial,Helvetica,sans-serif;color:#000;border-style:none;outline-style:none;background-color:transparent;overflow:hidden;max-height:50vh;min-height:18px;height:0}[mkz] .mkz-c__btn{color:#7261FF;cursor:pointer}[mkz] .mkz-c__btn-unread{background-color:red;width:16px;height:16px;font-size:8px;line-height:16px;text-align:center;color:#fff;overflow:hidden;position:absolute;right:-5px;top:-5px;border-radius:50%;box-shadow:0 0 1px 2px #fff}[mkz] .mkz-c__list{padding:20px 0}[mkz] .mkz-c__i{display:flex;margin:20px 0}[mkz] .mkz-c__i-avatar{flex:0 0 24px;margin:0 5px 0 0}[mkz] .mkz-c__i_type_client{flex-direction:row-reverse}[mkz] .mkz-c__i_type_client .mkz-c__i-avatar{display:none;background-color:#E7FEEA}[mkz] .mkz-c__i_type_client .mkz-c__i-msg{background-color:#fff;border-radius:6px 6px 0 6px}[mkz] .mkz-c__i-content{max-width:100%;display:flex;flex-direction:column;align-items:flex-start}[mkz] .mkz-c__i-content a{color:inherit;text-decoration:underline}[mkz] .mkz-c__i-content a:hover{color:inherit;text-decoration:none}[mkz] .mkz-c__i-avatar-img{width:24px;height:24px;border-radius:50%}[mkz] .mkz-c__i-msg{text-align:left;background-color:#E7FEEA;border-radius:6px 6px 6px 0;padding:8px 15px;box-shadow:0px 0px 4px rgba(0,0,0,0.12),0px 0px 1px rgba(0,0,0,0.48);font-size:13px;line-height:1.5em}[mkz] .mkz-c__i-msg:not(:last-child){margin-bottom:15px}[mkz] .mkz-c__i-msg-overflow{overflow:hidden;text-overflow:ellipsis;padding:0 1px;margin:0 -1px}[mkz] .mkz-c-o__i{width:230px}[mkz] .mkz-c-o__i:not(:last-child){margin-bottom:20px}[mkz] .mkz-c-o__content{padding:20px;border:1px solid #E0E0E0;border-radius:6px}[mkz] .mkz-c-o__preview-link{display:flex;align-items:center;justify-content:center;height:104px;margin-bottom:10px}[mkz] .mkz-c-o__preview-img{display:block;max-width:100%;max-height:100%;color:#787878}[mkz] .mkz-c-o__name{font-size:13px;line-height:18px;margin-bottom:10px}[mkz] .mkz-c-o__name-link{color:#000;text-decoration:none;cursor:pointer}[mkz] .mkz-c-o__name-link:hover{text-decoration:underline}[mkz] .mkz-c-o__info{display:flex;align-items:baseline;margin-bottom:15px}[mkz] .mkz-c-o__info-price,[mkz] .mkz-c-o__info-avaliable{flex:1}[mkz] .mkz-c-o__info-price{font-weight:600;font-size:16px;line-height:1.2em;padding-right:10px}[mkz] .mkz-c-o__info-avaliable{text-align:right;font-size:12px;line-height:1.2em;white-space:nowrap}[mkz] .mkz-c-o__info-avaliable_color_green{color:#37833B}[mkz] .mkz-c-o__info-avaliable_color_red{color:#FC4566}[mkz] .mkz-c-o__btn{font-weight:600;font-size:13px;line-height:1.2em;color:#fff;background-color:#FF6575;border-radius:99px;padding:8px 15px;text-align:center;display:block;outline-style:none;text-decoration:none;cursor:pointer}[mkz] .mkz-c-o__btn[disabled],[mkz] .mkz-c-o__btn[disabled]:hover{background-color:#DF4555;cursor:default}[mkz] .mkz-c-o__btn:hover{text-decoration:none;background-color:#EF5565}[mkz] .mkz-c-o__counter{font-size:10px;line-height:18px;padding:3px 10px;color:#787878}[mkz] .mkz-c-docs{margin:10px -3px;overflow:hidden}[mkz] .mkz-c-docs__list{display:flex}[mkz] .mkz-c-docs__i{flex:1;padding:0 3px;box-sizing:border-box}[mkz] .mkz-c-docs__btn{cursor:pointer;font-size:11px;line-height:1.2em;color:#000;background-color:#F0F0F1;border:1px solid #E0E0E0;border-radius:10px;text-align:center;padding:4px 15px;display:block;width:100%;box-sizing:border-box;white-space:nowrap}[mkz] .mkz-c-docs__btn:hover{background-color:#E0E0E1}[mkz] .mkz-f{width:230px;margin:0;padding:5px 0}[mkz] .mkz-f__row:not(:last-child){margin-bottom:10px}[mkz] .mkz-f__label{display:block;font-size:14px;line-height:1.2em;margin-bottom:4px}[mkz] .mkz-f__input,[mkz] .mkz-f__select{display:block;width:100%;box-sizing:border-box;resize:none;padding:0 0 0 10px;font-size:13px;line-height:30px;font-family:Geneva,Arial,Helvetica,sans-serif;color:#000;outline-style:none;background-color:#fff;border-radius:6px;border:1px solid #CBCBCB;overflow:hidden}[mkz] .mkz-f__input[disabled],[mkz] .mkz-f__select[disabled]{color:#777;background-color:#eee}[mkz] .mkz-f__select{appearance:none;-moz-appearance:none;-webkit-appearance:none;position:relative;background-image:url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='50' fill='%23000000'><polygon points='0,0 100,0 50,50'/></svg>\");background-repeat:no-repeat;background-position:calc(100% - 10px) center;background-size:10px}[mkz] .mkz-f__note{font-size:9px;line-height:1.2em;text-align:center}[mkz] .mkz-f__btn{display:block;width:100%;box-sizing:border-box;font-weight:600;font-size:13px;line-height:1.2em;color:#fff;background-color:#7261FF;border-radius:6px;border-style:none;padding:8px 15px;text-align:center;outline-style:none;text-decoration:none;cursor:pointer;text-transform:uppercase}[mkz] .mkz-f__btn[disabled],[mkz] .mkz-f__btn[disabled]:hover{background-color:#6251EF;color:#aaa;cursor:default}[mkz] .mkz-f__btn:hover{text-decoration:none;background-color:#6251EF}[mkz] .mkz-f__invalid,[mkz] .mkz-f__invalid::placeholder{color:red !important;box-shadow:0 0 1px 1px red !important}@media (max-width: 600px){[mkz] .mkz-c__chat{max-height:none;max-width:none;width:auto;height:auto;right:0;left:0;top:0;bottom:0}[mkz] .mkz-c__cart,[mkz] .mkz-c__chat_position_left .mkz-c__cart{right:0;left:0;top:0;bottom:0;border-style:none}[mkz] .mkz-c__cart,[mkz] .mkz-c__head,[mkz] .mkz-c__footer{border-radius:0}[mkz] .mkz-c__footer-btn{display:block}[mkz] .mkz-c__copy{display:none}}@media (max-width: 600px){.mkz-c-fixed{position:fixed !important;height:100% !important;width:100% !important;max-width:100% !important;overflow-x:hidden !important}.mkz-c-fixed body{z-index:auto !important;zoom:1 !important;max-width:100% !important;overflow-x:hidden !important}}\n"},function(t,e){t.exports={removeClass:function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},appendHTML:function(t,e){var n=document.createElement("div");n.innerHTML=e;var i=this.getFirstChild(n);return t.appendChild(i),i},beforeHTML:function(t,e){var n=document.createElement("div");n.innerHTML=e;var i=this.getFirstChild(n);return t.parentNode.insertBefore(i,t),i},getFirstChild:function(t){for(var e=t.firstChild;null!=e&&3==e.nodeType;)e=e.nextSibling;return e},htmlToText:function(t){var e=document.createElement("div");return e.textContent=t||"",e.innerHTML},srcset:function(t){var e=function(t,e){var n=t.split("/"),i=n.length-1;return n[i]="x".concat(e,"_").concat(n[i]),"".concat(n.join("/")," ").concat(e,"x")};return"".concat(e(t,2),", ").concat(e(t,3))},linkify:function(t){getAttrs=function(t){var e=window.location.host.replace(/^www\./i,"").replace(/:[0-9]+/i,"");return t.indexOf(e)>-1?"":' target="_blank"'};return t=(t=(t=t.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,(function(t,e){return'<a href="'.concat(e,'"').concat(getAttrs(e),">").concat(e,"</a>")}))).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,(function(t,e,n){return"".concat(e,'<a href="http://').concat(n,'"').concat(getAttrs(n),">").concat(n,"</a>")}))).replace(/(([a-zA-Z_-]+\.)*[a-zA-Z_-]+@([a-zA-Z_-]+\.)*[a-zA-Z_-]+\.[a-zA-Z]{2,6})/gim,'<a href="mailto:$1">$1</a>')},br:function(t){return(t||"").split("\n").join("<br />")},htmlFormatting:function(t){return this.linkify(this.br(t))},textFormatting:function(t){return this.htmlFormatting(this.htmlToText(t))}}},function(t,e,n){function i(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,r=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw o}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var o=n(10).Socket,r=n(3),a=n(5),c=n(12).default,l=n(4),h=n(21),d=n(22).default;t.exports={version:"1.3.10",store:{},libs:{},previewMode:!1,create:function(t,e){this.destroy(),this.settings=e,this.locale=t,this.log("chat","created"),this.view=new c(this),this.sound=new d(this.settings.appearance.client_sound_path),l.init(this),this.libs.eEmit.subscribe("plugin.chat.show",this.view.showChat.bind(this.view)),this.libs.eEmit.subscribe("plugin.chat.hide",this.view.hideChat.bind(this.view)),this.createConnection()},destroy:function(){this.view&&this.view.destroy(),this.socket&&this.socket.disconnect()},preview:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.previewMode=!0,this.settings=e,this.locale=t,this.view=new c(this),this.view.history=n.history||[],this.view.width=n.width||null,this.view.render(),n.collapsed?this.view.showNotice():this.view.showChat(),n.currentAgent&&(this.currentAgent=n.currentAgent,this.view.assignAgent(),this.updateAgentState())},currentAgent:null,agents:[],agentIsOnline:!1,sessionsCount:0,settings:{},locale:null,log:function(){var t;this.libs.log&&(t=this.libs.log).push.apply(t,["chat"].concat(Array.prototype.slice.call(arguments)))},createConnection:function(){var t=this;this.socket=new o("//".concat(this.store.chatEndpoint,"/socket")),this.socket.onOpen(this.handlerConnected.bind(this)),this.socket.onClose(this.handlerDisconnected.bind(this)),this.socket.connect(),this.servicChannel=this.socket.channel("chat-client:".concat(this.store.appKey)),this.servicChannel.join().receive("error",(function(){return console.error("Cannot join channel ".concat(t.servicChannel.topic))})),this.servicChannel.on("agent:entered",this.handlerAgentStatus.bind(this,!0)),this.servicChannel.on("agent:exited",this.handlerAgentStatus.bind(this,!1)),this.clientChannel=this.socket.channel("room:".concat(this.store.appKey,":").concat(this.store.uid)),this.clientChannel.join().receive("ok",this.handlerJoined.bind(this)).receive("error",this.handlerFailJoined.bind(this)),this.clientChannel.on("client:entered",this.handlerClientEntered.bind(this)),this.clientChannel.on("message:new",this.handlerMsg.bind(this)),this.clientChannel.on("message:resend",this.handlerMsgResend.bind(this)),this.clientChannel.on("agent:assign",this.handlerAgentAssign.bind(this)),this.clientChannel.on("survey:show",this.handlerSurveyShow.bind(this)),this.clientChannel.on("event:survey_submitted",this.handlerSurveySubmitted.bind(this))},handlerConnected:function(){this.view.connected()},handlerDisconnected:function(){this.view.disconnected()},handlerJoined:function(){this.view.render(),this.view.scrollBottom(),this.view.enableSending(),this.log("chat","joined")},handlerFailJoined:function(){console.error("Cannot join channel ".concat(this.clientChannel.topic))},handlerAgentStatus:function(t,e){var n=e.agent_id,i=this.getAgent(n);i&&(i.isOnline=t,this.updateAgentState())},handlerClientEntered:function(t){this.setAgents(t.agents),this.sessionsCount=t.sessionsCount,this.setCurrentAgent(t.current_agent_id),this.updateAgentState(),this.libs.eEmit&&this.libs.eEmit.emit("plugin.chat.channel.entered"),this.log("chat","ClientEntered",t)},handlerSurveyShow:function(t){this.view.windowFocus&&h.trackShow(t.custom_fields.uid),this.handlerMsg(t)},handlerMsg:function(t){t=this.addMsg(t),this.stateChangeMsg(t),this.view.scrollBottom(),this.log("chat","Msg",t)},handlerMsgResend:function(t){t=this.addMsg(t),this.stateChangeMsg(t),this.view.scrollBottom(),this.setCurrentAgent(t.current_agent_id),this.log("chat","Resend",t)},handlerAgentAssign:function(t){this.setCurrentAgent(t.target_agent_id)},handlerCollapse:function(t){if(!0!==t){var e,n=i(a.getList());try{for(n.s();!(e=n.n()).done;){var s=e.value;this.pusherMsgState(s,"read")}}catch(t){n.e(t)}finally{n.f()}a.resetList(),this.view.renderUnread()}},handlerSurveySubmitted:function(t){var e=this,n=r.findMsg(t.custom_fields.muid);n&&(n.custom_fields.submitted=!0,r.addMsg(n),this.view.renderMessage(n),r.batchUpdateMsg((function(t){return t.muid!==n.muid&&"survey:show"===t.msg_type&&t.custom_fields.uid===n.custom_fields.uid}),(function(t){return t.custom_fields.hidden=!0})).map((function(t){return e.view.renderMessage(t)})))},pusherTyping:function(t){if(t)return this.clientChannel.push("client:activity",{type:"typing",text:t})},pusherNewMsg:function(t){if(t){var e=+new Date,n=this.store.uid,i={muid:"".concat(n,":c:").concat(e),text:t,status:"sent",sent_at:this.getDateTime()},s=r.getHistory(),o=s.length>0&&s[s.length-1];return o&&"message:auto"===o.msg_type&&(i.prev_auto_message={auto_message_uid:o.auto_message_uid,muid:o.muid,agent_id:0,text:o.text,sender_type:"auto",status:"read",sent_at:o.sent_at,device_uid:n},l.trackReply(o.muid)),this.clientChannel.push("message:new",i)}},pusherMsgState:function(t,e){t&&this.clientChannel.push("message:status:change",{muid:t,new_status:e,sent_at:this.getDateTime()})},pusherNewSurveyMsg:function(t,e){var n=r.findMsg(t);n&&(this.clientChannel.push("survey:submit",{muid:t,title:n.custom_fields.title}),h.trackSubmit(n.custom_fields.uid,e))},getDateTime:function(){return(new Date).toISOString().replace("Z","000Z")},stateChangeMsg:function(t){null!==t.agent_id&&(!1===this.view.collapsed?this.pusherMsgState(t.muid,"read"):(this.pusherMsgState(t.muid,"delivered"),a.addItem(t.muid)))},addMsg:function(t){if("auto"===t.sender_type&&(t.agent_id=l.getMsgAgentId(t.muid),l.removeItem(t)),null!==t.agent_id){var e=this.getAgent(t.agent_id);e&&(t.sender_avatar_url=e.avatar_url||e.sender_avatar_url,t.sender_name=e.name||t.sender_name),this.view.windowFocus&&!this.view.collapsed||this.sound.play(),!0===this.view.collapsed&&(this.view.renderUnread(),this.view.showBeacon(!0))}r.addMsg(t);var n=r.getNextMsg(t.muid);return this.view.renderMessage(t,n),t},setCurrentAgent:function(t){(t||this.currentAgent)&&(this.currentAgent=this.getAgent(t),this.currentAgent?this.view.assignAgent():this.view.unassignAgent())},setAgents:function(t){this.agents=t.reduce((function(t,e){return t[e.id]=e,t}),{})},getAgent:function(t){return this.agents[t]||null},updateAgentState:function(){this.currentAgent?this.agentIsOnline=this.currentAgent.isOnline:this.agentIsOnline=Object.values(this.agents).find((function(t){return t.isOnline}))&&!0,this.view.renderAgentState()}}},function(t,e,n){"use strict";n.r(e);var i=n(8);mkz("initPlugin","chat",n.n(i).a)},function(t,e,n){"use strict";n.r(e),n.d(e,"Channel",(function(){return C})),n.d(e,"Serializer",(function(){return S})),n.d(e,"Socket",(function(){return A})),n.d(e,"LongPoll",(function(){return E})),n.d(e,"Ajax",(function(){return T})),n.d(e,"Presence",(function(){return j}));const i="undefined"!=typeof self?self:null,s="undefined"!=typeof window?window:null,o=i||s||void 0,r=0,a=1,c=2,l=3,h="closed",d="errored",m="joined",u="joining",_="leaving",p="phx_close",f="phx_error",k="phx_join",g="phx_reply",b="phx_leave",z=[p,f,k,g,b],v="longpoll",y="websocket";let x=t=>{if("function"==typeof t)return t;return function(){return t}};class w{constructor(t,e,n,i){this.channel=t,this.event=e,this.payload=n||function(){return{}},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(t){this.timeout=t,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(t,e){return this.hasReceived(t)&&e(this.receivedResp.response),this.recHooks.push({status:t,callback:e}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:t,response:e,ref:n}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,t=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=t,this.matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}trigger(t,e){this.channel.trigger(this.refEvent,{status:t,response:e})}}class C{constructor(t,e,n){this.state=h,this.topic=t,this.params=x(e||{}),this.socket=n,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new w(this,k,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new M(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=m,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=h,this.socket.remove(this)}),this.onError(t=>{this.socket.hasLogger()&&this.socket.log("channel","error "+this.topic,t),this.isJoining()&&this.joinPush.reset(),this.state=d,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new w(this,b,x({}),this.timeout).send(),this.state=d,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(g,(t,e)=>{this.trigger(this.replyEventName(e),t)})}join(t=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=t,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(t){this.on(p,t)}onError(t){return this.on(f,e=>t(e))}on(t,e){let n=this.bindingRef++;return this.bindings.push({event:t,ref:n,callback:e}),n}off(t,e){this.bindings=this.bindings.filter(n=>!(n.event===t&&(void 0===e||e===n.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,e,n=this.timeout){if(!this.joinedOnce)throw new Error(`tried to push '${t}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let i=new w(this,t,(function(){return e}),n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}leave(t=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=_;let e=()=>{this.socket.hasLogger()&&this.socket.log("channel","leave "+this.topic),this.trigger(p,"leave")},n=new w(this,b,x({}),t);return n.receive("ok",()=>e()).receive("timeout",()=>e()),n.send(),this.canPush()||n.trigger("ok",{}),n}onMessage(t,e,n){return e}isLifecycleEvent(t){return z.indexOf(t)>=0}isMember(t,e,n,i){return this.topic===t&&(!i||i===this.joinRef()||!this.isLifecycleEvent(e)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:t,event:e,payload:n,joinRef:i}),!1))}joinRef(){return this.joinPush.ref}sendJoin(t){this.state=u,this.joinPush.resend(t)}rejoin(t=this.timeout){this.isLeaving()||this.sendJoin(t)}trigger(t,e,n,i){let s=this.onMessage(t,e,n,i);if(e&&!s)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");for(let e=0;e<this.bindings.length;e++){const o=this.bindings[e];o.event===t&&o.callback(s,n,i||this.joinRef())}}replyEventName(t){return"chan_reply_"+t}isClosed(){return this.state===h}isErrored(){return this.state===d}isJoined(){return this.state===m}isJoining(){return this.state===u}isLeaving(){return this.state===_}}let S={encode(t,e){let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(n))},decode(t,e){let[n,i,s,o,r]=JSON.parse(t);return e({join_ref:n,ref:i,topic:s,event:o,payload:r})}};class A{constructor(t,e={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=e.timeout||1e4,this.transport=e.transport||o.WebSocket||E,this.defaultEncoder=S.encode,this.defaultDecoder=S.decode,this.closeWasClean=!1,this.unloaded=!1,this.binaryType=e.binaryType||"arraybuffer",this.transport!==E?(this.encode=e.encode||this.defaultEncoder,this.decode=e.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),s&&s.addEventListener&&s.addEventListener("beforeunload",t=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))}),this.heartbeatIntervalMs=e.heartbeatIntervalMs||3e4,this.rejoinAfterMs=t=>e.rejoinAfterMs?e.rejoinAfterMs(t):[1e3,2e3,5e3][t-1]||1e4,this.reconnectAfterMs=t=>this.unloaded?100:e.reconnectAfterMs?e.reconnectAfterMs(t):[10,50,100,150,200,250,500,1e3,2e3][t-1]||5e3,this.logger=e.logger||null,this.longpollerTimeout=e.longpollerTimeout||2e4,this.params=x(e.params||{}),this.endPoint=`${t}/${y}`,this.vsn=e.vsn||"2.0.0",this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new M(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let t=T.appendParams(T.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==t.charAt(0)?t:"/"===t.charAt(1)?`${this.protocol()}:${t}`:`${this.protocol()}://${location.host}${t}`}disconnect(t,e,n){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(t,e,n)}connect(t){t&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=x(t)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=t=>this.onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this.onConnClose(t))}log(t,e,n){this.logger(t,e,n)}hasLogger(){return null!==this.logger}onOpen(t){let e=this.makeRef();return this.stateChangeCallbacks.open.push([e,t]),e}onClose(t){let e=this.makeRef();return this.stateChangeCallbacks.close.push([e,t]),e}onError(t){let e=this.makeRef();return this.stateChangeCallbacks.error.push([e,t]),e}onMessage(t){let e=this.makeRef();return this.stateChangeCallbacks.message.push([e,t]),e}onConnOpen(){this.hasLogger()&&this.log("transport","connected to "+this.endPointURL()),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,t])=>t())}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(t,e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n||""):this.conn.close(),this.conn=null),t&&t()}onConnClose(t){this.hasLogger()&&this.log("transport","close",t),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,e])=>e(t))}onConnError(t){this.hasLogger()&&this.log("transport",t),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(([,e])=>e(t))}triggerChanError(){this.channels.forEach(t=>{t.isErrored()||t.isLeaving()||t.isClosed()||t.trigger(f)})}connectionState(){switch(this.conn&&this.conn.readyState){case r:return"connecting";case a:return"open";case c:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(t){this.off(t.stateChangeRefs),this.channels=this.channels.filter(e=>e.joinRef()!==t.joinRef())}off(t){for(let e in this.stateChangeCallbacks)this.stateChangeCallbacks[e]=this.stateChangeCallbacks[e].filter(([e])=>!t.includes(e))}channel(t,e={}){let n=new C(t,e,this);return this.channels.push(n),n}push(t){if(this.hasLogger()){let{topic:e,event:n,payload:i,ref:s,join_ref:o}=t;this.log("push",`${e} ${n} (${o}, ${s})`,i)}this.isConnected()?this.encode(t,t=>this.conn.send(t)):this.sendBuffer.push(()=>this.encode(t,t=>this.conn.send(t)))}makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(t){this.closeWasClean=!1,this.conn.close(1e3,t)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}onConnMessage(t){this.decode(t.data,t=>{let{topic:e,event:n,payload:i,ref:s,join_ref:o}=t;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${i.status||""} ${e} ${n} ${s&&"("+s+")"||""}`,i);for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r.isMember(e,n,i,o)&&r.trigger(n,i,s,o)}for(let e=0;e<this.stateChangeCallbacks.message.length;e++){let[,n]=this.stateChangeCallbacks.message[e];n(t)}})}}class E{constructor(t){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=r,this.poll()}normalizeEndpoint(t){return t.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+y),"$1/"+v)}endpointURL(){return T.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=r}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==a&&this.readyState!==r||T.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),t=>{if(t){var{status:e,token:n,messages:i}=t;this.token=n}else var e=0;switch(e){case 200:i.forEach(t=>this.onmessage({data:t})),this.poll();break;case 204:this.poll();break;case 410:this.readyState=a,this.onopen(),this.poll();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error("unhandled poll status "+e)}})}send(t){T.request("POST",this.endpointURL(),"application/json",t,this.timeout,this.onerror.bind(this,"timeout"),t=>{t&&200===t.status||(this.onerror(t&&t.status),this.closeAndRetry())})}close(t,e){this.readyState=l,this.onclose()}}class T{static request(t,e,n,i,s,r,a){if(o.XDomainRequest){let n=new XDomainRequest;this.xdomainRequest(n,t,e,i,s,r,a)}else{let c=o.XMLHttpRequest?new o.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(c,t,e,n,i,s,r,a)}}static xdomainRequest(t,e,n,i,s,o,r){t.timeout=s,t.open(e,n),t.onload=()=>{let e=this.parseJSON(t.responseText);r&&r(e)},o&&(t.ontimeout=o),t.onprogress=()=>{},t.send(i)}static xhrRequest(t,e,n,i,s,o,r,a){t.open(e,n,!0),t.timeout=o,t.setRequestHeader("Content-Type",i),t.onerror=()=>{a&&a(null)},t.onreadystatechange=()=>{if(t.readyState===this.states.complete&&a){let e=this.parseJSON(t.responseText);a(e)}},r&&(t.ontimeout=r),t.send(s)}static parseJSON(t){if(!t||""===t)return null;try{return JSON.parse(t)}catch(e){return console&&console.log("failed to parse JSON response",t),null}}static serialize(t,e){let n=[];for(var i in t){if(!t.hasOwnProperty(i))continue;let s=e?`${e}[${i}]`:i,o=t[i];"object"==typeof o?n.push(this.serialize(o,s)):n.push(encodeURIComponent(s)+"="+encodeURIComponent(o))}return n.join("&")}static appendParams(t,e){if(0===Object.keys(e).length)return t;let n=t.match(/\?/)?"&":"?";return`${t}${n}${this.serialize(e)}`}}T.states={complete:4};class j{constructor(t,e={}){let n=e.events||{state:"presence_state",diff:"presence_diff"};this.state={},this.pendingDiffs=[],this.channel=t,this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}},this.channel.on(n.state,t=>{let{onJoin:e,onLeave:n,onSync:i}=this.caller;this.joinRef=this.channel.joinRef(),this.state=j.syncState(this.state,t,e,n),this.pendingDiffs.forEach(t=>{this.state=j.syncDiff(this.state,t,e,n)}),this.pendingDiffs=[],i()}),this.channel.on(n.diff,t=>{let{onJoin:e,onLeave:n,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=j.syncDiff(this.state,t,e,n),i())})}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}list(t){return j.list(this.state,t)}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}static syncState(t,e,n,i){let s=this.clone(t),o={},r={};return this.map(s,(t,n)=>{e[t]||(r[t]=n)}),this.map(e,(t,e)=>{let n=s[t];if(n){let i=e.metas.map(t=>t.phx_ref),s=n.metas.map(t=>t.phx_ref),a=e.metas.filter(t=>s.indexOf(t.phx_ref)<0),c=n.metas.filter(t=>i.indexOf(t.phx_ref)<0);a.length>0&&(o[t]=e,o[t].metas=a),c.length>0&&(r[t]=this.clone(n),r[t].metas=c)}else o[t]=e}),this.syncDiff(s,{joins:o,leaves:r},n,i)}static syncDiff(t,{joins:e,leaves:n},i,s){let o=this.clone(t);return i||(i=function(){}),s||(s=function(){}),this.map(e,(t,e)=>{let n=o[t];if(o[t]=e,n){let e=o[t].metas.map(t=>t.phx_ref),i=n.metas.filter(t=>e.indexOf(t.phx_ref)<0);o[t].metas.unshift(...i)}i(t,n,e)}),this.map(n,(t,e)=>{let n=o[t];if(!n)return;let i=e.metas.map(t=>t.phx_ref);n.metas=n.metas.filter(t=>i.indexOf(t.phx_ref)<0),s(t,n,e),0===n.metas.length&&delete o[t]}),o}static list(t,e){return e||(e=function(t,e){return e}),this.map(t,(t,n)=>e(t,n))}static map(t,e){return Object.getOwnPropertyNames(t).map(n=>e(n,t[n]))}static clone(t){return JSON.parse(JSON.stringify(t))}}class M{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}},function(t,e){function n(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o,r=!0,a=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return r=t.done,t},e:function(t){a=!0,o=t},f:function(){try{r||null==s.return||s.return()}finally{if(a)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}t.exports={name:"mkz_c_auto_msg_history",addItems:function(t){var e,i=this.getItems(),s=n(t);try{var o=function(){var t=e.value,n=i.findIndex((function(e){return e.payload.custom_fields.uid===t.payload.custom_fields.uid}));-1===n?i.push(t):i[n].payload.custom_fields=t.payload.custom_fields};for(s.s();!(e=s.n()).done;)o()}catch(t){s.e(t)}finally{s.f()}return this.setItems(i),i},getItems:function(){var t=sessionStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return e},setItems:function(t){return sessionStorage.setItem(this.name,JSON.stringify(t)),t},removeItem:function(t){var e=this.getItems(),n=e.findIndex((function(e){return e.payload.muid===t}));return-1!==n&&(e.splice(n,1),this.setItems(e)),e}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return View}));var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__);function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=_unsupportedIterableToArray(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,o=!0,r=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw s}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var css=__webpack_require__(6),msgDelivered=__webpack_require__(5),helpers=__webpack_require__(7),domEvent=__webpack_require__(18),Template=__webpack_require__(19).default,msgStory=__webpack_require__(3),View=function(){function View(t){_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default()(this,View),this.history=null,this.collapsed=!0,this.windowFocus=!0,this.app=t,this.previewMode=t.previewMode,this.libs=t.libs,this.allowSending=!1,this.typingTimeout=1e3,this.noticeShowTimeout=1e3,this.noticeHideTimeout=1e4,this.width=null,this.template=new Template(this),this.containerBeaconClassName="mkz-c_beacon_show",this.containerChatClassName="mkz-c_chat_show",this.htmlClassName="mkz-c-fixed",this.validationOptions={invalidClassName:"mkz-f__invalid",invalidParentClassName:"mkz-f__invalid-wrap"}}return _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default()(View,[{key:"destroy",value:function(){this.el&&this.el.parentNode.removeChild(this.el)}},{key:"bind",value:function(){var t=this;domEvent.add(this.elInput,"keyup",this.setMsgHeight.bind(this)),domEvent.add(this.elToggle,"click",this.showChat.bind(this)),domEvent.add(this.elClose,"click",this.hideChat.bind(this)),this.previewMode||(domEvent.add(window,"focus",this.onFocus.bind(this)),domEvent.add(window,"blur",this.onBlur.bind(this)),domEvent.add(this.elSubmit,"click",this.sendMsg.bind(this)),domEvent.add(this.elInput,"keydown",(function(e){13!=e.keyCode||e.shiftKey?t.startTyping():(e.preventDefault(),t.sendMsg())})))}},{key:"bindMessage",value:function(t){if(!this.previewMode){var e,n=_createForOfIteratorHelper(t.querySelectorAll(".mkz-c-o-js-action"));try{for(n.s();!(e=n.n()).done;){var i=e.value;domEvent.add(i,"click",this.clickProductAttachment.bind(this))}}catch(t){n.e(t)}finally{n.f()}var s,o=_createForOfIteratorHelper(t.querySelectorAll(".mkz-f-js"));try{for(o.s();!(s=o.n()).done;){var r=s.value;domEvent.add(r,"submit",this.submitSurveyForm.bind(this))}}catch(t){o.e(t)}finally{o.f()}}}},{key:"submitSurveyForm",value:function(t){t.preventDefault();var e=t.target,n=new this.libs.Validation(e,this.validationOptions).valid(),i=e.dataset.uid;if(n){var s=Object.entries(new this.libs.FormToObject(e)).reduce((function(t,e){var n=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(e,2),i=n[0],s=n[1];return t[i]=s,"true"===s&&(t[i]=!0),"false"===s&&(t[i]=!1),t}),{});this.app.pusherNewSurveyMsg(i,s),e.querySelector("button").disabled=!0}}},{key:"clickProductAttachment",value:function clickProductAttachment(e){var el=e.target,offer=JSON.parse(el.dataset.data),callbackLabel=el.dataset.callback_label,settings=this.app.settings.behavior.attachment_cta.product,callback=function callback(){callbackLabel&&(el.innerHTML=callbackLabel),settings.callback&&eval(settings.callback)(offer)};el.handlerDone||(el.handlerDone=!0,el.setAttribute("disabled",!0),eval(settings.handler)(offer,callback))}},{key:"onFocus",value:function(){this.windowFocus=!0}},{key:"onBlur",value:function(){this.windowFocus=!1}},{key:"showChat",value:function(){var t=this;this.collapsed&&(this.collapsed=!1,helpers.addClass(document.documentElement,this.htmlClassName),helpers.addClass(this.elContainer,this.containerChatClassName),this.hideBeacon(),this.previewMode||(this.app.handlerCollapse(this.collapsed),setTimeout((function(){t.elInput.focus()}),100)))}},{key:"hideChat",value:function(){this.collapsed||(this.collapsed=!0,helpers.removeClass(document.documentElement,this.htmlClassName),helpers.removeClass(this.elContainer,this.containerChatClassName),this.showBeacon(),this.previewMode||this.app.handlerCollapse(this.collapsed))}},{key:"showBeacon",value:function(t){"disabled"!==this.app.settings.beaconState&&("hidden"!==this.app.settings.beaconState||t)&&helpers.addClass(this.elContainer,this.containerBeaconClassName)}},{key:"hideBeacon",value:function(){helpers.removeClass(this.elContainer,this.containerBeaconClassName)}},{key:"connected",value:function(){this.enableSending()}},{key:"disconnected",value:function(){this.disableSending()}},{key:"startTyping",value:function(){var t=this;this.timeoutTyping||(this.timeoutTyping=setTimeout((function(){t.sendTyping(),t.stopTyping()}),this.typingTimeout))}},{key:"stopTyping",value:function(){clearTimeout(this.timeoutTyping),this.timeoutTyping=null}},{key:"sendTyping",value:function(){var t=this.elInput.value;this.app.pusherTyping(t)}},{key:"sendMsg",value:function(){var t=this;if(this.allowSending){var e=this.elInput.value.trim();e&&(this.stopTyping(),this.disableSending(),this.app.pusherNewMsg(e).receive("ok",(function(){t.elInput.value=null,t.setMsgHeight(),t.enableSending()})).receive("error",(function(){return t.enableSending.bind(t)})).receive("timeout",(function(){return t.enableSending.bind(t)})))}}},{key:"setMsgHeight",value:function(){this.elInput.style.height="auto";var t=this.elInput.scrollHeight;this.elInput.style.height=t+"px"}},{key:"disableSending",value:function(){this.allowSending=!1,this.elSubmit&&helpers.addClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"enableSending",value:function(){this.allowSending=!0,this.elSubmit&&helpers.removeClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"assignAgent",value:function(){this.elAgentName.innerText=this.app.currentAgent.name||"",this.app.settings.appearance.agent_post&&(this.elAgentPost.innerText=this.app.currentAgent.job_title||""),this.app.settings.appearance.agent_avatar&&this.app.currentAgent.avatar_url?(this.elAgentAvatar.src=this.app.currentAgent.avatar_url,this.elAgentAvatar.setAttribute("srcset",helpers.srcset(this.app.currentAgent.avatar_url)),this.elAgentAvatar.style.display="block"):this.elAgentAvatar.style.display="none",helpers.addClass(this.elContainer,"mkz-c_agent_assign")}},{key:"unassignAgent",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_assign")}},{key:"onlineAgents",value:function(){helpers.addClass(this.elContainer,"mkz-c_agent_online")}},{key:"offlineAgents",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_online")}},{key:"toggleNotice",value:function(){var t=this;if(!this.previewMode){sessionStorage.getItem("mkz_c_tooltip_hidden")||(sessionStorage.setItem("mkz_c_tooltip_hidden",!0),setTimeout((function(){t.showNotice()}),this.noticeShowTimeout),setTimeout((function(){t.hideNotice()}),this.noticeShowTimeout+this.noticeHideTimeout))}}},{key:"showNotice",value:function(){helpers.addClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"hideNotice",value:function(){helpers.removeClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"render",value:function(){this.el||(this.el=helpers.appendHTML(document.body,this.template.content()),this.elContainer=this.el.querySelector(".mkz-c-js"),this.elInput=this.el.querySelector(".mkz-c-js-input"),this.elSubmit=this.el.querySelector(".mkz-c-js-submit"),this.elUnread=this.el.querySelector(".mkz-c-js-unread"),this.elClose=this.el.querySelector(".mkz-c-js-close"),this.elToggle=this.el.querySelector(".mkz-c-js-toggle"),this.elHistory=this.el.querySelector(".mkz-c-js-history"),this.elScroll=this.el.querySelector(".mkz-c-js-scroll"),this.elAgentName=this.el.querySelector(".mkz-c-js-agent-name"),this.elAgentPost=this.el.querySelector(".mkz-c-js-agent-post"),this.elAgentAvatar=this.el.querySelector(".mkz-c-js-agent-avatar"),this.bind(),this.showBeacon(),this.toggleNotice(),this.renderMessages()),this.renderUnread()}},{key:"renderMessages",value:function(){var t,e=_createForOfIteratorHelper(this.history||msgStory.getHistory());try{for(e.s();!(t=e.n()).done;){var n=t.value;this.renderMessage(n)}}catch(t){e.e(t)}finally{e.f()}}},{key:"renderMessage",value:function(t,e){var n=this.template.message(t),i=this.findMsg(t.muid);if(i)i.innerHTML=n;else{var s=e&&this.findMsg(e.muid);i=s?helpers.beforeHTML(s,n):helpers.appendHTML(this.elHistory,n)}this.bindMessage(i)}},{key:"findMsg",value:function(t){return this.elHistory.querySelector('[data-id="'.concat(t,'"]'))}},{key:"renderUnread",value:function(){if(this.elUnread){var t=msgDelivered.getList().length;this.elUnread.innerHTML=t,this.elUnread.style.display=0===t?"none":"block"}}},{key:"renderAgentState",value:function(){this.app.agentIsOnline?this.onlineAgents():this.offlineAgents()}},{key:"scrollBottom",value:function(){var t=this;setTimeout((function(){t.elScroll.scrollTop=t.elScroll.scrollHeight}),0)}}]),View}()},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw o}}return n}}},function(t,e,n){var i=n(16);t.exports=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){t.exports={guid:0,fixEvent:function(t){if((t=t||window.event).isFixed)return t;if(t.isFixed=!0,t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagaton||function(){this.cancelBubble=!0},t.target||(t.target=t.srcElement),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement==t.target?t.toElement:t.fromElement),null==t.pageX&&null!=t.clientX){var e=document.documentElement,n=document.body;t.pageX=t.clientX+(e&&e.scrollLeft||n&&n.scrollLeft||0)-(e.clientLeft||0),t.pageY=t.clientY+(e&&e.scrollTop||n&&n.scrollTop||0)-(e.clientTop||0)}return!t.which&&t.button&&(t.which=1&t.button?1:2&t.button?3:4&t.button?2:0),t},commonHandle:function(t,e){t=e.fixEvent(t);var n=this.events[t.type];for(var i in n){if(!1===n[i].call(this,t)&&(t.preventDefault(),t.stopPropagation()),t.stopNow)break}},add:function(t,e,n){var i=this;t.setInterval&&t!=window&&!t.frameElement&&(t=window),n.guid||(n.guid=++this.guid),t.events||(t.events={},t.handle=function(e){return i.commonHandle.call(t,e,i)}),t.events[e]||(t.events[e]={},t.addEventListener?t.addEventListener(e,t.handle,!1):t.attachEvent&&t.attachEvent("on"+e,t.handle)),t.events[e][n.guid]=n},remove:function(t,e,n){var i=t.events&&t.events[e];if(i){for(var s in delete i[n.guid],i)return;for(var s in t.removeEventListener?t.removeEventListener(e,t.handle,!1):t.detachEvent&&t.detachEvent("on"+e,t.handle),delete t.events[e],t.events)return;try{delete t.handle,delete t.events}catch(e){t.removeAttribute("handle"),t.removeAttribute("events")}}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return m}));var i=n(2),s=n.n(i),o=n(0),r=n.n(o),a=n(1),c=n.n(a),l=n(6),h=n(7),d=n(20),m=function(){function t(e){r()(this,t),this.app=e.app,this.view=e,this.appearance=this.app.settings.appearance,this.behavior=this.app.settings.behavior}return c()(t,[{key:"safe",value:function(t){return h.htmlToText(t)}},{key:"t",value:function(t){return d[this.app.locale][t]}},{key:"attribute",value:function(t){return t?t.replace(/\"/gi,"&quot;"):""}},{key:"offer",value:function(t,e,n){var i=t.icon?'\n          <img src="'.concat(this.safe(t.icon),'" alt="" class="mkz-c-o__preview-img" />\n    '):'\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="480" height="448" viewBox="0 0 480 448" class="mkz-c-o__preview-img">\n            <path fill="currentColor" d="M160 144c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zM416 240v112h-352v-48l80-80 40 40 128-128zM440 64h-400c-4.25 0-8 3.75-8 8v304c0 4.25 3.75 8 8 8h400c4.25 0 8-3.75 8-8v-304c0-4.25-3.75-8-8-8zM480 72v304c0 22-18 40-40 40h-400c-22 0-40-18-40-40v-304c0-22 18-40 40-40h400c22 0 40 18 40 40z"></path>\n          </svg>\n    ',s=n.length<2?"":'\n        <div class="mkz-c-o__counter">\n          '.concat(e+1,"/").concat(n.length,"\n        </dvi>\n    "),o=this.t(this.behavior.attachment_cta.product.callback_label_text),r=this.t(this.behavior.attachment_cta.product.label_text);return'\n      <div class="mkz-c-o__i">\n        <div class="mkz-c-o__content">\n          <a href="'.concat(this.safe(t.url),'" class="mkz-c-o__preview-link">\n            ').concat(i,'\n          </a>\n          <div class="mkz-c-o__name">\n            <a href="').concat(this.safe(t.url),'" class="mkz-c-o__name-link">').concat(this.safe(t.name),'</a>\n          </div>\n          <div class="mkz-c-o__info">\n            <div class="mkz-c-o__info-price">\n              ').concat(this.safe(t.display_price),'\n            </div>\n            <div class="mkz-c-o__info-avaliable mkz-c-o__info-avaliable_color_').concat(t.available?"green":"red",'">\n              ').concat(this.t(t.available?"in_stock":"out_of_stock"),'\n            </div>\n          </div>\n          <div class="mkz-c-o__action">\n            <span\n              data-data="').concat(this.attribute(JSON.stringify(t)),'"\n              data-callback_label="').concat(this.attribute(o),'"\n              class="mkz-c-o__btn mkz-c-o-js-action"\n            >\n              ').concat(r,"\n            </span>\n          </div>\n        </div>\n        ").concat(s,"\n      </div>\n    ")}},{key:"offers",value:function(t){return t?'\n    <div class="mkz-c-o">\n      '.concat(t.map(this.offer.bind(this)).join("\n"),"\n    </div>"):""}},{key:"form",value:function(t,e){var n=this,i=t.map((function(t){switch(t.display_type){case"email":return n.formText(t,"email");case"numeric":return n.formText(t,"text","numeric");case"integer":return n.formText(t,"number");case"boolean":return n.formBoolean(t);case"select":return n.formSelect(t);case"date":return n.formDate(t);case"hint":return n.formHint(t);case"button":return n.formButton(t);default:return n.formText(t,"text")}})).map((function(t){return'<div class="mkz-f__row">'.concat(t,"</div>")})).join("");return'\n      <form class="mkz-f mkz-f-js" data-uid="'.concat(this.attribute(e),'" novalidate autocomplete="off">').concat(i,"</form>")}},{key:"formText",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return'\n    <label class="mkz-f__label">'.concat(this.safe(t.display_name),'</label>\n    <input\n      type="').concat(e,'"\n      name="').concat(t.field,'"\n      class="mkz-f__input"\n      value="').concat(this.attribute(t.value),'"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n      ").concat(n,"\n    />\n    ")}},{key:"formDate",value:function(t){return'\n    <label class="mkz-f__label">'.concat(this.safe(t.display_name),'</label>\n    <input\n      type="date"\n      name="').concat(t.field,'"\n      class="mkz-f__input"\n      pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}"\n      value="').concat(this.attribute(t.value),'"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    />\n    ")}},{key:"formBoolean",value:function(t){var e=this,n={"":"-",true:this.t("true"),false:this.t("false")},i=Object.entries(n).map((function(n){var i=s()(n,2),o=i[0],r=i[1],a=t.value===String(o)?'selected="selected"':"";return'<option value="'.concat(e.attribute(o),'" ').concat(a,">").concat(e.safe(r),"</option>")})).join("");return'\n    <label class="mkz-f__label">'.concat(this.safe(t.display_name),'</label>\n    <select\n      name="').concat(t.field,'"\n      class="mkz-f__select"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    >").concat(i,"</select>\n    ")}},{key:"formSelect",value:function(t){var e=this,n=[["","-"]].concat(Object.entries(t.predefined_values)).map((function(n){var i=s()(n,2),o=i[0],r=i[1],a=t.value===o?'selected="selected"':"";return'<option value="'.concat(e.attribute(o),'" ').concat(a,">").concat(e.safe(r),"</option>")})).join("");return'\n    <label class="mkz-f__label">'.concat(this.safe(t.display_name),'</label>\n    <select\n      name="').concat(t.field,'"\n      class="mkz-f__select"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    >").concat(n,"</select>\n    ")}},{key:"formHint",value:function(t){return'\n    <div class="mkz-f__note">'.concat(this.safe(t.display_name),"</div>\n    ")}},{key:"formButton",value:function(t){return'\n    <button type="submit" class="mkz-f__btn" '.concat(t.disabled?'disabled="true"':"",">").concat(this.safe(t.display_name),"</button>\n    ")}},{key:"attachments",value:function(t){var e=this,n=(t.attachments||[]).reduce((function(t,e){return t[e.type]||(t[e.type]=[]),t[e.type].push(e),t}),{});return Object.entries(n).map((function(t){var n=s()(t,2),i=n[0],o=n[1];switch(i){case"product":return e.offers(o)}}))}},{key:"message",value:function(t){var e=t.sender_avatar_url?'<div class="mkz-c__i-avatar"><img src="'.concat(this.safe(t.sender_avatar_url),'" srcset="').concat(h.srcset(t.sender_avatar_url),'" class="mkz-c__i-avatar-img" alt="" title="').concat(this.safe(t.sender_name),'" /></div>'):"";return'\n          <div class="mkz-c__i mkz-c__i_type_'.concat("client"===t.sender_type?"client":"agent",'" data-id="').concat(t.muid,'">\n            ').concat(e,'\n            <div class="mkz-c__i-content">\n              ').concat(this.messageContent(t),"\n            </div>\n          </div>")}},{key:"messageContent",value:function(t){var e=this,n="client"===t.sender_type?this.appearance.client_msg_bg:this.appearance.agent_msg_bg,i="client"===t.sender_type?this.appearance.client_msg_color:this.appearance.agent_msg_color,s=function(t){return'\n      <div class="mkz-c__i-msg" style="background-color: '.concat(e.safe(n),"; color: ").concat(e.safe(i),'">\n        <div class="mkz-c__i-msg-overflow">\n          ').concat(t,"\n        </div>\n      </div>")};switch(t.msg_type){case"survey:show":var o=t.custom_fields,r=o.submitted,a=o.hidden,c=o.elements.map((function(t){return t.value=o.values&&o.values[t.field],t})),l=o.follow_up_text?s(h.textFormatting(o.follow_up_text)):"";return(t.text?s(h.textFormatting(t.text)):"")+(r?l:a?"":s(this.form(c,t.muid)));default:var d=h.textFormatting(t.text);return"\n          ".concat(d?s(d):"","\n          ").concat(this.attachments(t))}}},{key:"doc",value:function(t){return'\n            <div class="mkz-c-docs__i">\n              <div class="mkz-c-docs__btn">\n                '.concat(this.safe(t),"\n              </div>\n            </div>")}},{key:"docs",value:function(){return""}},{key:"copy",value:function(){return this.appearance.markeaze_link?'\n      <a class="mkz-c__copy" href="https://markeaze.com?utm_source=markeaze&utm_campaign=referral" target="_blank">\n        <svg width="11" height="9" viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M1.94727 2.8471C2.12716 2.49158 2.57173 2.38949 2.87918 2.63311C3.12176 2.82531 3.19515 3.17138 3.05276 3.45164L1.17079 7.15577C0.991709 7.50824 0.550808 7.60949 0.24532 7.3683C0.0037509 7.17757 -0.0698014 6.83352 0.0713545 6.55454L1.94727 2.8471Z" fill="#FC4566"/>\n          <path d="M5.35667 1.9023C5.54038 1.55555 5.9926 1.45484 6.30746 1.69056C6.55814 1.87824 6.63496 2.21903 6.48885 2.49519L4.02121 7.15912C3.83664 7.50797 3.38122 7.60839 3.06569 7.36982C2.81616 7.18115 2.74036 6.8407 2.88648 6.5649L5.35667 1.9023Z" fill="#0EC52C"/>\n          <path d="M8.81247 0.351483C8.99329 -0.00816918 9.44199 -0.111851 9.75226 0.134322C9.99632 0.327953 10.0705 0.67639 9.92784 0.959046L6.80213 7.15236C6.62323 7.50684 6.18144 7.61011 5.87387 7.36934C5.62976 7.17824 5.55453 6.83147 5.6961 6.54989L8.81247 0.351483Z" fill="#7261FF"/>\n        </svg>\n        '.concat(this.t("copyright"),"\n      </a>"):""}},{key:"notice",value:function(){return this.appearance.notice_text&&this.appearance.notice_text.trim()?'\n      <div class="mkz-c__tooltip mkz-c__tooltip_picture_yes" style="color: '.concat(this.safe(this.appearance.notice_color),"; background-color: ").concat(this.safe(this.appearance.notice_bg),'">\n        <img src="').concat(this.safe(this.appearance.notice_icon_url),'" class="mkz-c__tooltip-picture" alt="" />\n        <div class="mkz-c__tooltip-text">\n          ').concat(this.safe(this.appearance.notice_text),"\n        </div>\n      </div>"):""}},{key:"content",value:function(){var t=["l-t","l-b","l"].indexOf(this.appearance.bar_position)>-1?"left":"right";return'\n<div mkz>\n  <div class="mkz-c mkz-c-js">\n\n    <div class="mkz-c__handler mkz-c__handler_type_'.concat(this.safe(this.appearance.bar_type)," mkz-c__handler_position_").concat(this.safe(this.appearance.bar_position),'" style="margin: ').concat(this.safe(this.appearance.bar_padding_y),"px ").concat(this.safe(this.appearance.bar_padding_x),'px">\n      ').concat(this.notice(),'\n      <div class="mkz-c__btn mkz-c-js-toggle" style="background-color: ').concat(this.appearance.bar_bg,"; color: ").concat(this.safe(this.appearance.bar_color),';">\n        <div class="mkz-c__btn-text">\n          <span class="mkz-c__btn-text-online">').concat(this.safe(this.appearance.bar_text_online),'</span>\n          <span class="mkz-c__btn-text-offline">').concat(this.safe(this.appearance.bar_text_offline),'</span>\n        </div>\n        <svg width="27" height="27" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="mkz-c__btn-picture">\n          <path d="M20.6429 10.4641C20.6466 11.8783 20.3162 13.2733 19.6786 14.5355C18.9226 16.0481 17.7605 17.3204 16.3223 18.2098C14.8841 19.0992 13.2267 19.5706 11.5357 19.5713C10.1216 19.5749 8.72659 19.2445 7.46432 18.607L1.35718 20.6427L3.39289 14.5355C2.75532 13.2733 2.42492 11.8783 2.42861 10.4641C2.42926 8.77313 2.90069 7.11573 3.79009 5.67755C4.67949 4.23937 5.95174 3.07721 7.46432 2.32125C8.72659 1.68368 10.1216 1.35328 11.5357 1.35696H12.0715C14.3047 1.48017 16.414 2.42278 17.9955 4.00431C19.5771 5.58585 20.5197 7.69516 20.6429 9.92839V10.4641Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n        <div class="mkz-c__btn-unread mkz-c-js-unread">0</div>\n      </div>\n    </div>\n\n    <div class="mkz-c__chat mkz-c__chat_position_').concat(t,'" style="').concat(this.view.width?"max-width: ".concat(this.view.width,"px;"):"",'">\n      <div class="mkz-c__cart-shadow" style="box-shadow: 0 0 10px ').concat(this.safe(this.appearance.title_bg),';"></div>\n      <div class="mkz-c__cart">\n        <div class="mkz-c__head" style="color: ').concat(this.safe(this.appearance.title_color),"; background-color: ").concat(this.safe(this.appearance.title_bg),';">\n          <div class="mkz-c__head-state">\n            <div class="mkz-c__state-wrap">\n              <img class="mkz-c__m-assign-avatar mkz-c-js-agent-avatar" alt="" />\n              <div class="mkz-c__state"></div>\n            </div>\n          </div>\n          <div class="mkz-c__head-m">\n            <div class="mkz-c__m-assign-text mkz-c-js-agent-name"></div>\n            <div class="mkz-c__m-assign-post mkz-c-js-agent-post"></div>\n            <div class="mkz-c__m-unassign-text">').concat(this.safe(this.appearance.bar_text_offline),'</div>\n          </div>\n          <div class="mkz-c__head-action">\n            <div class="mkz-c__close mkz-c-js-close">\n              <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M11.4287 4.57129L4.57153 11.4284" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n              <path d="M4.57153 4.57129L11.4287 11.4284" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n        <div class="mkz-c__content mkz-c-js-scroll">\n          <div class="mkz-c__list mkz-c-js-history"></div>\n        </div>\n        ').concat(this.docs(),'\n        <label class="mkz-c__footer">\n          <div class="mkz-c__footer-msg">\n            <textarea class="mkz-c__input mkz-c-js-input" rows="1" placeholder="').concat(this.t("placeholder"),'"></textarea>\n          </div>\n          <div class="mkz-c__footer-btn">\n            <div class="mkz-c__submit mkz-c-js-submit">\n              <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18.9675 0.949039L12.9784 17.6706C12.9069 17.8682 12.7194 17.9999 12.5092 18H12.3495C12.1535 18 11.9749 17.8874 11.8903 17.7105L9.53462 12.719C9.18774 11.9831 9.322 11.1103 9.874 10.5128L12.8686 7.23833C13.0524 7.04551 13.0524 6.74232 12.8686 6.5495L12.4893 6.17015C12.2965 5.98633 11.9933 5.98633 11.8005 6.17015L8.52644 9.16505C7.92893 9.71711 7.05625 9.85139 6.32044 9.50447L1.32949 7.14848C1.13702 7.076 1.00706 6.89483 1.00009 6.68926V6.52953C0.982409 6.30492 1.11738 6.09631 1.32949 6.0204L18.0492 0.0306031C18.2289 -0.0354106 18.4306 0.00725579 18.5682 0.140416L18.8278 0.399974C18.9838 0.536262 19.0394 0.754748 18.9675 0.949039Z" fill="currentColor"/>\n              </svg>\n            </div>\n          </div>\n        </label>\n      </div>\n      ').concat(this.copy(),'\n    </div>\n  </div>\n\n  <style type="text/css">').concat(l,"</style>\n\n</div>\n    ")}}]),t}()},function(t,e){t.exports={ru:{copyright:"Сделано в Markeaze",placeholder:"Напишите ваше сообщение...",in_stock:"В наличии",out_of_stock:"Не в наличии",view_product:"Посмотреть товар",add_to_cart:"Добавить в корзину",added_to_cart:"Добавлен в корзину",true:"Да",false:"Нет"},en:{copyright:"Powered by Markeaze",placeholder:"Type your message here...",in_stock:"In stock",out_of_stock:"Out of stock",view_product:"View product",add_to_cart:"Add to cart",added_to_cart:"Added to Cart!",true:"True",false:"False"}}},function(t,e){t.exports={trackShow:function(t){mkz("trackSurveyFormShow",{survey_form_uid:t})},trackSubmit:function(t,e){mkz("trackSurveyFormSubmit",{survey_form_uid:t},null,e)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return a}));var i=n(0),s=n.n(i),o=n(1),r=n.n(o),a=function(){function t(e){var n=this;s()(this,t),this.audio=new Audio||document.createElement("video"),this.audio&&e&&(this.onload=!1,this.onplay=!1,this.audio.autoplay=!1,this.audio.load(),this.audio.canPlayType("audio/ogg")?this.audio.src=e+".ogg":this.audio.canPlayType("audio/mp3")&&(this.audio.src=e+".mp3"),this.audio.onloadeddata=function(){n.onload=!0,n.onplay&&n.playAction()})}return r()(t,[{key:"play",value:function(){this.audio&&(this.onload?this.playAction():this.onplay=!0)}},{key:"playAction",value:function(){this.audio.currentTime=0,this.audio.play().catch((function(t){}))}}]),t}()}]);