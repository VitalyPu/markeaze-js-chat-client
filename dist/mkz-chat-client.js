!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e){function n(){}function i(t){this._tree=t,this._ancestors=[],this._cursor=null}n.prototype.clear=function(){this._root=null,this.size=0},n.prototype.find=function(t){for(var e=this._root;null!==e;){var n=this._comparator(t,e.data);if(0===n)return e.data;e=e.get_child(n>0)}return null},n.prototype.findIter=function(t){for(var e=this._root,n=this.iterator();null!==e;){var i=this._comparator(t,e.data);if(0===i)return n._cursor=e,n;n._ancestors.push(e),e=e.get_child(i>0)}return null},n.prototype.lowerBound=function(t){for(var e=this._root,n=this.iterator(),i=this._comparator;null!==e;){var r=i(t,e.data);if(0===r)return n._cursor=e,n;n._ancestors.push(e),e=e.get_child(r>0)}for(var o=n._ancestors.length-1;o>=0;--o)if(i(t,(e=n._ancestors[o]).data)<0)return n._cursor=e,n._ancestors.length=o,n;return n._ancestors.length=0,n},n.prototype.upperBound=function(t){for(var e=this.lowerBound(t),n=this._comparator;null!==e.data()&&0===n(e.data(),t);)e.next();return e},n.prototype.min=function(){var t=this._root;if(null===t)return null;for(;null!==t.left;)t=t.left;return t.data},n.prototype.max=function(){var t=this._root;if(null===t)return null;for(;null!==t.right;)t=t.right;return t.data},n.prototype.iterator=function(){return new i(this)},n.prototype.each=function(t){for(var e,n=this.iterator();null!==(e=n.next());)t(e)},n.prototype.reach=function(t){for(var e,n=this.iterator();null!==(e=n.prev());)t(e)},i.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},i.prototype.next=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._minNode(t)}else{var e;if(null===this._cursor.right)do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===e);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},i.prototype.prev=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._maxNode(t)}else{var e;if(null===this._cursor.left)do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===e);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},i.prototype._minNode=function(t){for(;null!==t.left;)this._ancestors.push(t),t=t.left;this._cursor=t},i.prototype._maxNode=function(t){for(;null!==t.right;)this._ancestors.push(t),t=t.right;this._cursor=t},t.exports=n},function(t,e,n){var i=n(2);t.exports={name:"mkz_c_msg_history",cached:!1,history:[],getHistory:function(){this.cached&&i.cached&&this.history;var t=localStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return this.sortHistory(e.concat(i.getHistory()))},saveHistory:function(t){return localStorage.setItem(this.name,JSON.stringify(t.filter((function(t){return!t.exclude})))),t},addMsg:function(t){var e=this.getHistory(),n=this.findMsgIndex(t.muid),i={muid:t.muid,msg_type:t.msg_type,text:t.text,custom_fields:t.custom_fields,agent_id:t.agent_id,sender_type:t.sender_type,sent_at:t.sent_at,sender_avatar_url:t.sender_avatar_url,sender_name:t.sender_name,attachments:t.attachments,exclude:t.exclude};-1===n?e.push(i):e[n]=i,this.saveHistory(e)},getNextMsg:function(t){var e=this.findMsgIndex(t),n=this.getHistory();if(n[e+1])return n[e+1]},findMsgIndex:function(t){return this.getHistory().findIndex((function(e){return e.muid===t}))},findMsg:function(t){return this.getHistory().find((function(e){return e.muid===t}))},sortHistory:function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e;r>0&&new Date(t[r-1].sent_at)>new Date(i.sent_at);)t[r]=t[r-1],r--;t[r]=i}return t}}},function(t,e,n){var i=n(19);t.exports={cached:!1,init:function(t){var e=this;this.app=t,this.libs=t.libs,this.cached=!1,this.items=i.getItems(),this.rendered=!1,this.libs.eEmit&&(this.libs.eEmit.subscribe("plugin.chat.auto_messages",this.saveItems.bind(this)),this.libs.eEmit.subscribe("plugin.chat.channel.entered",(function(){e.rendered=!0,e.renderNewItems()})))},getHistory:function(){return this.cached=!0,this.items.map((function(t){return t.payload}))},saveItems:function(t){var e=this;if(0!==t.length){this.cached=!1;var n=this.app.store.uid;this.items=i.addItems(t.map((function(t){var i=e.app.getDateTime(),r=+new Date(i);return{payload:{agent_id:t.sender_id,attachments:[],muid:"".concat(n,":a:").concat(r),msg_type:"message:auto",sender_avatar_url:null,sender_name:null,sent_at:i,text:t.text,exclude:!0,custom_fields:t},state:"new",sent_at:i}}))),this.rendered&&this.renderNewItems()}},renderNewItems:function(){var t=this.items.filter((function(t){return"new"===t.state}));if(0!==t.length){this.cached=!1;var e=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var a=o.value;this.app.addMsg(a.payload),this.app.view.scrollBottom(),this.app.setCurrentAgent(a.payload.agent_id),this.trackShow(a.payload.custom_fields),a.state="sent"}}catch(t){n=!0,r=t}finally{try{e||null==s.return||s.return()}finally{if(n)throw r}}this.app.view.collapsed&&this.app.view.collapse(),i.setItems(this.items)}},getMsgAgentId:function(t){var e=this.items.find((function(e){return e.payload.muid===t}));return e&&e.payload.agent_id||0},removeItem:function(t){this.cached=!1,this.items=i.removeItem(t)},trackShow:function(t){mkz("trackAutoMessageShow",{custom_fields_uid:t.uid})},trackReply:function(t){var e=this.items.find((function(e){return e.payload.muid===t}));e.payload.reply_once&&mkz("trackAutoMessageReply",{custom_fields_uid:e.payload.uid,reply_text:e.payload.text})}}},function(t,e){t.exports={name:"mkz_c_delivered",addItem:function(t){var e=this.getList();return e.push(t),this.setList(e),e},getList:function(){var t=localStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return e},setList:function(t){return localStorage.setItem(this.name,JSON.stringify(t)),t},resetList:function(){this.setList([])}}},function(t,e){t.exports="[mkz] .mkz-c{text-align:left;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;font-size:15px;color:#333}[mkz] .mkz-c *{font-family:Geneva,Arial,Helvetica,sans-serif;-webkit-tap-highlight-color:transparent}[mkz] .mkz-c_collapse_yes .mkz-c__handler{opacity:1;visibility:visible}[mkz] .mkz-c_collapse_yes .mkz-c__chat{opacity:0;visibility:hidden}[mkz] .mkz-c_collapse_yes.mkz-c_tooltip_yes .mkz-c__tooltip{opacity:1;visibility:visible}[mkz] .mkz-c_agent_assign .mkz-c__m-unassign-text{display:none}[mkz] .mkz-c_agent_assign .mkz-c__m-assign-text,[mkz] .mkz-c_agent_assign .mkz-c__m-assign-post,[mkz] .mkz-c_agent_assign .mkz-c__m-assign-avatar{display:block}[mkz] .mkz-c_agent_online .mkz-c__state{background-color:#0EC52C}[mkz] .mkz-c_agent_online .mkz-c__btn-text-online{display:block}[mkz] .mkz-c_agent_online .mkz-c__btn-text-offline{display:none}[mkz] .mkz-c__handler{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;z-index:10000}[mkz] .mkz-c__handler_position_l-t{left:0;top:0}[mkz] .mkz-c__handler_position_l-t.mkz-c__handler_type_bar{margin-top:0 !important}[mkz] .mkz-c__handler_position_r-t{right:0;top:0}[mkz] .mkz-c__handler_position_r-t.mkz-c__handler_type_bar{margin-top:0 !important}[mkz] .mkz-c__handler_position_l-b{left:0;bottom:0}[mkz] .mkz-c__handler_position_l-b.mkz-c__handler_type_bar{margin-bottom:0 !important}[mkz] .mkz-c__handler_position_r-b{right:0;bottom:0}[mkz] .mkz-c__handler_position_r-b.mkz-c__handler_type_bar{margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip{left:100%;right:auto;margin-left:15px;margin-right:0;border-radius:0 6px 6px 0}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:after{left:-10px;right:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:before,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:before{left:-1px;right:auto}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip_picture_yes,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip_picture_yes{padding-left:5px;padding-right:40px}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip-picture,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip-picture{position:absolute;left:auto;right:-35px}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn{width:60px;height:60px;border-radius:50%;background-color:#eee;color:#000;display:flex;align-items:center;justify-content:center;transition:transform 0.2s linear;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn:hover{transform:scale(1.1)}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-text{display:none}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip{position:absolute;right:100%;top:50%;margin-right:15px;transform:translateY(-50%);box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#4F4F4F;padding:5px;border-radius:6px 0 0 6px;width:160px;box-sizing:border-box}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:after{content:'';position:absolute;right:-10px;top:0;bottom:0;width:10px;clip-path:polygon(0 0, 0 0, 100% 50%, 0 100%);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:before{content:'';position:absolute;right:-1px;top:1px;bottom:1px;width:2px;background:inherit}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip_picture_yes{padding-left:40px}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-text{font-size:12px;line-height:16px;text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-picture{position:absolute;left:-35px;top:50%;transform:translateY(-50%);max-width:79px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn{border-radius:0 0 15px 15px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn:hover,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn:hover{padding-top:20px;padding-bottom:8px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip{bottom:auto;top:100%;margin-top:25px;margin-bottom:0;border-radius:0 0 6px 6px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;bottom:100%;top:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip-picture{display:none}[mkz] .mkz-c__handler_type_bar .mkz-c__btn{display:flex;align-items:center;padding:8px 20px;border-radius:15px 15px 0 0;transition:padding 0.2s ease-out}[mkz] .mkz-c__handler_type_bar .mkz-c__btn:hover{padding-bottom:20px}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text{flex:1;font-size:14px;line-height:18px;font-weight:600;max-width:230px;min-height:18px}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-online,[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-offline{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-picture{flex:0 0 14px;height:14px;margin-left:5px}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip{position:absolute;bottom:100%;right:0;margin-bottom:25px;box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#7261FF;padding:30px 5px;border-radius:6px 6px 0 0;min-width:47px;max-width:80px;box-sizing:border-box;font-weight:600;font-size:16px;line-height:18px;text-align:center}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;top:100%;height:20px;clip-path:polygon(0 0, 50% 100%, 100% 0, 0 0);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25);margin:-1px 0}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip .mkz-c__tooltip-text{overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__btn-text-online{display:none}[mkz] .mkz-c__btn-text-offline{display:block}[mkz] .mkz-c__tooltip{opacity:0;visibility:hidden;transition:opacity 0.2s linear, visibility 0.4s 0s linear}[mkz] .mkz-c__submit{cursor:pointer;transition:all linear 0.2s;opacity:1;color:#787878}[mkz] .mkz-c__submit_disabled_yes{cursor:default;opacity:0.5}[mkz] .mkz-c__chat{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:1;visibility:visible;position:fixed;right:0;bottom:0;width:100%;max-width:375px;max-height:800px;height:100vh;z-index:10000}[mkz] .mkz-c__chat_position_left{left:0;right:auto}[mkz] .mkz-c__chat_position_left .mkz-c__cart,[mkz] .mkz-c__chat_position_left .mkz-c__cart-shadow{right:0;left:25px}[mkz] .mkz-c__cart,[mkz] .mkz-c__cart-shadow{position:absolute;left:0;top:25px;right:25px;bottom:25px;display:flex;justify-content:stretch;flex-direction:column;border-radius:6px;z-index:5}[mkz] .mkz-c__cart-shadow{z-index:0;box-shadow:0 0 10px rgba(25,25,29,0.25);opacity:0.75}[mkz] .mkz-c__head,[mkz] .mkz-c__content,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{padding:0 15px}[mkz] .mkz-c__head,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{flex:0}[mkz] .mkz-c__content,[mkz] .mkz-c__docs{background-color:#fff}[mkz] .mkz-c__content{flex:1;overflow:hidden;overflow-y:auto}[mkz] .mkz-c__head{display:flex;align-items:center;border-bottom:1px solid #E0E0E0;padding-top:5px;padding-bottom:5px;border-radius:6px 6px 0 0;min-height:60px;box-sizing:border-box}[mkz] .mkz-c__head-state{flex:0;padding-right:12px}[mkz] .mkz-c__head-m{flex:1}[mkz] .mkz-c__head-action{flex:0;padding-left:12px}[mkz] .mkz-c__copy{position:absolute;left:0;bottom:0;right:0;text-align:center;font-size:11px;line-height:24px;display:block;color:#787878;text-decoration:none;text-shadow:0 0 1px #fff}[mkz] .mkz-c__copy:hover{text-decoration:none}[mkz] .mkz-c__m-assign-text,[mkz] .mkz-c__m-unassign-text{font-weight:600;font-size:14px;line-height:1.2em}[mkz] .mkz-c__m-assign-post{font-size:11px;line-height:1.2em}[mkz] .mkz-c__m-assign-text,[mkz] .mkz-c__m-assign-post,[mkz] .mkz-c__m-assign-avatar{display:none}[mkz] .mkz-c__m-assign-avatar{width:40px;height:40px;border-radius:50%}[mkz] .mkz-c__close{cursor:pointer;padding:10px;margin:0 -10px;opacity:0.7;transition:all linear 0.2s}[mkz] .mkz-c__close:hover{opacity:1}[mkz] .mkz-c__state-wrap{position:relative;min-width:10px;min-height:10px}[mkz] .mkz-c__state{position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background-color:red;transition:background 0.5s linear;box-shadow:0 0 1px 1px #fff}[mkz] .mkz-c__footer{border-top:1px solid #E0E0E0;display:flex;align-items:center;padding-top:20px;padding-bottom:20px;background-color:#fff;border-radius:0 0 6px 6px}[mkz] .mkz-c__footer-msg{flex:1}[mkz] .mkz-c__footer-btn{flex:0;display:none}[mkz] .mkz-c__input{display:block;width:100%;resize:none;padding:0;font-size:13px;line-height:1.2em;font-family:Geneva,Arial,Helvetica,sans-serif;color:#000;border-style:none;outline-style:none;background-color:transparent;overflow:hidden;max-height:50vh}[mkz] .mkz-c__btn{color:#7261FF;cursor:pointer}[mkz] .mkz-c__btn-unread{background-color:red;width:16px;height:16px;font-size:8px;line-height:16px;text-align:center;color:#fff;overflow:hidden;position:absolute;right:-5px;top:-5px;border-radius:50%;box-shadow:0 0 1px 2px #fff}[mkz] .mkz-c__list{padding:20px 0}[mkz] .mkz-c__i{display:flex;margin:20px 0}[mkz] .mkz-c__i_type_client{flex-direction:row-reverse}[mkz] .mkz-c__i_type_client .mkz-c__i-avatar{display:none;background-color:#E7FEEA}[mkz] .mkz-c__i_type_client .mkz-c__i-msg{background-color:#fff;border-radius:6px 6px 0 6px}[mkz] .mkz-c__i-content{max-width:100%;display:flex;flex-direction:column;align-items:flex-start}[mkz] .mkz-c__i-avatar{width:24px;height:24px;border-radius:50%;margin:0 5px 0 0}[mkz] .mkz-c__i-msg{text-align:left;background-color:#E7FEEA;border-radius:6px 6px 6px 0;padding:8px 15px;box-shadow:0px 0px 4px rgba(0,0,0,0.12),0px 0px 1px rgba(0,0,0,0.48);font-size:13px;line-height:1.5em}[mkz] .mkz-c__i-msg:not(:last-child){margin-bottom:15px}[mkz] .mkz-c__i-msg-overflow{overflow:hidden;text-overflow:ellipsis;padding:0 1px;margin:0 -1px}[mkz] .mkz-c-o__i{width:230px}[mkz] .mkz-c-o__i:not(:last-child){margin-bottom:20px}[mkz] .mkz-c-o__content{padding:20px;border:1px solid #E0E0E0;border-radius:6px}[mkz] .mkz-c-o__preview-link{display:flex;align-items:center;justify-content:center;height:104px;margin-bottom:10px}[mkz] .mkz-c-o__preview-img{display:block;max-width:100%;max-height:100%;color:#787878}[mkz] .mkz-c-o__name{font-size:13px;line-height:18px;margin-bottom:10px}[mkz] .mkz-c-o__name-link{color:#000;text-decoration:none;cursor:pointer}[mkz] .mkz-c-o__name-link:hover{text-decoration:underline}[mkz] .mkz-c-o__info{display:flex;align-items:baseline;margin-bottom:15px}[mkz] .mkz-c-o__info-price,[mkz] .mkz-c-o__info-avaliable{flex:1}[mkz] .mkz-c-o__info-price{font-weight:600;font-size:16px;line-height:1.2em;padding-right:10px}[mkz] .mkz-c-o__info-avaliable{text-align:right;font-size:12px;line-height:1.2em;white-space:nowrap}[mkz] .mkz-c-o__info-avaliable_color_green{color:#37833B}[mkz] .mkz-c-o__info-avaliable_color_red{color:#FC4566}[mkz] .mkz-c-o__btn{font-weight:600;font-size:13px;line-height:1.2em;color:#fff;background-color:#FF6575;border-radius:99px;padding:8px 15px;text-align:center;display:block;outline-style:none;text-decoration:none;cursor:pointer}[mkz] .mkz-c-o__btn[disabled],[mkz] .mkz-c-o__btn[disabled]:hover{background-color:#DF4555;cursor:default}[mkz] .mkz-c-o__btn:hover{text-decoration:none;background-color:#EF5565}[mkz] .mkz-c-o__counter{font-size:10px;line-height:18px;padding:3px 10px;color:#787878}[mkz] .mkz-c-docs{margin:10px -3px;overflow:hidden}[mkz] .mkz-c-docs__list{display:flex}[mkz] .mkz-c-docs__i{flex:1;padding:0 3px;box-sizing:border-box}[mkz] .mkz-c-docs__btn{cursor:pointer;font-size:11px;line-height:1.2em;color:#000;background-color:#F0F0F1;border:1px solid #E0E0E0;border-radius:10px;text-align:center;padding:4px 15px;display:block;width:100%;box-sizing:border-box;white-space:nowrap}[mkz] .mkz-c-docs__btn:hover{background-color:#E0E0E1}[mkz] .mkz-f{width:230px;margin:0;padding:5px 0}[mkz] .mkz-f__row:not(:last-child){margin-bottom:10px}[mkz] .mkz-f__label{display:block;font-size:14px;line-height:1.2em;margin-bottom:4px}[mkz] .mkz-f__input,[mkz] .mkz-f__select{display:block;width:100%;box-sizing:border-box;resize:none;padding:0 0 0 10px;font-size:13px;line-height:30px;font-family:Geneva,Arial,Helvetica,sans-serif;color:#000;outline-style:none;background-color:#fff;border-radius:6px;border:1px solid #CBCBCB;overflow:hidden}[mkz] .mkz-f__input[disabled],[mkz] .mkz-f__select[disabled]{color:#777;background-color:#eee}[mkz] .mkz-f__select{appearance:none;-moz-appearance:none;-webkit-appearance:none;position:relative;background-image:url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='50' fill='%23000000'><polygon points='0,0 100,0 50,50'/></svg>\");background-repeat:no-repeat;background-position:calc(100% - 10px) center;background-size:10px}[mkz] .mkz-f__note{font-size:9px;line-height:1.2em;text-align:center}[mkz] .mkz-f__btn{display:block;width:100%;box-sizing:border-box;font-weight:600;font-size:13px;line-height:1.2em;color:#fff;background-color:#7261FF;border-radius:6px;border-style:none;padding:8px 15px;text-align:center;outline-style:none;text-decoration:none;cursor:pointer;text-transform:uppercase}[mkz] .mkz-f__btn[disabled],[mkz] .mkz-f__btn[disabled]:hover{background-color:#6251EF;color:#aaa;cursor:default}[mkz] .mkz-f__btn:hover{text-decoration:none;background-color:#6251EF}[mkz] .mkz-f__invalid,[mkz] .mkz-f__invalid::placeholder{color:red !important;box-shadow:0 0 1px 1px red !important}@media (max-width: 600px){[mkz] .mkz-c__chat{max-height:none;max-width:none;width:auto;height:auto;right:0;left:0;top:0;bottom:0}[mkz] .mkz-c__cart,[mkz] .mkz-c__chat_position_left .mkz-c__cart{right:0;left:0;top:0;bottom:0;border-style:none}[mkz] .mkz-c__cart,[mkz] .mkz-c__head,[mkz] .mkz-c__footer{border-radius:0}[mkz] .mkz-c__footer-btn{display:block}[mkz] .mkz-c__copy{display:none}}@media (max-width: 600px){.mkz-c-fixed{position:fixed !important;height:100% !important;width:100% !important;max-width:100% !important;overflow-x:hidden !important}.mkz-c-fixed body{z-index:auto !important;zoom:1 !important;max-width:100% !important;overflow-x:hidden !important}}\n"},function(t,e){t.exports={removeClass:function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},appendHTML:function(t,e){var n=document.createElement("div");n.innerHTML=e;var i=this.getFirstChild(n);return t.appendChild(i),i},beforeHTML:function(t,e){var n=document.createElement("div");n.innerHTML=e;var i=this.getFirstChild(n);return t.parentNode.insertBefore(i,t),i},getFirstChild:function(t){for(var e=t.firstChild;null!=e&&3==e.nodeType;)e=e.nextSibling;return e},htmlToText:function(t){var e=document.createElement("div");return e.textContent=t||"",e.innerHTML}}},function(t,e,n){n(10);var i=n(18).Socket,r=n(1),o=n(3),s=n(20).default,a=n(2),c=n(24),h=n(25).default;t.exports={version:"1.2.8",store:{},libs:{},previewMode:!1,create:function(t,e){this.destroy(),this.settings=e,this.locale=t,this.log("chat","created"),a.init(this),this.createConnection(),this.sound=new h(this.settings.appearance.client_sound_path)},destroy:function(){this.view&&this.view.destroy(),this.socket&&this.socket.disconnect()},preview:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.previewMode=!0,this.settings=e,this.locale=t,this.view=new s(this),this.view.history=n.history||[],this.view.width=n.width||null,this.view.render(),n.collapsed?this.view.showNotice():this.view.collapse(),n.currentAgent&&(this.currentAgent=n.currentAgent,this.view.assignAgent(),this.updateAgentState())},currentAgent:null,agents:[],agentIsOnline:!1,sessionsCount:0,settings:{},locale:null,log:function(){var t;this.libs.log&&(t=this.libs.log).push.apply(t,["chat"].concat(Array.prototype.slice.call(arguments)))},createConnection:function(){var t=this;this.socket=new i("//".concat(this.store.chatEndpoint,"/socket")),this.view=new s(this),this.socket.onOpen(this.handlerConnected.bind(this)),this.socket.onClose(this.handlerDisconnected.bind(this)),this.socket.connect(),this.servicChannel=this.socket.channel("chat-client:".concat(this.store.appKey)),this.servicChannel.join().receive("error",(function(){return console.error("Cannot join channel ".concat(t.servicChannel.topic))})),this.servicChannel.on("agent:entered",this.handlerAgentStatus.bind(this,!0)),this.servicChannel.on("agent:exited",this.handlerAgentStatus.bind(this,!1)),this.clientChannel=this.socket.channel("room:".concat(this.store.appKey,":").concat(this.store.uid)),this.clientChannel.join().receive("ok",this.handlerJoined.bind(this)).receive("error",this.handlerFailJoined.bind(this)),this.clientChannel.on("client:entered",this.handlerClientEntered.bind(this)),this.clientChannel.on("message:new",this.handlerMsg.bind(this)),this.clientChannel.on("message:resend",this.handlerMsgResend.bind(this)),this.clientChannel.on("agent:assign",this.handlerAgentAssign.bind(this)),this.clientChannel.on("survey:show",this.handlerSurveyShow.bind(this)),this.clientChannel.on("event:survey_submitted",this.handlerSurveySubmitted.bind(this))},handlerConnected:function(){this.view.connected()},handlerDisconnected:function(){this.view.disconnected()},handlerJoined:function(){this.view.render(),this.view.scrollBottom(),this.view.enableSending(),this.log("chat","joined")},handlerFailJoined:function(){console.error("Cannot join channel ".concat(this.clientChannel.topic))},handlerAgentStatus:function(t,e){var n=e.agent_id,i=this.getAgent(n);i&&(i.isOnline=t,this.updateAgentState())},handlerClientEntered:function(t){this.setAgents(t.agents),this.sessionsCount=t.sessionsCount,this.setCurrentAgent(t.current_agent_id),this.updateAgentState(),this.libs.eEmit&&this.libs.eEmit.emit("plugin.chat.channel.entered"),this.log("chat","ClientEntered",t)},handlerSurveyShow:function(t){this.view.windowFocus&&c.trackShow(t.custom_fields.uid),this.handlerMsg(t)},handlerMsg:function(t){t=this.addMsg(t),this.stateChangeMsg(t),this.view.scrollBottom(),this.log("chat","Msg",t)},handlerMsgResend:function(t){t=this.addMsg(t),this.stateChangeMsg(t),this.view.scrollBottom(),this.setCurrentAgent(t.current_agent_id),this.log("chat","Resend",t)},handlerAgentAssign:function(t){this.setCurrentAgent(t.target_agent_id)},handlerCollapse:function(t){if(!0!==t){var e=o.getList(),n=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value;this.pusherMsgState(c,"read")}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}o.resetList(),this.view.renderUnread()}},handlerSurveySubmitted:function(t){var e=r.findMsg(t.custom_fields.muid);e&&(e.custom_fields.submitted=!0,r.addMsg(e),this.view.renderMessage(e))},pusherTyping:function(t){if(t)return this.clientChannel.push("client:activity",{type:"typing",text:t})},pusherNewMsg:function(t){if(t){var e=+new Date,n=this.store.uid,i={muid:"".concat(n,":c:").concat(e),text:t,status:"sent",sent_at:this.getDateTime()},o=r.getHistory(),s=o.length>0&&o[o.length-1];return s&&"message:auto"===s.msg_type&&(i.prev_auto_message={muid:s.muid,agent_id:0,text:s.text,status:"read",sent_at:s.sent_at,device_uid:n},a.trackReply(s.muid)),this.clientChannel.push("message:new",i)}},pusherMsgState:function(t,e){t&&this.clientChannel.push("message:status:change",{muid:t,new_status:e,sent_at:this.getDateTime()})},pusherNewSurveyMsg:function(t,e){var n=r.findMsg(t);n&&(this.clientChannel.push("survey:submit",{muid:t,title:n.custom_fields.title}),c.trackSubmit(n.custom_fields.uid,e))},getDateTime:function(){return(new Date).toISOString().replace("Z","000Z")},stateChangeMsg:function(t){null!==t.agent_id&&(!1===this.view.collapsed?this.pusherMsgState(t.muid,"read"):(this.pusherMsgState(t.muid,"delivered"),o.addItem(t.muid)))},getMsgType:function(t){var e=/[^:]*:([a-z]+)/.exec(t.muid);return e?e[1]:"c"},addMsg:function(t){if("auto"===t.sender_type&&(t.agent_id=a.getMsgAgentId(t.muid),a.removeItem(t)),null!==t.agent_id){var e=this.getAgent(t.agent_id);e&&(t.sender_avatar_url=e.avatar_url||e.sender_avatar_url,t.sender_name=e.name||t.sender_name),this.view.windowFocus&&!this.view.collapsed||this.sound.play(),!0===this.view.collapsed&&this.view.renderUnread()}r.addMsg(t);var n=r.getNextMsg(t.muid);return this.view.renderMessage(t,n),t},setCurrentAgent:function(t){(t||this.currentAgent)&&(this.currentAgent=this.getAgent(t),this.currentAgent?this.view.assignAgent():this.view.unassignAgent())},setAgents:function(t){this.agents=t.reduce((function(t,e){return t[e.id]=e,t}),{})},getAgent:function(t){return this.agents[t]||null},updateAgentState:function(){this.currentAgent?this.agentIsOnline=this.currentAgent.isOnline:this.agentIsOnline=Object.values(this.agents).find((function(t){return t.isOnline}))&&!0,this.view.renderAgentState()}}},function(t,e,n){var i,r,o;!function(s,a){"use strict";r=[n(13)],void 0===(o="function"==typeof(i=function(t){var e=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,i=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(n))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(t){return!!t.match(n)}),this).map((function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"("),i=n.match(/ (\((.+):(\d+):(\d+)\)$)/),r=(n=i?n.replace(i[0],""):n).split(/\s+/).slice(1),o=this.extractLocation(i?i[1]:r.pop()),s=r.join(" ")||void 0,a=["eval","<anonymous>"].indexOf(o[0])>-1?void 0:o[0];return new t({functionName:s,fileName:a,lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(t){return!t.match(i)}),this).map((function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new t({functionName:e});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,i=e.match(n),r=i&&i[1]?i[1]:void 0,o=this.extractLocation(e.replace(n,""));return new t({functionName:r,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),r=[],o=2,s=i.length;o<s;o+=2){var a=n.exec(i[o]);a&&r.push(new t({fileName:a[2],lineNumber:a[1],source:i[o]}))}return r},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),r=[],o=0,s=i.length;o<s;o+=2){var a=n.exec(i[o]);a&&r.push(new t({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:i[o]}))}return r},parseOpera11:function(n){return n.stack.split("\n").filter((function(t){return!!t.match(e)&&!t.match(/^Error created at/)}),this).map((function(e){var n,i=e.split("@"),r=this.extractLocation(i.pop()),o=i.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t({functionName:s,args:a,fileName:r[0],lineNumber:r[1],columnNumber:r[2],source:e})}),this)}}})?i.apply(e,r):i)||(t.exports=o)}()},function(t,e){var n=function(t){function e(){this.fetch=!1,this.DOMException=t.DOMException}return e.prototype=t,new e}("undefined"!=typeof self?self:this);!function(t){!function(e){var n="URLSearchParams"in t,i="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in t,s="ArrayBuffer"in t;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function h(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){return"string"!=typeof t&&(t=String(t)),t}function u(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return i&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function m(t){var e=new FileReader,n=f(e);return e.readAsArrayBuffer(t),n}function _(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:r&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&r&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=_(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||c(t))?this._bodyArrayBuffer=_(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var t,e,n,i=p(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=f(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(t,e){t=h(t),e=l(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},d.prototype.delete=function(t){delete this.map[h(t)]},d.prototype.get=function(t){return t=h(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(h(t))},d.prototype.set=function(t,e){this.map[h(t)]=l(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),u(t)},d.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),u(t)},d.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),u(t)},i&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(t,e){var n,i,r=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),v.indexOf(i)>-1?i:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function k(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}})),e}function b(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},g.call(y.prototype),g.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},b.error=function(){var t=new b(null,{status:0,statusText:""});return t.type="error",t};var w=[301,302,303,307,308];b.redirect=function(t,e){if(-1===w.indexOf(e))throw new RangeError("Invalid status code");return new b(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function z(t,n){return new Promise((function(i,o){var s=new y(t,n);if(s.signal&&s.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var t,e,n={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();e.append(i,r)}})),e)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;i(new b(r,n))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),s.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}z.polyfill=!0,t.fetch||(t.fetch=z,t.Headers=d,t.Request=y,t.Response=b),e.Headers=d,e.Request=y,e.Response=b,e.fetch=z}({})}(n),delete n.fetch.polyfill,(e=n.fetch).default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e},function(t,e,n){"use strict";n.r(e);var i=n(6);mkz("initPlugin","chat",n.n(i).a)},function(t,e,n){(function(e){if(e.env){var i=new(0,n(12).Notifier)({projectId:229028,projectKey:"3927498a0d17867a76acf5aa97eba72d",environment:"production"});t.exports=i}else t.exports={}}).call(this,n(11))},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c,h=[],l=!1,u=-1;function d(){l&&c&&(l=!1,c.length?h=c.concat(h):u=-1,h.length&&p())}function p(){if(!l){var t=a(d);l=!0;for(var e=h.length;e;){for(c=h,h=[];++u<e;)c&&c[u].run();u=-1,e=h.length}c=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new f(t,e)),1!==h.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e),n.d(e,"Notifier",(function(){return it}));var i=n(7),r=n.n(i),o=n(8),s=n.n(o),a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var h=function(){return(h=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function l(t,e){return t>>e||1}var u=function(){function t(t){this.maxStringLength=1024,this.maxObjectLength=128,this.maxArrayLength=128,this.maxDepth=8,this.keys=[],this.keysBlacklist=[],this.seen=[];var e=t.level||0;this.keysBlacklist=t.keysBlacklist||[],this.maxStringLength=l(this.maxStringLength,e),this.maxObjectLength=l(this.maxObjectLength,e),this.maxArrayLength=l(this.maxArrayLength,e),this.maxDepth=l(this.maxDepth,e)}return t.prototype.truncate=function(t,e,n){if(void 0===e&&(e=""),void 0===n&&(n=0),null==t)return t;switch(typeof t){case"boolean":case"number":case"function":return t;case"string":return this.truncateString(t);case"object":break;default:return this.truncateString(String(t))}if(t instanceof String)return this.truncateString(t.toString());if(t instanceof Boolean||t instanceof Number||t instanceof Date||t instanceof RegExp)return t;if(t instanceof Error)return this.truncateString(t.toString());if(this.seen.indexOf(t)>=0)return"[Circular "+this.getPath(t)+"]";var i=function(t){return Object.prototype.toString.apply(t).slice("[object ".length,-1)}(t);if(++n>this.maxDepth)return"[Truncated "+i+"]";switch(this.keys.push(e),this.seen.push(t),i){case"Array":return this.truncateArray(t,n);case"Object":return this.truncateObject(t,n);default:var r=this.maxDepth;this.maxDepth=0;var o=this.truncateObject(t,n);return o.__type=i,this.maxDepth=r,o}},t.prototype.getPath=function(t){for(var e=this.seen.indexOf(t),n=[this.keys[e]],i=e;i>=0;i--){var r=this.seen[i];r&&p(r,n[0])===t&&(t=r,n.unshift(this.keys[i]))}return"~"+n.join(".")},t.prototype.truncateString=function(t){return t.length>this.maxStringLength?t.slice(0,this.maxStringLength)+"...":t},t.prototype.truncateArray=function(t,e){void 0===e&&(e=0);for(var n=0,i=[],r=0;r<t.length;r++){var o=t[r];if(i.push(this.truncate(o,r.toString(),e)),++n>=this.maxArrayLength)break}return i},t.prototype.truncateObject=function(t,e){void 0===e&&(e=0);var n=0,i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))if(f(r,this.keysBlacklist))i[r]="[Filtered]";else{var o=p(t,r);if(void 0!==o&&"function"!=typeof o&&(i[r]=this.truncate(o,r,e),++n>=this.maxObjectLength))break}return i},t}();function d(t,e){return void 0===e&&(e={}),new u(e).truncate(t)}function p(t,e){try{return t[e]}catch(t){return}}function f(t,e){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r===t)return!0;if(r instanceof RegExp&&t.match(r))return!0}return!1}var m=function(){function t(t,e,n){this._dur=0,this._level=0,this._metric=t,this.name=e,this.startTime=n||new Date}return t.prototype.end=function(t){this.endTime=t||new Date,this._dur+=this.endTime.getTime()-this.startTime.getTime(),this._metric._incGroup(this.name,this._dur),this._metric=null},t.prototype._pause=function(){if(!this._paused()){var t=new Date;this._dur+=t.getTime()-this.startTime.getTime(),this.startTime=null}},t.prototype._resume=function(){this._paused()&&(this.startTime=new Date)},t.prototype._paused=function(){return null==this.startTime},t}(),_=function(){function t(){this._spans={},this._groups={},this.startTime=new Date}return t.prototype.end=function(t){this.endTime||(this.endTime=t||new Date)},t.prototype.isRecording=function(){return!0},t.prototype.startSpan=function(t,e){var n=this._spans[t];n?n._level++:(n=new m(this,t,e),this._spans[t]=n)},t.prototype.endSpan=function(t,e){var n=this._spans[t];n?n._level>0?n._level--:(n.end(e),delete this._spans[n.name]):console.error("airbrake: span=%s does not exist",t)},t.prototype._incGroup=function(t,e){this._groups[t]=(this._groups[t]||0)+e},t.prototype._duration=function(){return this.endTime||(this.endTime=new Date),this.endTime.getTime()-this.startTime.getTime()},t}(),g=function(){function t(){}return t.prototype.isRecording=function(){return!1},t.prototype.startSpan=function(t,e){},t.prototype.endSpan=function(t,e){},t.prototype._incGroup=function(t,e){},t}(),v=function(){function t(){this._noopMetric=new g,this._context={},this._historyMaxLen=20,this._history=[]}return t.prototype.clone=function(){var e=new t;return e._context=h({},this._context),e._history=this._history.slice(),e},t.prototype.setContext=function(t){this._context=Object.assign(this._context,t)},t.prototype.context=function(){var t=h({},this._context);return this._history.length>0&&(t.history=this._history.slice()),t},t.prototype.pushHistory=function(t){this._isDupState(t)?this._lastRecord.num?this._lastRecord.num++:this._lastRecord.num=2:(t.date||(t.date=new Date),this._history.push(t),this._lastRecord=t,this._history.length>this._historyMaxLen&&(this._history=this._history.slice(-this._historyMaxLen)))},t.prototype._isDupState=function(t){if(!this._lastRecord)return!1;for(var e in t)if(t.hasOwnProperty(e)&&"date"!==e&&t[e]!==this._lastRecord[e])return!1;return!0},t.prototype.routeMetric=function(){return this._routeMetric||this._noopMetric},t.prototype.setRouteMetric=function(t){this._routeMetric=t},t.prototype.queueMetric=function(){return this._queueMetric||this._noopMetric},t.prototype.setQueueMetric=function(t){this._queueMetric=t},t}(),y="object"==typeof console&&console.warn;function k(t){try{return r.a.parse(t)}catch(e){y&&t.stack&&console.warn("ErrorStackParser:",e.toString(),t.stack)}return t.fileName?[t]:[]}function b(t){var e=[];if(t.noStack)e.push({function:t.functionName||"",file:t.fileName||"",line:t.lineNumber||0,column:t.columnNumber||0});else{var n=k(t);if(0===n.length)try{throw new Error("fake")}catch(t){(n=k(t)).shift(),n.shift()}for(var i=0,r=n;i<r.length;i++){var o=r[i];e.push({function:o.functionName||"",file:o.fileName||"",line:o.lineNumber||0,column:o.columnNumber||0})}}return{type:t.name?t.name:"",message:t.message?String(t.message):String(t),backtrace:e}}var w=new RegExp(["^","\\[(\\$.+)\\]","\\s","([\\s\\S]+)","$"].join(""));function z(t){var e=t.errors[0];if(""!==e.type&&"Error"!==e.type)return t;var n=e.message.match(w);return null!==n&&(e.type=n[1],e.message=n[2]),t}var x=["Script error","Script error.","InvalidAccessError"];function C(t){var e=t.errors[0];if(""===e.type&&-1!==x.indexOf(e.message))return null;if(e.backtrace&&e.backtrace.length>0&&"<anonymous>"===e.backtrace[0].file)return null;return t}var S=new RegExp(["^","Uncaught\\s","(.+?)",":\\s","(.+)","$"].join(""));function T(t){var e=t.errors[0];if(""!==e.type&&"Error"!==e.type)return t;var n=e.message.match(S);return null!==n&&(e.type=n[1],e.message=n[2]),t}var E={unauthorized:new Error("airbrake: unauthorized: project id or key are wrong"),ipRateLimited:new Error("airbrake: IP is rate limited")},j=0;function O(t){if(Date.now()/1e3<j)return Promise.reject(E.ipRateLimited);var e={method:t.method,body:t.body};return s()(t.url,e).then((function(t){if(401===t.status)throw E.unauthorized;if(429===t.status){var e=t.headers.get("X-RateLimit-Delay");if(!e)throw E.ipRateLimited;var n=parseInt(e,10);throw n>0&&(j=Date.now()/1e3+n),E.ipRateLimited}if(204===t.status)return{json:null};if(404===t.status)throw new Error("404 Not Found");return t.status>=200&&t.status<300?t.json().then((function(t){return{json:t}})):t.status>=400&&t.status<500?t.json().then((function(t){throw new Error(t.message)})):t.text().then((function(e){throw new Error("airbrake: fetch: unexpected response: code="+t.status+" body='"+e+"'")}))}))}function A(t){return function(e){return function(t,e){if(Date.now()/1e3<L)return Promise.reject(E.ipRateLimited);return new Promise((function(n,i){e({url:t.url,method:t.method,body:t.body,headers:{"content-type":"application/json"},timeout:t.timeout},(function(t,e,r){if(t)i(t);else{if(!e.statusCode)return t=new Error("airbrake: request: response statusCode is "+e.statusCode),void i(t);if(401!==e.statusCode)if(429!==e.statusCode)if(204!==e.statusCode)if(e.statusCode>=200&&e.statusCode<300){var o=void 0;try{o=JSON.parse(r)}catch(t){return void i(t)}n(o)}else{if(e.statusCode>=400&&e.statusCode<500){o=void 0;try{o=JSON.parse(r)}catch(t){return void i(t)}return t=new Error(o.message),void i(t)}r=r.trim(),t=new Error("airbrake: node: unexpected response: code="+e.statusCode+" body='"+r+"'"),i(t)}else n({json:null});else{i(E.ipRateLimited);var s=e.headers["x-ratelimit-delay"];if(!s)return;var a=void 0;if("string"==typeof s)a=s;else{if(!(s instanceof Array))return;a=s[0]}var c=parseInt(a,10);c>0&&(L=Date.now()/1e3+c)}else i(E.unauthorized)}}))}))}(e,t)}}var M,L=0;function N(t){return t.request?A(t.request):O}var R=!1;try{M=n(14),R=!0}catch(t){}var P=function(){function t(){this.count=0,this.sum=0,this.sumsq=0,this._td=new M.Digest}return t.prototype.add=function(t){0===t&&(t=1e-5),this.count+=1,this.sum+=t,this.sumsq+=t*t,this._td&&this._td.push(t)},t.prototype.toJSON=function(){return{count:this.count,sum:this.sum,sumsq:this.sumsq,tdigestCentroids:D(this._td)}},t}(),q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.groups={},e}return c(e,t),e.prototype.addGroups=function(t,e){for(var n in this.add(t),e)this.addGroup(n,e[n])},e.prototype.addGroup=function(t,e){var n=this.groups[t];n||(n=new P,this.groups[t]=n),n.add(e)},e.prototype.toJSON=function(){return{count:this.count,sum:this.sum,sumsq:this.sumsq,tdigestCentroids:D(this._td),groups:this.groups}},e}(P);function D(t){var e=[],n=[];return t.centroids.each((function(t){e.push(t.mean),n.push(t.n)})),{mean:e,count:n}}var I=function(t){function e(e,n,i,r){void 0===e&&(e=""),void 0===n&&(n=""),void 0===i&&(i=0),void 0===r&&(r="");var o=t.call(this)||this;return o.method=e,o.route=n,o.statusCode=i,o.contentType=r,o.startTime=new Date,o}return c(e,t),e}(_),H=function(){function t(t){this._m={},this._opt=t,this._url=t.host+"/api/v5/projects/"+t.projectId+"/routes-stats?key="+t.projectKey,this._requester=N(t)}return t.prototype.notify=function(t){var e=this;if(R){var n=t._duration(),i=new Date(6e4*Math.floor(t.startTime.getTime()/6e4)),r={method:t.method,route:t.route,statusCode:t.statusCode,time:i},o=JSON.stringify(r),s=this._m[o];s||(s=new P,this._m[o]=s),s.add(n),this._timer||(this._timer=setTimeout((function(){e._flush()}),15e3))}},t.prototype._flush=function(){var t=[];for(var e in this._m)if(this._m.hasOwnProperty(e)){var n=JSON.parse(e),i=h(h({},n),this._m[e].toJSON());t.push(i)}this._m={},this._timer=null;var r=JSON.stringify({environment:this._opt.environment,routes:t}),o={method:"POST",url:this._url,body:r};this._requester(o).then((function(t){})).catch((function(t){console.error&&console.error("can not report routes stats",t)}))},t}(),B=function(){function t(t){this._m={},this._opt=t,this._url=t.host+"/api/v5/projects/"+t.projectId+"/routes-breakdowns?key="+t.projectKey,this._requester=N(t)}return t.prototype.notify=function(t){var e=this;if(R&&!(t.statusCode<200||t.statusCode>=300&&t.statusCode<400||404===t.statusCode||0===Object.keys(t._groups).length)){var n=t._duration();0===n&&(n=1e-5);var i=new Date(6e4*Math.floor(t.startTime.getTime()/6e4)),r={method:t.method,route:t.route,responseType:this._responseType(t),time:i},o=JSON.stringify(r),s=this._m[o];s||(s=new q,this._m[o]=s),s.addGroups(n,t._groups),this._timer||(this._timer=setTimeout((function(){e._flush()}),15e3))}},t.prototype._flush=function(){var t=[];for(var e in this._m)if(this._m.hasOwnProperty(e)){var n=JSON.parse(e),i=h(h({},n),this._m[e].toJSON());t.push(i)}this._m={},this._timer=null;var r=JSON.stringify({environment:this._opt.environment,routes:t}),o={method:"POST",url:this._url,body:r};this._requester(o).then((function(t){})).catch((function(t){console.error&&console.error("can not report routes breakdowns",t)}))},t.prototype._responseType=function(t){return t.statusCode>=500?"5xx":t.statusCode>=400?"4xx":t.contentType?t.contentType.split(";")[0].split("/")[-1]:""},t}(),F=function(t){function e(e){var n=t.call(this)||this;return n.queue=e,n.startTime=new Date,n}return c(e,t),e}(_),J=function(){function t(t){this._m={},this._opt=t,this._url=t.host+"/api/v5/projects/"+t.projectId+"/queues-stats?key="+t.projectKey,this._requester=N(t)}return t.prototype.notify=function(t){var e=this;if(R){var n=t._duration();0===n&&(n=1e-5);var i=new Date(6e4*Math.floor(t.startTime.getTime()/6e4)),r={queue:t.queue,time:i},o=JSON.stringify(r),s=this._m[o];s||(s=new q,this._m[o]=s),s.addGroups(n,t._groups),this._timer||(this._timer=setTimeout((function(){e._flush()}),15e3))}},t.prototype._flush=function(){var t=[];for(var e in this._m)if(this._m.hasOwnProperty(e)){var n=JSON.parse(e),i=h(h({},n),this._m[e].toJSON());t.push(i)}this._m={},this._timer=null;var r=JSON.stringify({environment:this._opt.environment,queues:t}),o={method:"POST",url:this._url,body:r};this._requester(o).then((function(t){})).catch((function(t){console.error&&console.error("can not report queues breakdowns",t)}))},t}(),U=function(){function t(t){void 0===t&&(t=""),this.method="",this.route="",this.query="",this.func="",this.file="",this.line=0,this.startTime=new Date,this.query=t}return t.prototype._duration=function(){return this.endTime||(this.endTime=new Date),this.endTime.getTime()-this.startTime.getTime()},t}(),$=function(){function t(t){this._m={},this._opt=t,this._url=t.host+"/api/v5/projects/"+t.projectId+"/queries-stats?key="+t.projectKey,this._requester=N(t)}return t.prototype.start=function(t){return void 0===t&&(t=""),new U(t)},t.prototype.notify=function(t){var e=this;if(R){var n=t._duration(),i=new Date(6e4*Math.floor(t.startTime.getTime()/6e4)),r={method:t.method,route:t.route,query:t.query,func:t.func,file:t.file,line:t.line,time:i},o=JSON.stringify(r),s=this._m[o];s||(s=new P,this._m[o]=s),s.add(n),this._timer||(this._timer=setTimeout((function(){e._flush()}),15e3))}},t.prototype._flush=function(){var t=[];for(var e in this._m)if(this._m.hasOwnProperty(e)){var n=JSON.parse(e),i=h(h({},n),this._m[e].toJSON());t.push(i)}this._m={},this._timer=null;var r=JSON.stringify({environment:this._opt.environment,queries:t}),o={method:"POST",url:this._url,body:r};this._requester(o).then((function(t){})).catch((function(t){console.error&&console.error("can not report queries stats",t)}))},t}(),X=function(){function t(t){var e,n,i=this;if(this._filters=[],this._scope=new v,this._onClose=[],!t.projectId||!t.projectKey)throw new Error("airbrake: projectId and projectKey are required");this._opt=t,this._opt.host=this._opt.host||"https://api.airbrake.io",this._opt.timeout=this._opt.timeout||1e4,this._opt.keysBlacklist=this._opt.keysBlacklist||[/password/,/secret/],this._url=this._opt.host+"/api/v3/projects/"+this._opt.projectId+"/notices?key="+this._opt.projectKey,this._processor=this._opt.processor||b,this._requester=N(this._opt),this.addFilter(C),this.addFilter((function(t){var i=JSON.stringify(t.errors);return i===e?null:(n&&clearTimeout(n),e=i,n=setTimeout((function(){e=""}),1e3),t)})),this.addFilter(T),this.addFilter(z),this.addFilter((function(t){return t.context.notifier={name:"airbrake-js/browser",version:"1.0.6",url:"https://github.com/airbrake/airbrake-js"},i._opt.environment&&(t.context.environment=i._opt.environment),t})),this.routes=new V(this),this.queues=new G(this),this.queries=new $(this._opt)}return t.prototype.close=function(){for(var t=0,e=this._onClose;t<e.length;t++){(0,e[t])()}},t.prototype.scope=function(){return this._scope},t.prototype.setActiveScope=function(t){this._scope=t},t.prototype.addFilter=function(t){this._filters.push(t)},t.prototype.notify=function(t){var e={errors:[],context:Object.assign({severity:"error"},this.scope().context(),t.context),params:t.params||{},environment:t.environment||{},session:t.session||{}};if("object"==typeof t&&void 0!==t.error||(t={error:t}),!t.error)return e.error=new Error("airbrake: got err="+JSON.stringify(t.error)+", wanted an Error"),Promise.resolve(e);var n=this._processor(t.error);e.errors.push(n);for(var i=0,r=this._filters;i<r.length;i++){var o=(0,r[i])(e);if(null===o)return e.error=new Error("airbrake: error is filtered"),Promise.resolve(e);e=o}return e.context||(e.context={}),e.context.language="JavaScript",this._sendNotice(e)},t.prototype._sendNotice=function(t){var e=function(t,e){var n=void 0===e?{}:e,i=n.maxLength,r=void 0===i?64e3:i,o=n.keysBlacklist,s=void 0===o?[]:o;if(t.errors)for(var a=0;a<t.errors.length;a++){var c=new u({keysBlacklist:s});t.errors[a]=c.truncate(t.errors[a])}for(var h="",l=["context","params","environment","session"],p=0;p<8;p++){for(var f={level:p,keysBlacklist:s},m=0,_=l;m<_.length;m++){(b=t[k=_[m]])&&(t[k]=d(b,f))}if((h=JSON.stringify(t)).length<r)return h}var g={json:h.slice(0,Math.floor(r/2))+"..."};l.push("errors");for(var v=0,y=l;v<y.length;v++){var k,b;(b=t[k=y[v]])&&(h=JSON.stringify(b),g[k]=h.length)}var w=new Error("airbrake: notice exceeds max length and can't be truncated");throw w.params=g,w}(t,{keysBlacklist:this._opt.keysBlacklist});if(this._opt.reporter){if("function"==typeof this._opt.reporter)return this._opt.reporter(t);console.warn("airbrake: options.reporter must be a function")}var n={method:"POST",url:this._url,body:e};return this._requester(n).then((function(e){return t.id=e.json.id,t})).catch((function(e){return t.error=e,t}))},t.prototype.wrap=function(t,e){if(void 0===e&&(e=[]),t._airbrake)return t;var n=this,i=function(){var e=Array.prototype.slice.call(arguments),i=n._wrapArguments(e);try{return t.apply(this,i)}catch(t){throw n.notify({error:t,params:{arguments:e}}),this._ignoreNextWindowError(),t}};for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);for(var o=0,s=e;o<s.length;o++){r=s[o];t.hasOwnProperty(r)&&(i[r]=t[r])}return i._airbrake=!0,i.inner=t,i},t.prototype._wrapArguments=function(t){for(var e=0;e<t.length;e++){var n=t[e];"function"==typeof n&&(t[e]=this.wrap(n))}return t},t.prototype._ignoreNextWindowError=function(){},t.prototype.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.wrap(t);return i.apply(this,Array.prototype.slice.call(arguments,1))},t}(),V=function(){function t(t){this._notifier=t,this._routes=new H(t._opt),this._breakdowns=new B(t._opt)}return t.prototype.start=function(t,e,n,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=0),void 0===i&&(i="");var r=new I(t,e,n,i),o=this._notifier.scope().clone();return o.setContext({httpMethod:t,route:e}),o.setRouteMetric(r),this._notifier.setActiveScope(o),r},t.prototype.notify=function(t){t.end(),this._routes.notify(t),this._breakdowns.notify(t)},t}(),G=function(){function t(t){this._notifier=t,this._queues=new J(t._opt)}return t.prototype.start=function(t){var e=new F(t),n=this._notifier.scope().clone();return n.setContext({queue:t}),n.setQueueMetric(e),this._notifier.setActiveScope(n),e},t.prototype.notify=function(t){t.end(),this._queues.notify(t)},t}();function W(t){return window.navigator&&window.navigator.userAgent&&(t.context.userAgent=window.navigator.userAgent),window.location&&(t.context.url=String(window.location),t.context.rootDirectory=window.location.protocol+"//"+window.location.host),t}var K=["debug","log","info","warn","error"];var Z=["type","name","src"];function Q(t){var e=function(t){return function(e){var n;try{n=e.target}catch(t){return}if(n){var i={type:e.type};try{i.target=function(t){var e=[],n=t;for(;n;){var i=Y(n);if(""!==i&&(e.push(i),e.length>10))break;n=n.parentNode}if(0===e.length)return String(t);return e.reverse().join(" > ")}(n)}catch(t){i.target="<"+String(t)+">"}t.scope().pushHistory(i)}}}(t);window.addEventListener&&(window.addEventListener("load",e),window.addEventListener("error",(function(t){"error"in t||e(t)}),!0)),"object"==typeof document&&document.addEventListener&&(document.addEventListener("DOMContentLoaded",e),document.addEventListener("click",e),document.addEventListener("keypress",e))}function Y(t){if(!t)return"";var e=[];if(t.tagName&&e.push(t.tagName.toLowerCase()),t.id&&(e.push("#"),e.push(t.id)),t.classList&&Array.from)e.push("."),e.push(Array.from(t.classList).join("."));else if(t.className){var n=function(t){if(t.split)return t.split(" ").join(".");if(t.baseVal&&t.baseVal.split)return t.baseVal.split(" ").join(".");return console.error("unsupported HTMLElement.className type",typeof t),""}(t.className);""!==n&&(e.push("."),e.push(n))}if(t.getAttribute)for(var i=0,r=Z;i<r.length;i++){var o=r[i],s=t.getAttribute(o);s&&e.push("["+o+'="'+s+'"]')}return e.join("")}var tt="";function et(){return document.location&&document.location.pathname}function nt(t,e){var n=e.indexOf("://");n>=0?(n=(e=e.slice(n+3)).indexOf("/"),e=n>=0?e.slice(n):"/"):"/"!==e.charAt(0)&&(e="/"+e),t.scope().pushHistory({type:"location",from:tt,to:e}),tt=e}var it=function(t){function e(e){var n=t.call(this,e)||this;return n.offline=!1,n.todo=[],n._ignoreWindowError=0,n._ignoreNextXHR=0,n.addFilter(W),window.addEventListener&&(n.onOnline=n.onOnline.bind(n),window.addEventListener("online",n.onOnline),n.onOffline=n.onOffline.bind(n),window.addEventListener("offline",n.onOffline),n.onUnhandledrejection=n.onUnhandledrejection.bind(n),window.addEventListener("unhandledrejection",n.onUnhandledrejection),n._onClose.push((function(){window.removeEventListener("online",n.onOnline),window.removeEventListener("offline",n.onOffline),window.removeEventListener("unhandledrejection",n.onUnhandledrejection)}))),n._opt.ignoreWindowError&&(e.instrumentation.onerror=!1),n._instrument(e.instrumentation),n}return c(e,t),e.prototype._instrument=function(t){var e,n,i;if(void 0===t&&(t={}),t.console=!((e=this._opt.environment)&&e.startsWith&&e.startsWith("dev")),rt(t.onerror)){var r=this,o=window.onerror;window.onerror=function(){o&&o.apply(this,arguments),r.onerror.apply(r,arguments)}}Q(this),rt(t.fetch)&&"function"==typeof fetch&&(n=this,i=window.fetch,window.fetch=function(t,e){var r={type:"xhr",date:new Date};return r.method=e&&e.method?e.method:"GET","string"==typeof t?r.url=t:(r.method=t.method,r.url=t.url),n._ignoreNextXHR++,setTimeout((function(){return n._ignoreNextXHR--})),i.apply(this,arguments).then((function(t){return r.statusCode=t.status,r.duration=(new Date).getTime()-r.date.getTime(),n.scope().pushHistory(r),t})).catch((function(t){throw r.error=t,r.duration=(new Date).getTime()-r.date.getTime(),n.scope().pushHistory(r),t}))}),rt(t.history)&&"object"==typeof history&&function(t){tt=et();var e=window.onpopstate;window.onpopstate=function(n){var i=et();if(i&&nt(t,i),e)return e.apply(this,arguments)};var n=history.pushState;history.pushState=function(e,i,r){r&&nt(t,r.toString()),n.apply(this,arguments)}}(this),rt(t.console)&&"object"==typeof console&&function(t){for(var e=function(e){if(!(e in console))return"continue";var n=console[e],i=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];n.apply(console,i),t.scope().pushHistory({type:"log",severity:e,arguments:i})};i.inner=n,console[e]=i},n=0,i=K;n<i.length;n++){e(i[n])}}(this),rt(t.xhr)&&"undefined"!=typeof XMLHttpRequest&&function(t){function e(e){var n=e.__state;n.statusCode=e.status,n.duration=(new Date).getTime()-n.date.getTime(),t.scope().pushHistory(n)}var n=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,i,r,o,s){0===t._ignoreNextXHR&&(this.__state={type:"xhr",method:e,url:i}),n.apply(this,arguments)};var i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(t){var n=this.onreadystatechange;return this.onreadystatechange=function(t){if(4===this.readyState&&this.__state&&e(this),n)return n.apply(this,arguments)},this.__state&&(this.__state.date=new Date),i.apply(this,arguments)}}(this)},e.prototype.notify=function(e){var n=this;return this.offline?new Promise((function(t,i){for(n.todo.push({err:e,resolve:t,reject:i});n.todo.length>100;){var r=n.todo.shift();if(void 0===r)break;r.resolve({error:new Error("airbrake: offline queue is too large")})}})):t.prototype.notify.call(this,e)},e.prototype.onOnline=function(){this.offline=!1;for(var t=function(t){e.notify(t.err).then((function(e){t.resolve(e)}))},e=this,n=0,i=this.todo;n<i.length;n++){t(i[n])}this.todo=[]},e.prototype.onOffline=function(){this.offline=!0},e.prototype.onUnhandledrejection=function(t){var e=t.reason||t.detail&&t.detail.reason;if(e){var n=e.message||String(e);n.indexOf&&0===n.indexOf("airbrake: ")||this.notify(e)}},e.prototype.onerror=function(t,e,n,i,r){this._ignoreWindowError>0||(r?this.notify({error:r,context:{windowError:!0}}):e&&n&&this.notify({error:{message:t,fileName:e,lineNumber:n,columnNumber:i,noStack:!0},context:{windowError:!0}}))},e.prototype._ignoreNextWindowError=function(){var t=this;this._ignoreWindowError++,setTimeout((function(){return t._ignoreWindowError--}))},e}(X);function rt(t){return void 0===t||!0===t}},function(t,e,n){var i,r,o;!function(n,s){"use strict";r=[],void 0===(o="function"==typeof(i=function(){function t(t){return t.charAt(0).toUpperCase()+t.substring(1)}function e(t){return function(){return this[t]}}var n=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],r=["fileName","functionName","source"],o=n.concat(i,r,["args"]);function s(e){if(e instanceof Object)for(var n=0;n<o.length;n++)e.hasOwnProperty(o[n])&&void 0!==e[o[n]]&&this["set"+t(o[n])](e[o[n]])}s.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof s)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new s(t)}},toString:function(){var t=this.getFileName()||"",e=this.getLineNumber()||"",n=this.getColumnNumber()||"",i=this.getFunctionName()||"";return this.getIsEval()?t?"[eval] ("+t+":"+e+":"+n+")":"[eval]:"+e+":"+n:i?i+" ("+t+":"+e+":"+n+")":t+":"+e+":"+n}},s.fromString=function(t){var e=t.indexOf("("),n=t.lastIndexOf(")"),i=t.substring(0,e),r=t.substring(e+1,n).split(","),o=t.substring(n+1);if(0===o.indexOf("@"))var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,""),c=a[1],h=a[2],l=a[3];return new s({functionName:i,args:r||void 0,fileName:c,lineNumber:h||void 0,columnNumber:l||void 0})};for(var a=0;a<n.length;a++)s.prototype["get"+t(n[a])]=e(n[a]),s.prototype["set"+t(n[a])]=function(t){return function(e){this[t]=Boolean(e)}}(n[a]);for(var c=0;c<i.length;c++)s.prototype["get"+t(i[c])]=e(i[c]),s.prototype["set"+t(i[c])]=function(t){return function(e){if(n=e,isNaN(parseFloat(n))||!isFinite(n))throw new TypeError(t+" must be a Number");var n;this[t]=Number(e)}}(i[c]);for(var h=0;h<r.length;h++)s.prototype["get"+t(r[h])]=e(r[h]),s.prototype["set"+t(r[h])]=function(t){return function(e){this[t]=String(e)}}(r[h]);return s})?i.apply(e,r):i)||(t.exports=o)}()},function(t,e,n){var i=n(15).RBTree;function r(t,e,n){this.discrete=!1===t,this.delta=t||.01,this.K=void 0===e?25:e,this.CX=void 0===n?1.1:n,this.centroids=new i(o),this.nreset=0,this.reset()}function o(t,e){return t.mean>e.mean?1:t.mean<e.mean?-1:0}function s(t,e){return t.mean_cumn-e.mean_cumn}function a(t){this.config=t||{},this.mode=this.config.mode||"auto",r.call(this,"cont"===this.mode&&t.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}r.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},r.prototype.size=function(){return this.centroids.size},r.prototype.toArray=function(t){var e=[];return t?(this._cumulate(!0),this.centroids.each((function(t){e.push(t)}))):this.centroids.each((function(t){e.push({mean:t.mean,n:t.n})})),e},r.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},r.prototype.push=function(t,e){e=e||1,t=Array.isArray(t)?t:[t];for(var n=0;n<t.length;n++)this._digest(t[n],e)},r.prototype.push_centroid=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++)this._digest(t[e].mean,t[e].n)},r.prototype._cumulate=function(t){if(!(this.n===this.last_cumulate||!t&&this.CX&&this.CX>this.n/this.last_cumulate)){var e=0;this.centroids.each((function(t){t.mean_cumn=e+t.n/2,e=t.cumn=e+t.n})),this.n=this.last_cumulate=e}},r.prototype.find_nearest=function(t){if(0===this.size())return null;var e=this.centroids.lowerBound({mean:t}),n=null===e.data()?e.prev():e.data();if(n.mean===t||this.discrete)return n;var i=e.prev();return i&&Math.abs(i.mean-t)<Math.abs(n.mean-t)?i:n},r.prototype._new_centroid=function(t,e,n){var i={mean:t,n:e,cumn:n};return this.centroids.insert(i),this.n+=e,i},r.prototype._addweight=function(t,e,n){e!==t.mean&&(t.mean+=n*(e-t.mean)/(t.n+n)),t.cumn+=n,t.mean_cumn+=n/2,t.n+=n,this.n+=n},r.prototype._digest=function(t,e){var n=this.centroids.min(),i=this.centroids.max(),r=this.find_nearest(t);if(r&&r.mean===t)this._addweight(r,t,e);else if(r===n)this._new_centroid(t,e,0);else if(r===i)this._new_centroid(t,e,this.n);else if(this.discrete)this._new_centroid(t,e,r.cumn);else{var o=r.mean_cumn/this.n;Math.floor(4*this.n*this.delta*o*(1-o))-r.n>=e?this._addweight(r,t,e):this._new_centroid(t,e,r.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},r.prototype.bound_mean=function(t){var e=this.centroids.upperBound({mean:t}),n=e.prev();return[n,n.mean===t?n:e.next()]},r.prototype.p_rank=function(t){var e=(Array.isArray(t)?t:[t]).map(this._p_rank,this);return Array.isArray(t)?e:e[0]},r.prototype._p_rank=function(t){if(0!==this.size()){if(t<this.centroids.min().mean)return 0;if(t>this.centroids.max().mean)return 1;this._cumulate(!0);var e=this.bound_mean(t),n=e[0],i=e[1];if(this.discrete)return n.cumn/this.n;var r=n.mean_cumn;return n!==i&&(r+=(t-n.mean)*(i.mean_cumn-n.mean_cumn)/(i.mean-n.mean)),r/this.n}},r.prototype.bound_mean_cumn=function(t){this.centroids._comparator=s;var e=this.centroids.upperBound({mean_cumn:t});this.centroids._comparator=o;var n=e.prev();return[n,n&&n.mean_cumn===t?n:e.next()]},r.prototype.percentile=function(t){var e=(Array.isArray(t)?t:[t]).map(this._percentile,this);return Array.isArray(t)?e:e[0]},r.prototype._percentile=function(t){if(0!==this.size()){this._cumulate(!0);this.centroids.min(),this.centroids.max();var e=this.n*t,n=this.bound_mean_cumn(e),i=n[0],r=n[1];return r===i||null===i||null===r?(i||r).mean:this.discrete?e<=i.cumn?i.mean:r.mean:i.mean+(e-i.mean_cumn)*(r.mean-i.mean)/(r.mean_cumn-i.mean_cumn)}},r.prototype.compress=function(){if(!this.compressing){var t,e,n=this.toArray();for(this.reset(),this.compressing=!0;n.length>0;)this.push_centroid((t=n,e=void 0,e=Math.floor(Math.random()*t.length),t.splice(e,1)[0]));this._cumulate(!0),this.compressing=!1}},a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.push=function(t){r.prototype.push.call(this,t),this.check_continuous()},a.prototype._new_centroid=function(t,e,n){this.n_unique+=1,r.prototype._new_centroid.call(this,t,e,n)},a.prototype._addweight=function(t,e,n){1===t.n&&(this.n_unique-=1),r.prototype._addweight.call(this,t,e,n)},a.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&(this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0))},t.exports={TDigest:r,Digest:a}},function(t,e,n){t.exports={RBTree:n(16),BinTree:n(17)}},function(t,e,n){var i=n(0);function r(t){this.data=t,this.left=null,this.right=null,this.red=!0}function o(t){this._root=null,this._comparator=t,this.size=0}function s(t){return null!==t&&t.red}function a(t,e){var n=t.get_child(!e);return t.set_child(!e,n.get_child(e)),n.set_child(e,t),t.red=!0,n.red=!1,n}function c(t,e){return t.set_child(!e,a(t.get_child(!e),!e)),a(t,e)}r.prototype.get_child=function(t){return t?this.right:this.left},r.prototype.set_child=function(t,e){t?this.right=e:this.left=e},o.prototype=new i,o.prototype.insert=function(t){var e=!1;if(null===this._root)this._root=new r(t),e=!0,this.size++;else{var n=new r(void 0),i=0,o=0,h=null,l=n,u=null,d=this._root;for(l.right=this._root;;){if(null===d?(d=new r(t),u.set_child(i,d),e=!0,this.size++):s(d.left)&&s(d.right)&&(d.red=!0,d.left.red=!1,d.right.red=!1),s(d)&&s(u)){var p=l.right===h;d===u.get_child(o)?l.set_child(p,a(h,!o)):l.set_child(p,c(h,!o))}var f=this._comparator(d.data,t);if(0===f)break;o=i,i=f<0,null!==h&&(l=h),h=u,u=d,d=d.get_child(i)}this._root=n.right}return this._root.red=!1,e},o.prototype.remove=function(t){if(null===this._root)return!1;var e=new r(void 0),n=e;n.right=this._root;for(var i=null,o=null,h=null,l=1;null!==n.get_child(l);){var u=l;o=i,i=n,n=n.get_child(l);var d=this._comparator(t,n.data);if(l=d>0,0===d&&(h=n),!s(n)&&!s(n.get_child(l)))if(s(n.get_child(!l))){var p=a(n,l);i.set_child(u,p),i=p}else if(!s(n.get_child(!l))){var f=i.get_child(!u);if(null!==f)if(s(f.get_child(!u))||s(f.get_child(u))){var m=o.right===i;s(f.get_child(u))?o.set_child(m,c(i,u)):s(f.get_child(!u))&&o.set_child(m,a(i,u));var _=o.get_child(m);_.red=!0,n.red=!0,_.left.red=!1,_.right.red=!1}else i.red=!1,f.red=!0,n.red=!0}}return null!==h&&(h.data=n.data,i.set_child(i.right===n,n.get_child(null===n.left)),this.size--),this._root=e.right,null!==this._root&&(this._root.red=!1),null!==h},t.exports=o},function(t,e,n){var i=n(0);function r(t){this.data=t,this.left=null,this.right=null}function o(t){this._root=null,this._comparator=t,this.size=0}r.prototype.get_child=function(t){return t?this.right:this.left},r.prototype.set_child=function(t,e){t?this.right=e:this.left=e},o.prototype=new i,o.prototype.insert=function(t){if(null===this._root)return this._root=new r(t),this.size++,!0;for(var e=0,n=null,i=this._root;;){if(null===i)return i=new r(t),n.set_child(e,i),ret=!0,this.size++,!0;if(0===this._comparator(i.data,t))return!1;e=this._comparator(i.data,t)<0,n=i,i=i.get_child(e)}},o.prototype.remove=function(t){if(null===this._root)return!1;var e=new r(void 0),n=e;n.right=this._root;for(var i=null,o=null,s=1;null!==n.get_child(s);){i=n,n=n.get_child(s);var a=this._comparator(t,n.data);s=a>0,0===a&&(o=n)}return null!==o&&(o.data=n.data,i.set_child(i.right===n,n.get_child(null===n.left)),this._root=e.right,this.size--,!0)},t.exports=o},function(t,e,n){"use strict";n.r(e),n.d(e,"Channel",(function(){return C})),n.d(e,"Serializer",(function(){return S})),n.d(e,"Socket",(function(){return T})),n.d(e,"LongPoll",(function(){return E})),n.d(e,"Ajax",(function(){return j})),n.d(e,"Presence",(function(){return O}));const i="undefined"!=typeof self?self:null,r="undefined"!=typeof window?window:null,o=i||r||void 0,s=0,a=1,c=2,h=3,l="closed",u="errored",d="joined",p="joining",f="leaving",m="phx_close",_="phx_error",g="phx_join",v="phx_reply",y="phx_leave",k=[m,_,g,v,y],b="longpoll",w="websocket";let z=t=>{if("function"==typeof t)return t;return function(){return t}};class x{constructor(t,e,n,i){this.channel=t,this.event=e,this.payload=n||function(){return{}},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(t){this.timeout=t,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(t,e){return this.hasReceived(t)&&e(this.receivedResp.response),this.recHooks.push({status:t,callback:e}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:t,response:e,ref:n}){this.recHooks.filter(e=>e.status===t).forEach(t=>t.callback(e))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,t=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=t,this.matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}trigger(t,e){this.channel.trigger(this.refEvent,{status:t,response:e})}}class C{constructor(t,e,n){this.state=l,this.topic=t,this.params=z(e||{}),this.socket=n,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new x(this,g,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new A(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=d,this.rejoinTimer.reset(),this.pushBuffer.forEach(t=>t.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=u,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=l,this.socket.remove(this)}),this.onError(t=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,t),this.isJoining()&&this.joinPush.reset(),this.state=u,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new x(this,y,z({}),this.timeout).send(),this.state=u,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(v,(t,e)=>{this.trigger(this.replyEventName(e),t)})}join(t=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=t,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(t){this.on(m,t)}onError(t){return this.on(_,e=>t(e))}on(t,e){let n=this.bindingRef++;return this.bindings.push({event:t,ref:n,callback:e}),n}off(t,e){this.bindings=this.bindings.filter(n=>!(n.event===t&&(void 0===e||e===n.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,e,n=this.timeout){if(!this.joinedOnce)throw new Error(`tried to push '${t}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let i=new x(this,t,(function(){return e}),n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}leave(t=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=f;let e=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(m,"leave")},n=new x(this,y,z({}),t);return n.receive("ok",()=>e()).receive("timeout",()=>e()),n.send(),this.canPush()||n.trigger("ok",{}),n}onMessage(t,e,n){return e}isLifecycleEvent(t){return k.indexOf(t)>=0}isMember(t,e,n,i){return this.topic===t&&(!i||i===this.joinRef()||!this.isLifecycleEvent(e)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:t,event:e,payload:n,joinRef:i}),!1))}joinRef(){return this.joinPush.ref}sendJoin(t){this.state=p,this.joinPush.resend(t)}rejoin(t=this.timeout){this.isLeaving()||this.sendJoin(t)}trigger(t,e,n,i){let r=this.onMessage(t,e,n,i);if(e&&!r)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");for(let e=0;e<this.bindings.length;e++){const o=this.bindings[e];o.event===t&&o.callback(r,n,i||this.joinRef())}}replyEventName(t){return`chan_reply_${t}`}isClosed(){return this.state===l}isErrored(){return this.state===u}isJoined(){return this.state===d}isJoining(){return this.state===p}isLeaving(){return this.state===f}}let S={encode(t,e){let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(n))},decode(t,e){let[n,i,r,o,s]=JSON.parse(t);return e({join_ref:n,ref:i,topic:r,event:o,payload:s})}};class T{constructor(t,e={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=e.timeout||1e4,this.transport=e.transport||o.WebSocket||E,this.defaultEncoder=S.encode,this.defaultDecoder=S.decode,this.closeWasClean=!1,this.unloaded=!1,this.binaryType=e.binaryType||"arraybuffer",this.transport!==E?(this.encode=e.encode||this.defaultEncoder,this.decode=e.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),r&&r.addEventListener&&r.addEventListener("beforeunload",t=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))}),this.heartbeatIntervalMs=e.heartbeatIntervalMs||3e4,this.rejoinAfterMs=t=>e.rejoinAfterMs?e.rejoinAfterMs(t):[1e3,2e3,5e3][t-1]||1e4,this.reconnectAfterMs=t=>this.unloaded?100:e.reconnectAfterMs?e.reconnectAfterMs(t):[10,50,100,150,200,250,500,1e3,2e3][t-1]||5e3,this.logger=e.logger||null,this.longpollerTimeout=e.longpollerTimeout||2e4,this.params=z(e.params||{}),this.endPoint=`${t}/${w}`,this.vsn=e.vsn||"2.0.0",this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new A(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let t=j.appendParams(j.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==t.charAt(0)?t:"/"===t.charAt(1)?`${this.protocol()}:${t}`:`${this.protocol()}://${location.host}${t}`}disconnect(t,e,n){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(t,e,n)}connect(t){t&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=z(t)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=t=>this.onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this.onConnClose(t))}log(t,e,n){this.logger(t,e,n)}hasLogger(){return null!==this.logger}onOpen(t){let e=this.makeRef();return this.stateChangeCallbacks.open.push([e,t]),e}onClose(t){let e=this.makeRef();return this.stateChangeCallbacks.close.push([e,t]),e}onError(t){let e=this.makeRef();return this.stateChangeCallbacks.error.push([e,t]),e}onMessage(t){let e=this.makeRef();return this.stateChangeCallbacks.message.push([e,t]),e}onConnOpen(){this.hasLogger()&&this.log("transport",`connected to ${this.endPointURL()}`),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,t])=>t())}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(t,e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n||""):this.conn.close(),this.conn=null),t&&t()}onConnClose(t){this.hasLogger()&&this.log("transport","close",t),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,e])=>e(t))}onConnError(t){this.hasLogger()&&this.log("transport",t),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(([,e])=>e(t))}triggerChanError(){this.channels.forEach(t=>{t.isErrored()||t.isLeaving()||t.isClosed()||t.trigger(_)})}connectionState(){switch(this.conn&&this.conn.readyState){case s:return"connecting";case a:return"open";case c:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(t){this.off(t.stateChangeRefs),this.channels=this.channels.filter(e=>e.joinRef()!==t.joinRef())}off(t){for(let e in this.stateChangeCallbacks)this.stateChangeCallbacks[e]=this.stateChangeCallbacks[e].filter(([e])=>!t.includes(e))}channel(t,e={}){let n=new C(t,e,this);return this.channels.push(n),n}push(t){if(this.hasLogger()){let{topic:e,event:n,payload:i,ref:r,join_ref:o}=t;this.log("push",`${e} ${n} (${o}, ${r})`,i)}this.isConnected()?this.encode(t,t=>this.conn.send(t)):this.sendBuffer.push(()=>this.encode(t,t=>this.conn.send(t)))}makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(t){this.closeWasClean=!1,this.conn.close(1e3,t)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}onConnMessage(t){this.decode(t.data,t=>{let{topic:e,event:n,payload:i,ref:r,join_ref:o}=t;r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${i.status||""} ${e} ${n} ${r&&"("+r+")"||""}`,i);for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s.isMember(e,n,i,o)&&s.trigger(n,i,r,o)}for(let e=0;e<this.stateChangeCallbacks.message.length;e++){let[,n]=this.stateChangeCallbacks.message[e];n(t)}})}}class E{constructor(t){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=s,this.poll()}normalizeEndpoint(t){return t.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+w),"$1/"+b)}endpointURL(){return j.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=s}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==a&&this.readyState!==s||j.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),t=>{if(t){var{status:e,token:n,messages:i}=t;this.token=n}else var e=0;switch(e){case 200:i.forEach(t=>this.onmessage({data:t})),this.poll();break;case 204:this.poll();break;case 410:this.readyState=a,this.onopen(),this.poll();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error(`unhandled poll status ${e}`)}})}send(t){j.request("POST",this.endpointURL(),"application/json",t,this.timeout,this.onerror.bind(this,"timeout"),t=>{t&&200===t.status||(this.onerror(t&&t.status),this.closeAndRetry())})}close(t,e){this.readyState=h,this.onclose()}}class j{static request(t,e,n,i,r,s,a){if(o.XDomainRequest){let n=new XDomainRequest;this.xdomainRequest(n,t,e,i,r,s,a)}else{let c=o.XMLHttpRequest?new o.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(c,t,e,n,i,r,s,a)}}static xdomainRequest(t,e,n,i,r,o,s){t.timeout=r,t.open(e,n),t.onload=()=>{let e=this.parseJSON(t.responseText);s&&s(e)},o&&(t.ontimeout=o),t.onprogress=()=>{},t.send(i)}static xhrRequest(t,e,n,i,r,o,s,a){t.open(e,n,!0),t.timeout=o,t.setRequestHeader("Content-Type",i),t.onerror=()=>{a&&a(null)},t.onreadystatechange=()=>{if(t.readyState===this.states.complete&&a){let e=this.parseJSON(t.responseText);a(e)}},s&&(t.ontimeout=s),t.send(r)}static parseJSON(t){if(!t||""===t)return null;try{return JSON.parse(t)}catch(e){return console&&console.log("failed to parse JSON response",t),null}}static serialize(t,e){let n=[];for(var i in t){if(!t.hasOwnProperty(i))continue;let r=e?`${e}[${i}]`:i,o=t[i];"object"==typeof o?n.push(this.serialize(o,r)):n.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return n.join("&")}static appendParams(t,e){if(0===Object.keys(e).length)return t;let n=t.match(/\?/)?"&":"?";return`${t}${n}${this.serialize(e)}`}}j.states={complete:4};class O{constructor(t,e={}){let n=e.events||{state:"presence_state",diff:"presence_diff"};this.state={},this.pendingDiffs=[],this.channel=t,this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}},this.channel.on(n.state,t=>{let{onJoin:e,onLeave:n,onSync:i}=this.caller;this.joinRef=this.channel.joinRef(),this.state=O.syncState(this.state,t,e,n),this.pendingDiffs.forEach(t=>{this.state=O.syncDiff(this.state,t,e,n)}),this.pendingDiffs=[],i()}),this.channel.on(n.diff,t=>{let{onJoin:e,onLeave:n,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=O.syncDiff(this.state,t,e,n),i())})}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}list(t){return O.list(this.state,t)}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}static syncState(t,e,n,i){let r=this.clone(t),o={},s={};return this.map(r,(t,n)=>{e[t]||(s[t]=n)}),this.map(e,(t,e)=>{let n=r[t];if(n){let i=e.metas.map(t=>t.phx_ref),r=n.metas.map(t=>t.phx_ref),a=e.metas.filter(t=>r.indexOf(t.phx_ref)<0),c=n.metas.filter(t=>i.indexOf(t.phx_ref)<0);a.length>0&&(o[t]=e,o[t].metas=a),c.length>0&&(s[t]=this.clone(n),s[t].metas=c)}else o[t]=e}),this.syncDiff(r,{joins:o,leaves:s},n,i)}static syncDiff(t,{joins:e,leaves:n},i,r){let o=this.clone(t);return i||(i=function(){}),r||(r=function(){}),this.map(e,(t,e)=>{let n=o[t];if(o[t]=e,n){let e=o[t].metas.map(t=>t.phx_ref),i=n.metas.filter(t=>e.indexOf(t.phx_ref)<0);o[t].metas.unshift(...i)}i(t,n,e)}),this.map(n,(t,e)=>{let n=o[t];if(!n)return;let i=e.metas.map(t=>t.phx_ref);n.metas=n.metas.filter(t=>i.indexOf(t.phx_ref)<0),r(t,n,e),0===n.metas.length&&delete o[t]}),o}static list(t,e){return e||(e=function(t,e){return e}),this.map(t,(t,n)=>e(t,n))}static map(t,e){return Object.getOwnPropertyNames(t).map(n=>e(n,t[n]))}static clone(t){return JSON.parse(JSON.stringify(t))}}class A{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}},function(t,e){t.exports={name:"mkz_c_auto_msg_history",addItems:function(t){var e=this.getItems(),n=!0,i=!1,r=void 0;try{for(var o,s=function(){var t=o.value,n=e.findIndex((function(e){return e.payload.custom_fields.uid===t.payload.custom_fields.uid}));-1===n?e.push(t):e[n].payload.custom_fields=t.payload.custom_fields},a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)s()}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return this.setItems(e),e},getItems:function(){var t=sessionStorage.getItem(this.name),e=[];try{e=JSON.parse(t)||[]}catch(t){}return e},setItems:function(t){return sessionStorage.setItem(this.name,JSON.stringify(t)),t},removeItem:function(t){var e=this.getItems(),n=e.findIndex((function(e){return e.payload.muid===t}));return-1!==n&&(e.splice(n,1),this.setItems(e)),e}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return View}));var css=__webpack_require__(4),msgDelivered=__webpack_require__(3),helpers=__webpack_require__(5),domEvent=__webpack_require__(21),Template=__webpack_require__(22).default,msgStory=__webpack_require__(1),View=function(){function View(t){_classCallCheck(this,View),this.history=null,this.collapsed=!0,this.windowFocus=!0,this.app=t,this.previewMode=t.previewMode,this.libs=t.libs,this.allowSending=!1,this.typingTimeout=1e3,this.noticeShowTimeout=1e3,this.noticeHideTimeout=1e4,this.width=null,this.template=new Template(this),this.validationOptions={invalidClassName:"mkz-f__invalid",invalidParentClassName:"mkz-f__invalid-wrap"}}return _createClass(View,[{key:"destroy",value:function(){this.el&&this.el.parentNode.removeChild(this.el)}},{key:"bind",value:function(){var t=this;domEvent.add(this.elInput,"keyup",this.setMsgHeight.bind(this)),domEvent.add(this.elToggle,"click",this.collapse.bind(this)),domEvent.add(this.elClose,"click",this.collapse.bind(this)),this.previewMode||(domEvent.add(window,"focus",this.focus.bind(this)),domEvent.add(window,"blur",this.blur.bind(this)),domEvent.add(this.elSubmit,"click",this.sendMsg.bind(this)),domEvent.add(this.elInput,"keydown",(function(e){13!=e.keyCode||e.shiftKey?t.startTyping():(e.preventDefault(),t.sendMsg())})))}},{key:"bindMessage",value:function(t){if(!this.previewMode){var e=t.querySelectorAll(".mkz-c-o-js-action"),n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;domEvent.add(a,"click",this.clickProductAttachment.bind(this))}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}var c=t.querySelectorAll(".mkz-f-js"),h=!0,l=!1,u=void 0;try{for(var d,p=c[Symbol.iterator]();!(h=(d=p.next()).done);h=!0){var f=d.value;domEvent.add(f,"submit",this.submitSurveyForm.bind(this))}}catch(t){l=!0,u=t}finally{try{h||null==p.return||p.return()}finally{if(l)throw u}}}}},{key:"submitSurveyForm",value:function(t){t.preventDefault();var e=t.target,n=new this.libs.Validation(e,this.validationOptions).valid(),i=new this.libs.FormToObject(e),r=e.dataset.uid;n&&(this.app.pusherNewSurveyMsg(r,i),e.querySelector("button").disabled=!0)}},{key:"clickProductAttachment",value:function clickProductAttachment(e){var el=e.target,offer=JSON.parse(el.dataset.data),callbackLabel=el.dataset.callback_label,settings=this.app.settings.behavior.attachment_cta.product,callback=function callback(){callbackLabel&&(el.innerHTML=callbackLabel),settings.callback&&eval(settings.callback)(offer)};el.handlerDone||(el.handlerDone=!0,el.setAttribute("disabled",!0),eval(settings.handler)(offer,callback))}},{key:"focus",value:function(){this.windowFocus=!0}},{key:"blur",value:function(){this.windowFocus=!1}},{key:"collapse",value:function(){var t=this;this.collapsed=!this.collapsed,this.collapsed?(helpers.removeClass(document.documentElement,"mkz-c-fixed"),helpers.addClass(this.elContainer,"mkz-c_collapse_yes")):(helpers.addClass(document.documentElement,"mkz-c-fixed"),helpers.removeClass(this.elContainer,"mkz-c_collapse_yes"),this.previewMode||setTimeout((function(){t.elInput.focus()}),100)),this.previewMode||this.app.handlerCollapse(this.collapsed)}},{key:"connected",value:function(){this.enableSending()}},{key:"disconnected",value:function(){this.disableSending()}},{key:"startTyping",value:function(){var t=this;this.timeoutTyping||(this.timeoutTyping=setTimeout((function(){t.sendTyping(),t.stopTyping()}),this.typingTimeout))}},{key:"stopTyping",value:function(){clearTimeout(this.timeoutTyping),this.timeoutTyping=null}},{key:"sendTyping",value:function(){var t=this.elInput.value;this.app.pusherTyping(t)}},{key:"sendMsg",value:function(){var t=this;if(this.allowSending){var e=this.elInput.value.trim();e&&(this.stopTyping(),this.disableSending(),this.app.pusherNewMsg(e).receive("ok",(function(){t.elInput.value=null,t.setMsgHeight(),t.enableSending()})).receive("error",(function(){return t.enableSending.bind(t)})).receive("timeout",(function(){return t.enableSending.bind(t)})))}}},{key:"setMsgHeight",value:function(){this.elInput.style.height="auto";var t=this.elInput.scrollHeight;this.elInput.style.height=t+"px"}},{key:"disableSending",value:function(){this.allowSending=!1,this.elSubmit&&helpers.addClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"enableSending",value:function(){this.allowSending=!0,this.elSubmit&&helpers.removeClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"assignAgent",value:function(){this.elAgentName.innerText=this.app.currentAgent.name||"",this.app.settings.appearance.agent_post&&(this.elAgentPost.innerText=this.app.currentAgent.job_title||""),this.app.settings.appearance.agent_avatar&&this.app.currentAgent.avatar_url?(this.elAgentAvatar.src=this.app.currentAgent.avatar_url,this.elAgentAvatar.style.display="block"):this.elAgentAvatar.style.display="none",helpers.addClass(this.elContainer,"mkz-c_agent_assign")}},{key:"unassignAgent",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_assign")}},{key:"onlineAgents",value:function(){helpers.addClass(this.elContainer,"mkz-c_agent_online")}},{key:"offlineAgents",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_online")}},{key:"toggleNotice",value:function(){var t=this;if(!this.previewMode){sessionStorage.getItem("mkz_c_tooltip_hidden")||(sessionStorage.setItem("mkz_c_tooltip_hidden",!0),setTimeout((function(){t.showNotice()}),this.noticeShowTimeout),setTimeout((function(){t.hideNotice()}),this.noticeShowTimeout+this.noticeHideTimeout))}}},{key:"showNotice",value:function(){helpers.addClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"hideNotice",value:function(){helpers.removeClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"render",value:function(){this.el||(this.el=helpers.appendHTML(document.body,this.template.content()),this.elContainer=this.el.querySelector(".mkz-c-js"),this.elInput=this.el.querySelector(".mkz-c-js-input"),this.elSubmit=this.el.querySelector(".mkz-c-js-submit"),this.elUnread=this.el.querySelector(".mkz-c-js-unread"),this.elClose=this.el.querySelector(".mkz-c-js-close"),this.elToggle=this.el.querySelector(".mkz-c-js-toggle"),this.elHistory=this.el.querySelector(".mkz-c-js-history"),this.elScroll=this.el.querySelector(".mkz-c-js-scroll"),this.elAgentName=this.el.querySelector(".mkz-c-js-agent-name"),this.elAgentPost=this.el.querySelector(".mkz-c-js-agent-post"),this.elAgentAvatar=this.el.querySelector(".mkz-c-js-agent-avatar"),this.bind(),this.toggleNotice(),this.renderMessages()),this.renderUnread()}},{key:"renderMessages",value:function(){var t=this.history||msgStory.getHistory(),e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.renderMessage(s)}}catch(t){n=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"renderMessage",value:function(t,e){var n=this.template.message(t),i=this.findMsg(t.muid);if(i)i.innerHTML=n;else{var r=e&&this.findMsg(e.muid);i=r?helpers.beforeHTML(r,n):helpers.appendHTML(this.elHistory,n)}this.bindMessage(i)}},{key:"findMsg",value:function(t){return this.elHistory.querySelector('[data-id="'.concat(t,'"]'))}},{key:"renderUnread",value:function(){if(this.elUnread){var t=msgDelivered.getList().length;this.elUnread.innerHTML=t,this.elUnread.style.display=0===t?"none":"block"}}},{key:"renderAgentState",value:function(){this.app.agentIsOnline?this.onlineAgents():this.offlineAgents()}},{key:"scrollBottom",value:function(){var t=this;setTimeout((function(){t.elScroll.scrollTop=t.elScroll.scrollHeight}),0)}}]),View}()},function(t,e){t.exports={guid:0,fixEvent:function(t){if((t=t||window.event).isFixed)return t;if(t.isFixed=!0,t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagaton||function(){this.cancelBubble=!0},t.target||(t.target=t.srcElement),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement==t.target?t.toElement:t.fromElement),null==t.pageX&&null!=t.clientX){var e=document.documentElement,n=document.body;t.pageX=t.clientX+(e&&e.scrollLeft||n&&n.scrollLeft||0)-(e.clientLeft||0),t.pageY=t.clientY+(e&&e.scrollTop||n&&n.scrollTop||0)-(e.clientTop||0)}return!t.which&&t.button&&(t.which=1&t.button?1:2&t.button?3:4&t.button?2:0),t},commonHandle:function(t,e){t=e.fixEvent(t);var n=this.events[t.type];for(var i in n){if(!1===n[i].call(this,t)&&(t.preventDefault(),t.stopPropagation()),t.stopNow)break}},add:function(t,e,n){var i=this;t.setInterval&&t!=window&&!t.frameElement&&(t=window),n.guid||(n.guid=++this.guid),t.events||(t.events={},t.handle=function(e){return i.commonHandle.call(t,e,i)}),t.events[e]||(t.events[e]={},t.addEventListener?t.addEventListener(e,t.handle,!1):t.attachEvent&&t.attachEvent("on"+e,t.handle)),t.events[e][n.guid]=n},remove:function(t,e,n){var i=t.events&&t.events[e];if(i){for(var r in delete i[n.guid],i)return;for(var r in t.removeEventListener?t.removeEventListener(e,t.handle,!1):t.detachEvent&&t.detachEvent("on"+e,t.handle),delete t.events[e],t.events)return;try{delete t.handle,delete t.events}catch(e){t.removeAttribute("handle"),t.removeAttribute("events")}}}}},function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e),n.d(e,"default",(function(){return c}));var o=n(4),s=n(5),a=n(23),c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e.app,this.view=e,this.appearance=this.app.settings.appearance,this.behavior=this.app.settings.behavior}var e,n,c;return e=t,(n=[{key:"safe",value:function(t){return s.htmlToText(t)}},{key:"t",value:function(t){return a[this.app.locale][t]}},{key:"attribute",value:function(t){return t?t.replace(/\"/gi,"&quot;"):""}},{key:"offer",value:function(t,e,n){var i=t.icon?'\n          <img src="'.concat(this.safe(t.icon),'" alt="" class="mkz-c-o__preview-img" />\n    '):'\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="480" height="448" viewBox="0 0 480 448" class="mkz-c-o__preview-img">\n            <path fill="currentColor" d="M160 144c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zM416 240v112h-352v-48l80-80 40 40 128-128zM440 64h-400c-4.25 0-8 3.75-8 8v304c0 4.25 3.75 8 8 8h400c4.25 0 8-3.75 8-8v-304c0-4.25-3.75-8-8-8zM480 72v304c0 22-18 40-40 40h-400c-22 0-40-18-40-40v-304c0-22 18-40 40-40h400c22 0 40 18 40 40z"></path>\n          </svg>\n    ',r=n.length<2?"":'\n        <div class="mkz-c-o__counter">\n          '.concat(e+1,"/").concat(n.length,"\n        </dvi>\n    "),o=this.t(this.behavior.attachment_cta.product.callback_label_text),s=this.t(this.behavior.attachment_cta.product.label_text);return'\n      <div class="mkz-c-o__i">\n        <div class="mkz-c-o__content">\n          <a href="'.concat(this.safe(t.url),'" class="mkz-c-o__preview-link">\n            ').concat(i,'\n          </a>\n          <div class="mkz-c-o__name">\n            <a href="').concat(this.safe(t.url),'" class="mkz-c-o__name-link">').concat(this.safe(t.name),'</a>\n          </div>\n          <div class="mkz-c-o__info">\n            <div class="mkz-c-o__info-price">\n              ').concat(this.safe(t.display_price),'\n            </div>\n            <div class="mkz-c-o__info-avaliable mkz-c-o__info-avaliable_color_').concat(t.available?"green":"red",'">\n              ').concat(this.t(t.available?"in_stock":"out_of_stock"),'\n            </div>\n          </div>\n          <div class="mkz-c-o__action">\n            <span\n              data-data="').concat(this.attribute(JSON.stringify(t)),'"\n              data-callback_label="').concat(this.attribute(o),'"\n              class="mkz-c-o__btn mkz-c-o-js-action"\n            >\n              ').concat(s,"\n            </span>\n          </div>\n        </div>\n        ").concat(r,"\n      </div>\n    ")}},{key:"offers",value:function(t){return t?'\n    <div class="mkz-c-o">\n      '.concat(t.map(this.offer.bind(this)).join("\n"),"\n    </div>"):""}},{key:"form",value:function(t,e){var n=this,i=t.map((function(t){switch(t.display_type){case"email":return n.formEmail(t);case"select":return n.formSelect(t);case"date":return n.formDate(t);case"hint":return n.formHint(t);case"button":return n.formButton(t);default:return n.formText(t)}})).map((function(t){return'<div class="mkz-f__row">'.concat(t,"</div>")})).join("");return'\n      <form class="mkz-f mkz-f-js" data-uid="'.concat(this.attribute(e),'" novalidate autocomplete="off">').concat(i,"</form>")}},{key:"formText",value:function(t){return'\n    <label class="mkz-f__label">'.concat(t.display_name,'</label>\n    <input\n      type="text"\n      name="').concat(t.field,'"\n      class="mkz-f__input"\n      value="').concat(this.attribute(t.value),'"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    />\n    ")}},{key:"formEmail",value:function(t){return'\n    <label class="mkz-f__label">'.concat(t.display_name,'</label>\n    <input\n      type="email"\n      name="').concat(t.field,'"\n      class="mkz-f__input"\n      value="').concat(this.attribute(t.value),'"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    />\n    ")}},{key:"formDate",value:function(t){return'\n    <label class="mkz-f__label">'.concat(t.display_name,'</label>\n    <input\n      type="date"\n      name="').concat(t.field,'"\n      class="mkz-f__input"\n      pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}"\n      value="').concat(this.attribute(t.value),'"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    />\n    ")}},{key:"formSelect",value:function(t){var e=this,n=[["","-"]].concat(Object.entries(t.predefined_values)).map((function(n){var r=i(n,2),o=r[0],s=r[1],a=t.value===o?'selected="selected"':"";return'<option value="'.concat(e.attribute(o),'" ').concat(a,">").concat(e.safe(s),"</option>")})).join("");return'\n    <label class="mkz-f__label">'.concat(t.display_name,'</label>\n    <select\n      name="').concat(t.field,'"\n      class="mkz-f__select"\n      ').concat(t.disabled?'disabled="true"':"","\n      ").concat(t.required&&"required","\n    >").concat(n,"</select>\n    ")}},{key:"formHint",value:function(t){return'\n    <div class="mkz-f__note">'.concat(t.display_name,"</div>\n    ")}},{key:"formButton",value:function(t){return'\n    <button type="submit" class="mkz-f__btn" '.concat(t.disabled?'disabled="true"':"",">").concat(t.display_name,"</button>\n    ")}},{key:"attachments",value:function(t){var e=this,n=(t.attachments||[]).reduce((function(t,e){return t[e.type]||(t[e.type]=[]),t[e.type].push(e),t}),{});return Object.entries(n).map((function(t){var n=i(t,2),r=n[0],o=n[1];switch(r){case"product":return e.offers(o)}}))}},{key:"message",value:function(t){var e=t.sender_avatar_url?'<img src="'.concat(this.safe(t.sender_avatar_url),'" class="mkz-c__i-avatar" alt="" title="').concat(this.safe(t.sender_name),'" />'):"";return'\n          <div class="mkz-c__i mkz-c__i_type_'.concat("client"===t.sender_type?"client":"agent",'" data-id="').concat(t.muid,'">\n            ').concat(e,'\n            <div class="mkz-c__i-content">\n              ').concat(this.messageContent(t),"\n            </div>\n          </div>")}},{key:"messageContent",value:function(t){var e=this,n="client"===t.sender_type?this.appearance.client_msg_bg:this.appearance.agent_msg_bg,i="client"===t.sender_type?this.appearance.client_msg_color:this.appearance.agent_msg_color,r=function(t){return'\n      <div class="mkz-c__i-msg" style="background-color: '.concat(e.safe(n),"; color: ").concat(e.safe(i),'">\n        <div class="mkz-c__i-msg-overflow">\n          ').concat(t,"\n        </div>\n      </div>")};switch(t.msg_type){case"survey:show":var o=t.custom_fields,s=o.submitted,a=o.elements.map((function(t){return t.value=o.values&&o.values[t.field],t})),c=this.safe(o.follow_up_text);return(t.text?r(this.safe(t.text)):"")+r(s?c:this.form(a,t.muid));default:var h=(t.text||"").split("\n").join("<br />");return"\n          ".concat(h?r(h):"","\n          ").concat(this.attachments(t))}}},{key:"doc",value:function(t){return'\n            <div class="mkz-c-docs__i">\n              <div class="mkz-c-docs__btn">\n                '.concat(t,"\n              </div>\n            </div>")}},{key:"docs",value:function(){return""}},{key:"copy",value:function(){return this.appearance.markeaze_link?'\n      <a class="mkz-c__copy" href="https://markeaze.com?utm_source=markeaze&utm_campaign=referral" target="_blank">\n        <svg width="11" height="9" viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M1.94727 2.8471C2.12716 2.49158 2.57173 2.38949 2.87918 2.63311C3.12176 2.82531 3.19515 3.17138 3.05276 3.45164L1.17079 7.15577C0.991709 7.50824 0.550808 7.60949 0.24532 7.3683C0.0037509 7.17757 -0.0698014 6.83352 0.0713545 6.55454L1.94727 2.8471Z" fill="#FC4566"/>\n          <path d="M5.35667 1.9023C5.54038 1.55555 5.9926 1.45484 6.30746 1.69056C6.55814 1.87824 6.63496 2.21903 6.48885 2.49519L4.02121 7.15912C3.83664 7.50797 3.38122 7.60839 3.06569 7.36982C2.81616 7.18115 2.74036 6.8407 2.88648 6.5649L5.35667 1.9023Z" fill="#0EC52C"/>\n          <path d="M8.81247 0.351483C8.99329 -0.00816918 9.44199 -0.111851 9.75226 0.134322C9.99632 0.327953 10.0705 0.67639 9.92784 0.959046L6.80213 7.15236C6.62323 7.50684 6.18144 7.61011 5.87387 7.36934C5.62976 7.17824 5.55453 6.83147 5.6961 6.54989L8.81247 0.351483Z" fill="#7261FF"/>\n        </svg>\n        '.concat(this.t("copyright"),"\n      </a>"):""}},{key:"notice",value:function(){return this.appearance.notice_text&&this.appearance.notice_text.trim()?'\n      <div class="mkz-c__tooltip mkz-c__tooltip_picture_yes" style="color: '.concat(this.safe(this.appearance.notice_color),"; background-color: ").concat(this.safe(this.appearance.notice_bg),'">\n        <img src="').concat(this.safe(this.appearance.notice_icon_url),'" class="mkz-c__tooltip-picture" alt="" />\n        <div class="mkz-c__tooltip-text">\n          ').concat(this.safe(this.appearance.notice_text),"\n        </div>\n      </div>"):""}},{key:"content",value:function(){var t=["l-t","l-b"].indexOf(this.appearance.bar_position)>-1?"left":"right";return'\n<div mkz>\n  <div class="mkz-c mkz-c_collapse_yes mkz-c-js">\n\n    <div class="mkz-c__handler mkz-c__handler_type_'.concat(this.safe(this.appearance.bar_type)," mkz-c__handler_position_").concat(this.safe(this.appearance.bar_position),'" style="margin: ').concat(this.safe(this.appearance.bar_padding_y)," ").concat(this.safe(this.appearance.bar_padding_x),'">\n      ').concat(this.notice(),'\n      <div class="mkz-c__btn mkz-c-js-toggle" style="background-color: ').concat(this.appearance.bar_bg,"; color: ").concat(this.safe(this.appearance.bar_color),';">\n        <div class="mkz-c__btn-text">\n          <span class="mkz-c__btn-text-online">').concat(this.safe(this.appearance.bar_text_online),'</span>\n          <span class="mkz-c__btn-text-offline">').concat(this.safe(this.appearance.bar_text_offline),'</span>\n        </div>\n        <svg width="27" height="27" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="mkz-c__btn-picture">\n          <path d="M20.6429 10.4641C20.6466 11.8783 20.3162 13.2733 19.6786 14.5355C18.9226 16.0481 17.7605 17.3204 16.3223 18.2098C14.8841 19.0992 13.2267 19.5706 11.5357 19.5713C10.1216 19.5749 8.72659 19.2445 7.46432 18.607L1.35718 20.6427L3.39289 14.5355C2.75532 13.2733 2.42492 11.8783 2.42861 10.4641C2.42926 8.77313 2.90069 7.11573 3.79009 5.67755C4.67949 4.23937 5.95174 3.07721 7.46432 2.32125C8.72659 1.68368 10.1216 1.35328 11.5357 1.35696H12.0715C14.3047 1.48017 16.414 2.42278 17.9955 4.00431C19.5771 5.58585 20.5197 7.69516 20.6429 9.92839V10.4641Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n        <div class="mkz-c__btn-unread mkz-c-js-unread">0</div>\n      </div>\n    </div>\n\n    <div class="mkz-c__chat mkz-c__chat_position_').concat(t,'" style="').concat(this.view.width?"max-width: ".concat(this.view.width,"px;"):"",'">\n      <div class="mkz-c__cart-shadow" style="box-shadow: 0 0 10px ').concat(this.safe(this.appearance.title_bg),';"></div>\n      <div class="mkz-c__cart">\n        <div class="mkz-c__head" style="color: ').concat(this.safe(this.appearance.title_color),"; background-color: ").concat(this.safe(this.appearance.title_bg),';">\n          <div class="mkz-c__head-state">\n            <div class="mkz-c__state-wrap">\n              <img class="mkz-c__m-assign-avatar mkz-c-js-agent-avatar" alt="" />\n              <div class="mkz-c__state"></div>\n            </div>\n          </div>\n          <div class="mkz-c__head-m">\n            <div class="mkz-c__m-assign-text mkz-c-js-agent-name"></div>\n            <div class="mkz-c__m-assign-post mkz-c-js-agent-post"></div>\n            <div class="mkz-c__m-unassign-text">').concat(this.safe(this.appearance.bar_text_offline),'</div>\n          </div>\n          <div class="mkz-c__head-action">\n            <div class="mkz-c__close mkz-c-js-close">\n              <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M11.4287 4.57129L4.57153 11.4284" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n              <path d="M4.57153 4.57129L11.4287 11.4284" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n        <div class="mkz-c__content mkz-c-js-scroll">\n          <div class="mkz-c__list mkz-c-js-history"></div>\n        </div>\n        ').concat(this.docs(),'\n        <label class="mkz-c__footer">\n          <div class="mkz-c__footer-msg">\n            <textarea class="mkz-c__input mkz-c-js-input" rows="1" placeholder="').concat(this.t("placeholder"),'"></textarea>\n          </div>\n          <div class="mkz-c__footer-btn">\n            <div class="mkz-c__submit mkz-c-js-submit">\n              <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18.9675 0.949039L12.9784 17.6706C12.9069 17.8682 12.7194 17.9999 12.5092 18H12.3495C12.1535 18 11.9749 17.8874 11.8903 17.7105L9.53462 12.719C9.18774 11.9831 9.322 11.1103 9.874 10.5128L12.8686 7.23833C13.0524 7.04551 13.0524 6.74232 12.8686 6.5495L12.4893 6.17015C12.2965 5.98633 11.9933 5.98633 11.8005 6.17015L8.52644 9.16505C7.92893 9.71711 7.05625 9.85139 6.32044 9.50447L1.32949 7.14848C1.13702 7.076 1.00706 6.89483 1.00009 6.68926V6.52953C0.982409 6.30492 1.11738 6.09631 1.32949 6.0204L18.0492 0.0306031C18.2289 -0.0354106 18.4306 0.00725579 18.5682 0.140416L18.8278 0.399974C18.9838 0.536262 19.0394 0.754748 18.9675 0.949039Z" fill="currentColor"/>\n              </svg>\n            </div>\n          </div>\n        </label>\n      </div>\n      ').concat(this.copy(),'\n    </div>\n  </div>\n\n  <style type="text/css">').concat(o,"</style>\n\n</div>\n    ")}}])&&r(e.prototype,n),c&&r(e,c),t}()},function(t,e){t.exports={ru:{copyright:"Сделано в Markeaze",placeholder:"Напишите ваше сообщение...",in_stock:"В наличии",out_of_stock:"Не в наличии",view_product:"Посмотреть товар",add_to_cart:"Добавить в корзину",added_to_cart:"Добавлен в корзину"},en:{copyright:"Powered by Markeaze",placeholder:"Type your message here...",in_stock:"In stock",out_of_stock:"Out of stock",view_product:"View product",add_to_cart:"Add to cart",added_to_cart:"Added to Cart!"}}},function(t,e){t.exports={trackShow:function(t){mkz("trackSurveyFormShow",{survey_form_uid:t})},trackSubmit:function(t,e){e=Object.fromEntries(Object.entries(e).filter((function(t){return t[1]}))),mkz("trackSurveyFormSubmit",{survey_form_uid:t},null,e)}}},function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audio=new Audio||document.createElement("video"),this.audio&&e&&(this.onload=!1,this.onplay=!1,this.audio.autoplay=!1,this.audio.load(),this.audio.canPlayType("audio/ogg")?this.audio.src=e+".ogg":this.audio.canPlayType("audio/mp3")&&(this.audio.src=e+".mp3"),this.audio.onloadeddata=function(){n.onload=!0,n.onplay&&n.playAction()})}var e,n,r;return e=t,(n=[{key:"play",value:function(){this.audio&&(this.onload?this.playAction():this.onplay=!0)}},{key:"playAction",value:function(){this.audio.currentTime=0,this.audio.play().catch((function(t){}))}}])&&i(e.prototype,n),r&&i(e,r),t}()}]);